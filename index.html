<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Studio Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = { theme: { extend: { fontFamily: { sans: ['-apple-system','BlinkMacSystemFont','SF Pro Display','SF Pro Text','Helvetica Neue','Helvetica','Arial','sans-serif'] } } } }
    </script>
    <style>
        :root {
            --accent: #007AFF;
            --green: #34C759;
            --red: #FF3B30;
            --bg: #F5F5F7;
            --card: #FFFFFF;
            --glass: rgba(255,255,255,0.72);
            --glass-border: rgba(255,255,255,0.45);
            --border: rgba(0,0,0,0.06);
            --separator: #D2D2D7;
            --text-1: #1D1D1F;
            --text-2: #86868B;
            --text-3: #AEAEB2;
            --radius: 12px;
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; margin: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text-1);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            letter-spacing: -0.022em;
        }

        /* ═══════════════════════════════════
           PROGRESS BAR
           ═══════════════════════════════════ */
        .progress-track { height: 3px; background: rgba(0,0,0,0.06); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

        /* ═══════════════════════════════════
           CARDS
           ═══════════════════════════════════ */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 0 0 0.5px rgba(0,0,0,0.03);
        }

        /* ═══════════════════════════════════
           INPUTS
           ═══════════════════════════════════ */
        .input {
            background: var(--bg);
            border: 1.5px solid transparent;
            border-radius: var(--radius);
            padding: 14px 16px;
            width: 100%;
            outline: none;
            font-size: 16px;
            color: var(--text-1);
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: inherit;
            letter-spacing: -0.022em;
        }
        .input:focus { border-color: var(--accent); box-shadow: 0 0 0 3.5px rgba(0,122,255,0.12); }
        .input::placeholder { color: var(--text-3); }

        /* ═══════════════════════════════════
           CUSTOM SELECT (Apple Style)
           ═══════════════════════════════════ */
        .aselect { position: relative; user-select: none; }

        .aselect-trigger {
            background: var(--bg);
            border: 1.5px solid transparent;
            border-radius: var(--radius);
            padding: 14px 40px 14px 16px;
            font-size: 16px;
            color: var(--text-1);
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
            position: relative;
            width: 100%;
            display: block;
            font-family: inherit;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            letter-spacing: -0.022em;
        }
        .aselect-trigger.placeholder { color: var(--text-3); }
        .aselect.open .aselect-trigger { border-color: var(--accent); box-shadow: 0 0 0 3.5px rgba(0,122,255,0.12); }

        .aselect-chevron {
            position: absolute; right: 14px; top: 50%;
            transform: translateY(-50%); pointer-events: none;
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-3);
        }
        .aselect.open .aselect-chevron { transform: translateY(-50%) rotate(180deg); }

        .aselect-dropdown {
            position: absolute; top: calc(100% + 6px); left: 0; right: 0;
            background: rgba(255,255,255,0.88);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border-radius: var(--radius);
            box-shadow: 0 4px 24px rgba(0,0,0,0.08), 0 1px 4px rgba(0,0,0,0.04), 0 0 0 0.5px rgba(0,0,0,0.03);
            z-index: 200;
            overflow: hidden;
            transform-origin: top center;
            animation: aselOpen 0.2s cubic-bezier(0.2, 0, 0, 1.1);
            max-height: 280px; overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .aselect-dropdown::-webkit-scrollbar { display: none; }

        @keyframes aselOpen {
            from { opacity: 0; transform: scaleY(0.92) translateY(-6px); }
            to { opacity: 1; transform: scaleY(1) translateY(0); }
        }

        .aselect-opt {
            padding: 13px 16px; font-size: 16px; cursor: pointer;
            transition: background 0.1s;
            display: flex; align-items: center; justify-content: space-between;
            font-family: inherit;
        }
        .aselect-opt:active { background: rgba(0,122,255,0.08); }
        .aselect-opt:hover { background: var(--bg); }
        .aselect-opt + .aselect-opt { border-top: 0.5px solid var(--border); }
        .aselect-opt.on { color: var(--accent); font-weight: 600; }
        .aselect-opt.on::after {
            content: '';
            width: 18px; height: 18px; flex-shrink: 0;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23007AFF' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E") center/contain no-repeat;
        }

        /* Compact selects for 3-col grid */
        .aselect-compact .aselect-trigger { padding: 12px 28px 12px 12px; font-size: 14px; }
        .aselect-compact .aselect-chevron { right: 10px; }

        /* ═══════════════════════════════════
           BUTTONS
           ═══════════════════════════════════ */
        .btn {
            border: none; border-radius: var(--radius); padding: 16px 24px;
            font-weight: 600; font-size: 17px; text-align: center; width: 100%;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit; display: flex; align-items: center; justify-content: center; gap: 8px;
            letter-spacing: -0.022em;
        }
        .btn:active { transform: scale(0.97); opacity: 0.85; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #0066D6; }
        .btn-dark { background: var(--text-1); color: white; }
        .btn-dark:hover { background: #333; }
        .btn-ghost { background: white; color: var(--text-2); box-shadow: 0 0 0 0.5px var(--separator); }
        .btn-ghost:hover { background: var(--bg); }

        /* Payment option cards — neutral by default, colored only when selected */
        .pay-opt {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; padding: 14px 16px; border-radius: var(--radius);
            background: var(--bg); border: 1.5px solid var(--border);
            color: var(--text-2); font-size: 15px; font-weight: 600;
            cursor: pointer; transition: all 0.2s; font-family: inherit; text-align: left;
        }
        .pay-opt:active { transform: scale(0.98); opacity: 0.9; }
        .pay-opt.on {
            background: var(--pay-bg-on); border-color: var(--pay-border-on); color: var(--pay-color);
        }
        .pay-opt::after {
            content: ''; width: 22px; height: 22px; border-radius: 50%; flex-shrink: 0;
            border: 2px solid var(--separator); transition: all 0.2s;
        }
        .pay-opt.on::after {
            border-color: var(--pay-color); background: var(--pay-color);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E");
            background-size: 12px; background-repeat: no-repeat; background-position: center;
        }

        /* ═══════════════════════════════════
           STEPS
           ═══════════════════════════════════ */
        .step { display: none; flex-direction: column; gap: 16px; }
        .step.active { display: flex; animation: enterStep 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes enterStep {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ═══════════════════════════════════
           LABELS
           ═══════════════════════════════════ */
        .label { font-size: 11px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-3); }
        .section-title { font-size: 13px; font-weight: 600; color: var(--text-2); letter-spacing: -0.01em; }

        /* ═══════════════════════════════════
           SEGMENTED CONTROL
           ═══════════════════════════════════ */
        .seg { display: flex; background: rgba(0,0,0,0.06); border-radius: 10px; padding: 2px; }
        .seg-btn {
            flex: 1; padding: 8px 4px; font-size: 13px; font-weight: 600; text-align: center;
            border-radius: 8px; color: var(--text-2); cursor: pointer; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none; border: none; background: none; font-family: inherit;
        }
        .seg-btn.on { color: var(--text-1); background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.08), 0 0.5px 1px rgba(0,0,0,0.04); }

        /* ═══════════════════════════════════
           STAGE (T-Shirt Preview)
           ═══════════════════════════════════ */
        .stage {
            background: linear-gradient(180deg, #F5F5F7 0%, #EEEEF0 100%);
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
        }
        .stage::after {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at 50% 90%, rgba(0,0,0,0.04) 0%, transparent 55%);
            pointer-events: none; border-radius: var(--radius);
        }

        /* ── Grille double t-shirt ── */
        .shirts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            align-items: start;
        }
        .shirt-col { display: flex; flex-direction: column; align-items: stretch; }
        .shirt-side-label {
            font-size: 10px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 1.5px; color: #86868b; text-align: center;
            margin-bottom: 5px; transition: color 0.15s;
        }
        .shirt-col.active .shirt-side-label { color: var(--accent); }

        /* svg-view : fluide, ratio t-shirt */
        .svg-view {
            position: relative;
            width: 100%;
            aspect-ratio: 5 / 6;
            overflow: hidden;
        }
        .svg-box {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .svg-box svg {
            height: 100%; width: auto; max-width: 100%;
            filter: drop-shadow(0 4px 18px rgba(0,0,0,0.09));
        }

        /* ── Sliders Y Apple-style ── */
        .y-sliders-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 6px;
            padding: 10px 2px 2px;
        }
        .y-slider-col { display: flex; flex-direction: column; gap: 5px; }
        .y-slider-label {
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1px; color: #86868b; text-align: center;
        }
        .y-slider {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 3px;
            background: rgba(0,0,0,0.13); border-radius: 2px;
            outline: none; cursor: pointer;
        }
        .y-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px; height: 24px;
            background: #fff; border-radius: 50%;
            box-shadow: 0 1px 6px rgba(0,0,0,0.22), 0 0 0 0.5px rgba(0,0,0,0.06);
            cursor: grab; transition: transform 0.1s;
        }
        .y-slider:active::-webkit-slider-thumb { transform: scale(1.15); cursor: grabbing; }
        .y-slider::-moz-range-thumb {
            width: 24px; height: 24px; background: #fff; border-radius: 50%;
            box-shadow: 0 1px 6px rgba(0,0,0,0.22); border: none; cursor: grab;
        }

        /* ═══════════════════════════════════
           LOGO ZONE (Keynote Interaction)
           ═══════════════════════════════════ */
        .logo-zone {
            position: absolute;
            transform: translate(-50%, -50%);
            display: flex; align-items: center; justify-content: center;
            z-index: 10;
            touch-action: none;
        }
        .logo-zone.empty { pointer-events: none; }
        .logo-zone.has-logo { cursor: move; }

        .logo-inner {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .logo-inner img, .logo-inner svg {
            max-width: 100%; max-height: 100%; object-fit: contain;
            filter: drop-shadow(0 1px 3px rgba(0,0,0,0.1));
            opacity: 0.92; mix-blend-mode: multiply;
        }

        /* Selection Frame (Keynote style) */
        .logo-frame {
            position: absolute; inset: -6px;
            border: 1.5px solid var(--accent);
            border-radius: 3px;
            pointer-events: none;
            display: none;
        }
        .logo-zone.selected .logo-frame { display: block; }

        /* Resize Handles */
        .logo-handle {
            position: absolute;
            width: 12px; height: 12px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.22), 0 0 0 0.5px rgba(0,122,255,0.4);
            border: 1.5px solid var(--accent);
            z-index: 11;
            display: none;
            touch-action: none;
        }
        .logo-zone.selected .logo-handle { display: block; }
        .logo-handle.nw { top: -12px; left: -12px; cursor: nwse-resize; }
        .logo-handle.ne { top: -12px; right: -12px; cursor: nesw-resize; }
        .logo-handle.sw { bottom: -12px; left: -12px; cursor: nesw-resize; }
        .logo-handle.se { bottom: -12px; right: -12px; cursor: nwse-resize; }

        /* ═══════════════════════════════════
           COLOR SWATCHES (iPhone Style)
           ═══════════════════════════════════ */
        .swatch-row { display: flex; flex-wrap: wrap; gap: 12px; }

        .swatch {
            width: 34px; height: 34px; border-radius: 50%;
            cursor: pointer; border: none; position: relative;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0; background: none; outline: none;
        }
        .swatch-fill {
            width: 100%; height: 100%; border-radius: 50%;
            box-shadow: inset 0 0 0 0.5px rgba(0,0,0,0.1);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .swatch:hover .swatch-fill { transform: scale(1.1); }
        .swatch:active .swatch-fill { transform: scale(0.92); }

        /* iPhone ring: outer ring with gap */
        .swatch::before {
            content: ''; position: absolute;
            inset: -4px; border-radius: 50%;
            border: 2px solid transparent;
            transition: border-color 0.25s ease;
        }
        .swatch.on::before { border-color: var(--accent); }
        .swatch.on .swatch-fill { transform: scale(0.82); }

        /* ═══════════════════════════════════
           LOGO COLOR PASTILLES
           ═══════════════════════════════════ */
        .pastille-row { display: flex; gap: 10px; flex-wrap: wrap; }

        .pastille {
            width: 28px; height: 28px; border-radius: 50%;
            cursor: pointer; border: none; position: relative;
            transition: transform 0.2s; padding: 0; background: none; outline: none;
        }
        .pastille-fill {
            width: 100%; height: 100%; border-radius: 50%;
            box-shadow: inset 0 0 0 0.5px rgba(0,0,0,0.12);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .pastille::before {
            content: ''; position: absolute; inset: -3px;
            border-radius: 50%; border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .pastille.on::before { border-color: var(--accent); }
        .pastille.on .pastille-fill { transform: scale(0.78); }

        /* ═══════════════════════════════════
           LOGO THUMBS
           ═══════════════════════════════════ */
        .lthumb {
            border-radius: var(--radius); padding: 14px; cursor: pointer;
            border: 2px solid transparent;
            background: rgba(0,0,0,0.02);
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none; min-height: 90px; justify-content: center;
        }
        .lthumb:hover { background: rgba(0,0,0,0.04); transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.06); }
        .lthumb:active { transform: scale(0.96); }
        .lthumb.on { border-color: var(--accent); background: rgba(0,122,255,0.04); box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
        .lthumb svg { width: 44px; height: 44px; }

        /* ═══════════════════════════════════
           UPLOAD
           ═══════════════════════════════════ */
        .upload-area {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            padding: 16px; border-radius: var(--radius);
            border: 1.5px dashed rgba(0,122,255,0.25);
            background: rgba(0,122,255,0.02); color: var(--accent);
            font-size: 15px; font-weight: 600; cursor: pointer;
            transition: all 0.25s; width: 100%;
        }
        .upload-area:hover { background: rgba(0,122,255,0.06); border-color: var(--accent); }
        .upload-area:active { transform: scale(0.98); }
        .upload-area .plus {
            width: 26px; height: 26px; border-radius: 50%;
            background: var(--accent); color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; line-height: 1;
        }

        .upload-pill {
            display: none; align-items: center; gap: 12px; padding: 10px 14px;
            border-radius: var(--radius); background: rgba(0,122,255,0.04);
            border: 1.5px solid rgba(0,122,255,0.12);
            animation: enterStep 0.3s ease;
        }
        .upload-pill.show { display: flex; }
        .upload-pill img { width: 44px; height: 44px; object-fit: contain; border-radius: 10px; background: white; padding: 3px; }
        .upload-pill .x {
            margin-left: auto; width: 26px; height: 26px; border-radius: 50%; flex-shrink: 0;
            background: rgba(255,59,48,0.06); color: var(--red);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-weight: 700; font-size: 15px; border: none; transition: background 0.2s;
        }
        .upload-pill .x:hover { background: rgba(255,59,48,0.14); }

        /* ═══════════════════════════════════
           SINGLE-LINE ORDER INFO (iCloud Style)
           ═══════════════════════════════════ */
        .order-line {
            display: flex;
            align-items: center;
            gap: 0;
            padding: 16px 20px;
            flex-wrap: wrap;
            row-gap: 8px;
        }
        .order-line-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        .order-line-item .oli-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }
        .order-line-item .oli-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-1);
            letter-spacing: -0.022em;
        }
        .order-line-item .oli-value.mono {
            font-family: 'SF Mono', 'Menlo', 'Monaco', monospace;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-2);
        }
        .order-line-sep {
            width: 3px; height: 3px;
            border-radius: 50%;
            background: var(--separator);
            margin: 0 12px;
            flex-shrink: 0;
        }
        .order-line-divider {
            width: 1px; height: 20px;
            background: var(--separator);
            margin: 0 16px;
            flex-shrink: 0;
            opacity: 0.6;
        }

        /* Editable inline fields */
        .oli-input {
            background: transparent;
            border: none;
            border-bottom: 1.5px solid transparent;
            outline: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-1);
            letter-spacing: -0.022em;
            font-family: inherit;
            padding: 2px 0;
            transition: border-color 0.2s;
            width: 120px;
        }
        .oli-input::placeholder { color: var(--text-3); font-weight: 500; }
        .oli-input:focus { border-bottom-color: var(--accent); }
        .oli-input.phone { width: 130px; }

        /* ═══════════════════════════════════
           RESPONSIVE
           ═══════════════════════════════════ */
        @media (min-width: 768px) {
            /* svg-view sizing now via aspect-ratio, no override needed */
        }

        ::-webkit-scrollbar { width: 0; }

        /* ── Apple Success Overlay ── */
        @keyframes sfOverlayIn {
            from { opacity: 0; }
            to   { opacity: 1; }
        }
        @keyframes sfCardIn {
            from { opacity: 0; transform: scale(.86) translateY(32px); }
            to   { opacity: 1; transform: scale(1)  translateY(0); }
        }
        @keyframes sfCheckDraw {
            to { stroke-dashoffset: 0; }
        }
        @keyframes sfCheckBg {
            0%   { transform: scale(.6); opacity: 0; }
            60%  { transform: scale(1.12); opacity: 1; }
            100% { transform: scale(1); }
        }
        #successOverlay { display:none; }
        #successOverlay.sf-on {
            display: flex;
            position: fixed; inset: 0; z-index: 9999;
            align-items: center; justify-content: center;
            background: rgba(0,0,0,.52);
            backdrop-filter: blur(28px); -webkit-backdrop-filter: blur(28px);
            animation: sfOverlayIn .22s ease;
        }
        #successCard {
            background: #fff; border-radius: 28px;
            padding: 48px 36px 36px; width: min(370px, 92vw);
            text-align: center;
            box-shadow: 0 48px 120px rgba(0,0,0,.38);
            animation: sfCardIn .42s cubic-bezier(.34,1.44,.64,1);
        }
        .sf-check-circle {
            width: 80px; height: 80px; border-radius: 50%;
            background: #34C759; margin: 0 auto 24px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 28px rgba(52,199,89,.38);
            animation: sfCheckBg .42s cubic-bezier(.34,1.44,.64,1);
        }
        .sf-check-path {
            stroke-dasharray: 52; stroke-dashoffset: 52;
            animation: sfCheckDraw .5s .25s cubic-bezier(.4,0,.2,1) forwards;
        }
        .sf-btn-primary {
            width: 100%; background: #007AFF; color: #fff;
            border: none; border-radius: 14px; padding: 16px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            margin-bottom: 10px; font-family: inherit;
            transition: opacity .15s;
        }
        .sf-btn-primary:active { opacity: .8; }
        .sf-btn-secondary {
            width: 100%; background: #F2F2F7; color: #1A1A1A;
            border: none; border-radius: 14px; padding: 16px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            font-family: inherit; transition: opacity .15s;
        }
        .sf-btn-secondary:active { opacity: .6; }
    </style>
</head>
<body>

<div class="max-w-lg mx-auto px-5 pt-6 pb-16">

    <!-- ════════════════════════════════════════
         HEADER
         ════════════════════════════════════════ -->
    <header class="mb-4">
        <p class="text-[11px] font-semibold text-gray-400 uppercase tracking-[0.2em]" id="hLabel">Etape 1 sur 3</p>
        <h1 class="text-[34px] font-black tracking-tight text-gray-900 leading-tight mt-1" id="hTitle">Client</h1>
        <span id="hNum" class="hidden">1</span>
        <div class="mt-5 h-[2px] bg-gray-200 rounded-full overflow-hidden">
            <div class="h-full bg-blue-600 rounded-full transition-all duration-500" id="hBar" style="width:33.33%"></div>
        </div>
    </header>

    <!-- ════════════════════════════════════════
         STEP 1 — CLIENT  (A: Commande, B: Date, C: Nom, D: Telephone)
         Single-line iCloud/Apple Business style
         ════════════════════════════════════════ -->
    <div id="s1" class="step active mt-8">
        <div class="bg-white rounded-[32px] px-8 pt-9 pb-8" style="box-shadow:0 2px 16px rgba(0,0,0,0.04);">

            <!-- N° de série (auto: Année–date–client) -->
            <div class="flex items-baseline">
                <span class="w-[70px] shrink-0 text-[13px] font-medium text-gray-400 uppercase tracking-wide">N&deg;</span>
                <span class="text-[15px] font-semibold text-gray-900 tracking-tight" id="orderNo">&mdash;</span>
            </div>

            <!-- Point median separator -->
            <div class="py-1.5 pl-[70px]">
                <span class="text-gray-300 text-[10px]">&bull;</span>
            </div>

            <!-- DATE -->
            <div class="flex items-baseline">
                <span class="w-[70px] shrink-0 text-[13px] font-medium text-gray-400 uppercase tracking-wide">DATE</span>
                <span class="text-[15px] font-semibold text-gray-900" id="orderDate">15/02/2026</span>
            </div>

            <!-- Separator -->
            <div class="mt-6 mb-6 h-px bg-gray-100"></div>

            <!-- CLIENT -->
            <div class="flex items-center mb-6">
                <span class="w-[70px] shrink-0 text-[13px] font-medium text-gray-400 uppercase tracking-wide">CLIENT</span>
                <input type="text" id="clientName"
                       class="flex-1 bg-transparent appearance-none rounded-none outline-none border-0 text-[15px] font-semibold text-gray-900 tracking-tight py-1.5 placeholder:text-gray-300 placeholder:font-normal focus:ring-0"
                       placeholder="Nom du client">
            </div>

            <!-- TEL -->
            <div class="flex items-center gap-2">
                <span class="w-[70px] shrink-0 text-[13px] font-medium text-gray-400 uppercase tracking-wide">TEL</span>
                <select id="countryCode"
                        class="shrink-0 bg-gray-100 rounded-lg text-[12px] font-semibold text-gray-600 border-0 outline-none focus:ring-0 cursor-pointer py-1 px-2 appearance-none">
                    <option value="+590" selected>+590</option>
                    <option value="+33">+33</option>
                    <option value="+1">+1</option>
                </select>
                <input type="tel" id="clientPhone"
                       class="flex-1 bg-transparent appearance-none rounded-none outline-none border-0 text-[15px] font-semibold text-gray-900 tracking-tight py-1.5 placeholder:text-gray-300 placeholder:font-normal focus:ring-0"
                       placeholder="06 00 00 00 00">
            </div>

        </div>

        <!-- Bouton Continuer -->
        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold text-[17px] py-4 rounded-[22px] mt-5 active:scale-95 transition-all cursor-pointer" onclick="go(2)">
            Continuer
        </button>
    </div>

    <!-- ════════════════════════════════════════
         STEP 2 — CONFIGURATEUR
         (E: Collection, F: Reference, G: Taille, H: Couleur T-shirt,
          I: Motif Logo Av, J: Motif Logo Ar, K: Logo Arriere, L: Note)
         ════════════════════════════════════════ -->
    <div id="s2" class="step mt-6">

        <!-- Stage — grille double t-shirt -->
        <div class="stage p-4">

            <!-- Grille invisible : 2 colonnes parfaitement alignées -->
            <div class="shirts-grid" id="shirtsGrid">

                <!-- ── Avant ── -->
                <div class="shirt-col active" id="colFront" onclick="flipSide('front')">
                    <p class="shirt-side-label">Avant</p>
                    <div class="svg-view" id="svgViewFront">
                        <div class="svg-box" id="svgBoxFront"></div>
                        <div class="logo-zone empty" id="logoZoneFront" data-side="front"
                             style="left:50%;top:42%;width:24%;height:17%;">
                            <div class="logo-inner" id="logoInnerFront"></div>
                            <div class="logo-frame"></div>
                            <div class="logo-handle nw" data-corner="nw"></div>
                            <div class="logo-handle ne" data-corner="ne"></div>
                            <div class="logo-handle sw" data-corner="sw"></div>
                            <div class="logo-handle se" data-corner="se"></div>
                        </div>
                    </div>
                </div>

                <!-- ── Arrière ── -->
                <div class="shirt-col" id="colBack" onclick="flipSide('back')">
                    <p class="shirt-side-label">Arrière</p>
                    <div class="svg-view" id="svgViewBack">
                        <div class="svg-box" id="svgBoxBack"></div>
                        <div class="logo-zone empty" id="logoZoneBack" data-side="back"
                             style="left:50%;top:42%;width:24%;height:17%;">
                            <div class="logo-inner" id="logoInnerBack"></div>
                            <div class="logo-frame"></div>
                            <div class="logo-handle nw" data-corner="nw"></div>
                            <div class="logo-handle ne" data-corner="ne"></div>
                            <div class="logo-handle sw" data-corner="sw"></div>
                            <div class="logo-handle se" data-corner="se"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sliders Y Apple-style -->
            <div class="y-sliders-grid">
                <div class="y-slider-col">
                    <span class="y-slider-label">Hauteur Av</span>
                    <input type="range" class="y-slider" id="sliderFrontY" min="15" max="85" value="42">
                </div>
                <div class="y-slider-col">
                    <span class="y-slider-label">Hauteur Ar</span>
                    <input type="range" class="y-slider" id="sliderBackY" min="15" max="85" value="42">
                </div>
            </div>

            <p class="text-center mt-3 text-[13px] font-semibold" style="color:var(--text-2)" id="colorName">Blanc</p>
        </div>

        <!-- Collection -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Collection</label>
            <div class="aselect" id="selCollection"></div>
        </div>

        <!-- Reference (dropdown: H-001, F-001...) -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Reference</label>
            <div class="aselect" id="selRef"></div>
        </div>

        <!-- Taille -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Taille</label>
            <div class="aselect" id="selSize"></div>
        </div>

        <!-- Couleur du t-shirt -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Couleur du t-shirt</label>
            <div class="aselect" id="selColor"></div>
        </div>

        <!-- Motif Logo -->
        <div class="card p-5">
            <div class="flex items-center justify-between mb-2">
                <p class="label mb-0" id="logoSectionLabel">Design Logo Av</p>
                <button style="border:none;background:none;cursor:pointer;font-size:12px;font-weight:600;color:var(--accent);font-family:inherit;" onclick="dropLogo()">Retirer</button>
            </div>
            <div class="aselect" id="selLogo"></div>
        </div>

        <!-- Couleur du logo -->
        <div class="card p-5" id="logoColorSection" style="display:none;">
            <label class="label ml-1 mb-2 block">Couleur du logo</label>
            <div class="aselect" id="selLogoColor"></div>
        </div>

        <!-- Upload -->
        <div class="card p-5">
            <p class="label mb-3">Mon Logo</p>
            <label class="upload-area" id="uploadArea">
                <span class="plus">+</span>
                <span>Ajouter mon logo</span>
                <input type="file" accept="image/png,image/jpeg,image/svg+xml,image/webp" class="hidden" id="fileIn" onchange="onUpload(event)">
            </label>
            <div class="upload-pill mt-3" id="upPill">
                <img id="upThumb" src="" alt="">
                <div style="min-width:0">
                    <p class="text-[13px] font-semibold truncate" id="upName">logo.png</p>
                    <p class="text-[11px]" style="color:var(--text-3)">Personnalise</p>
                </div>
                <button class="x" onclick="rmUpload()">x</button>
            </div>
        </div>

        <!-- Note -->
        <div class="card p-5">
            <p class="label mb-3">Note</p>
            <textarea id="note" class="input" rows="2" placeholder="Commentaires specifiques..."></textarea>
        </div>

        <div class="flex gap-3">
            <button class="btn btn-ghost" onclick="go(1)" style="flex:0 0 auto;width:auto;padding:16px 20px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="btn btn-primary" onclick="go(3)" style="flex:1;">Paiement</button>
        </div>
    </div>

    <!-- ════════════════════════════════════════
         STEP 3 — PAIEMENT
         (M: Prix T-shirt, N: Personnalisation, O: Total, P: Paye, Q: Fiche)
         ════════════════════════════════════════ -->
    <div id="s3" class="step mt-6">
        <div class="card p-6 space-y-5">
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center">
                    <p class="label mb-2">T-Shirt</p>
                    <input type="number" id="price" class="input text-center font-bold text-lg" value="25" oninput="calcTotal()">
                </div>
                <div class="text-center">
                    <p class="label mb-2">Personnalisation</p>
                    <input type="number" id="customPrice" class="input text-center font-bold text-lg" value="0" oninput="calcTotal()">
                </div>
            </div>
            <div class="py-5 border-y text-center" style="border-color:var(--separator)">
                <p class="text-[56px] font-black tracking-tighter leading-none" id="totalLabel">25 &euro;</p>
            </div>
            <div>
                <p class="label mb-3 text-center">Statut du paiement</p>
                <div class="space-y-2" id="payStatus">
                    <button class="pay-opt on" data-p="non" onclick="setPay('non')"
                        style="--pay-color:#FF3B30;--pay-bg:rgba(255,59,48,0.04);--pay-border:rgba(255,59,48,0.12);--pay-bg-on:rgba(255,59,48,0.08);--pay-border-on:rgba(255,59,48,0.35);">
                        A regler
                    </button>
                    <button class="pay-opt" data-p="oui" onclick="setPay('oui')"
                        style="--pay-color:#34C759;--pay-bg:rgba(52,199,89,0.04);--pay-border:rgba(52,199,89,0.12);--pay-bg-on:rgba(52,199,89,0.08);--pay-border-on:rgba(52,199,89,0.35);">
                        Paye
                    </button>
                </div>
            </div>
        </div>
        <div class="flex gap-3">
            <button class="btn btn-ghost" onclick="go(2)" style="flex:0 0 auto;width:auto;padding:16px 20px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="btn btn-dark" id="subBtn" onclick="submit()" style="flex:1;">Valider la Commande</button>
        </div>
    </div>

</div>

<!-- ═══════════════════════════════════════════
     APPLE SUCCESS OVERLAY
════════════════════════════════════════════ -->
<div id="successOverlay">
    <div id="successCard">
        <div class="sf-check-circle">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                <path class="sf-check-path"
                      d="M10 21L17 28L30 13"
                      stroke="white" stroke-width="3.4"
                      stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <p style="font-size:24px;font-weight:700;color:#1A1A1A;margin:0 0 6px;letter-spacing:-.4px;">Commande envoyée</p>
        <p id="sfOrderNo" style="font-size:13px;color:#8E8E93;margin:0 0 10px;letter-spacing:.3px;font-variant-numeric:tabular-nums;"></p>
        <p id="sfClientName" style="font-size:15px;color:#3A3A3C;margin:0 0 30px;font-weight:500;"></p>
        <button id="sfFicheBtn" class="sf-btn-primary">Voir la fiche atelier &rsaquo;</button>
        <button class="sf-btn-secondary" onclick="location.reload()">Nouvelle commande</button>
    </div>
</div>

<canvas id="exportCanvas" width="800" height="1100" class="hidden"></canvas>

<script>
(function(){
'use strict';

/* ══════════════════════════════════════
   CONFIG
   ══════════════════════════════════════ */
const API = "https://script.google.com/macros/s/AKfycbyzeU0tD22L8wZ94PW0f4s1a2LH7fNPhK74RtjcIXs0pWAP59anDV8EYtYlP8WX5iCk/exec";

const COLORS = [
    {n:'Blanc',h:'#FFFFFF'},{n:'Ivoire',h:'#FAF3E8'},{n:'Gris',h:'#C7C7CC'},{n:'Anthracite',h:'#4A4A4A'},
    {n:'Noir',h:'#1A1A1A'},{n:'Marine',h:'#00205B'},{n:'Bleu',h:'#007AFF'},{n:'Ciel',h:'#64D2FF'},
    {n:'Rouge',h:'#FF3B30'},{n:'Bordeaux',h:'#8B1A2B'},{n:'Vert',h:'#34C759'},{n:'Sauge',h:'#8DA67E'},
    {n:'Jaune',h:'#FFCC00'},{n:'Orange',h:'#FF9500'},{n:'Rose',h:'#FF6482'},{n:'Lavande',h:'#BDB5D5'}
];

const LOGO_COLORS = [
    {n:'Noir',h:'#1A1A1A'},{n:'Blanc',h:'#FFFFFF'},{n:'Marine',h:'#00205B'},
    {n:'Rouge',h:'#FF3B30'},{n:'Or',h:'#C5A44E'},{n:'Argent',h:'#A8A8A8'}
];

const FABRIC_RE = /rgb\(100%,\s*100%,\s*100%\)/gi;

const LOGOS = {
    bea:[
        {id:'bea-1',n:'Classic',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><circle cx="60" cy="60" r="50" stroke="#1A1A1A" stroke-width="3" fill="none"/><text x="60" y="52" text-anchor="middle" font-size="28" font-weight="800" fill="#1A1A1A" font-family="sans-serif">BEA</text><text x="60" y="74" text-anchor="middle" font-size="12" font-weight="600" fill="#1A1A1A" letter-spacing="4" font-family="sans-serif">ATELIER</text><line x1="28" y1="82" x2="92" y2="82" stroke="#1A1A1A" stroke-width="1.5"/><text x="60" y="98" text-anchor="middle" font-size="10" fill="#1A1A1A" font-family="sans-serif">— 16 —</text></svg>`},
        {id:'bea-2',n:'Minimal',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><rect x="15" y="25" width="90" height="70" rx="4" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><text x="60" y="60" text-anchor="middle" font-size="32" font-weight="900" fill="#1A1A1A" font-family="sans-serif">B</text><text x="60" y="82" text-anchor="middle" font-size="9" font-weight="600" fill="#1A1A1A" letter-spacing="6" font-family="sans-serif">BEAUTE</text></svg>`},
        {id:'bea-3',n:'Script',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><text x="60" y="55" text-anchor="middle" font-family="Georgia,serif" font-size="36" font-style="italic" font-weight="700" fill="#1A1A1A">Bea</text><line x1="20" y1="65" x2="100" y2="65" stroke="#1A1A1A" stroke-width="1"/><text x="60" y="82" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="5" font-family="sans-serif">COLLECTION 16</text></svg>`}
    ],
    sxm:[
        {id:'sxm-1',n:'Island',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><path d="M60 15 L95 45 L85 95 L35 95 L25 45 Z" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><text x="60" y="58" text-anchor="middle" font-size="22" font-weight="900" fill="#1A1A1A" font-family="sans-serif">SXM</text><text x="60" y="76" text-anchor="middle" font-size="9" font-weight="500" fill="#1A1A1A" letter-spacing="3" font-family="sans-serif">ISLAND</text><text x="60" y="90" text-anchor="middle" font-size="8" fill="#1A1A1A" font-family="sans-serif">— 12 —</text></svg>`},
        {id:'sxm-2',n:'Wave',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><text x="60" y="50" text-anchor="middle" font-size="30" font-weight="900" fill="#1A1A1A" font-family="sans-serif">SXM</text><path d="M20 65 Q35 55 50 65 Q65 75 80 65 Q95 55 100 65" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><path d="M20 78 Q35 68 50 78 Q65 88 80 78 Q95 68 100 78" stroke="#1A1A1A" stroke-width="1.5" fill="none" opacity="0.5"/><text x="60" y="100" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="4" font-family="sans-serif">SAINT-MARTIN</text></svg>`},
        {id:'sxm-3',n:'Geo',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><circle cx="60" cy="55" r="35" stroke="#1A1A1A" stroke-width="2" fill="none"/><circle cx="60" cy="55" r="25" stroke="#1A1A1A" stroke-width="1.5" fill="none" opacity="0.4"/><text x="60" y="62" text-anchor="middle" font-size="18" font-weight="800" fill="#1A1A1A" font-family="sans-serif">SXM</text><text x="60" y="105" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="3" font-family="sans-serif">12 — CARAIBES</text></svg>`}
    ],
    cor:[
        {id:'cor-1',n:'Shield',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><path d="M60 18 L95 35 L95 70 Q95 95 60 108 Q25 95 25 70 L25 35 Z" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><text x="60" y="62" text-anchor="middle" font-size="20" font-weight="900" fill="#1A1A1A" font-family="sans-serif">COR</text><text x="60" y="80" text-anchor="middle" font-size="9" font-weight="500" fill="#1A1A1A" letter-spacing="2" font-family="sans-serif">— 01 —</text></svg>`},
        {id:'cor-2',n:'Typo',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><text x="60" y="45" text-anchor="middle" font-size="40" font-weight="900" fill="#1A1A1A" font-family="sans-serif">C</text><line x1="25" y1="55" x2="95" y2="55" stroke="#1A1A1A" stroke-width="2"/><text x="60" y="72" text-anchor="middle" font-size="11" font-weight="600" fill="#1A1A1A" letter-spacing="8" font-family="sans-serif">CORSICA</text><text x="60" y="92" text-anchor="middle" font-size="9" font-weight="500" fill="#1A1A1A" font-family="sans-serif">Edition 01</text></svg>`},
        {id:'cor-3',n:'Crest',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><ellipse cx="60" cy="58" rx="42" ry="45" stroke="#1A1A1A" stroke-width="2" fill="none"/><ellipse cx="60" cy="58" rx="35" ry="38" stroke="#1A1A1A" stroke-width="1" fill="none" opacity="0.3"/><text x="60" y="55" text-anchor="middle" font-family="Georgia,serif" font-size="22" font-weight="700" font-style="italic" fill="#1A1A1A">Cor</text><text x="60" y="72" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="5" font-family="sans-serif">PREMIERE</text><circle cx="60" cy="85" r="3" fill="#1A1A1A"/></svg>`}
    ]
};

/* ── State ── */
let color = COLORS[0];
let side  = 'front';
let svgF  = null;
let svgB  = null;

/* Per-side logo state (J: Logo Avant, K: Logo Arriere) — logoColor per side */
const logos = {
    front: { data: null, x: 50, y: 42, w: 24, h: 17, logoColor: '#1A1A1A' },
    back:  { data: null, x: 50, y: 42, w: 24, h: 17, logoColor: '#1A1A1A' }
};
function cl() { return logos[side]; }

let logoSelected = false;
let dragState = null;
let payStatus = 'non';

/* Custom selects registry */
const selects = {};

/* ══════════════════════════════════════
   CUSTOM SELECT COMPONENT
   ══════════════════════════════════════ */
const CHEVRON_SVG = `<svg class="aselect-chevron" width="12" height="8" viewBox="0 0 12 8" fill="none"><path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;

function createSelect(containerId, options, placeholder, onChange) {
    const container = document.getElementById(containerId);
    const state = { value: '', label: '', onChange: onChange || (() => {}) };

    function render() {
        const isPlaceholder = !state.value;
        container.innerHTML = `
            <div class="aselect-trigger ${isPlaceholder ? 'placeholder' : ''}">${isPlaceholder ? placeholder : state.label}</div>
            ${CHEVRON_SVG}
        `;
        container.querySelector('.aselect-trigger').addEventListener('click', toggle);
    }

    function toggle(e) {
        e.stopPropagation();
        const wasOpen = container.classList.contains('open');
        closeAllSelects();
        if (wasOpen) return;
        container.classList.add('open');

        const dd = document.createElement('div');
        dd.className = 'aselect-dropdown';
        options.forEach(o => {
            if (o.v === '' && o.l === placeholder) return;
            const opt = document.createElement('div');
            opt.className = 'aselect-opt' + (o.v === state.value ? ' on' : '');
            opt.textContent = o.l;
            opt.addEventListener('click', (ev) => {
                ev.stopPropagation();
                state.value = o.v;
                state.label = o.l;
                container.classList.remove('open');
                render();
                state.onChange(o.v);
            });
            dd.appendChild(opt);
        });
        container.appendChild(dd);
    }

    render();
    selects[containerId] = state;
    return state;
}

function closeAllSelects() {
    document.querySelectorAll('.aselect').forEach(s => {
        s.classList.remove('open');
        const dd = s.querySelector('.aselect-dropdown');
        if (dd) dd.remove();
    });
}

function updateSelectOptions(containerId, newOptions, placeholder) {
    const container = document.getElementById(containerId);
    const state = selects[containerId];
    if (!state) return;
    state.value = '';
    state.label = '';

    function renderTrigger() {
        const isPlaceholder = !state.value;
        container.innerHTML = `
            <div class="aselect-trigger ${isPlaceholder ? 'placeholder' : ''}">${isPlaceholder ? placeholder : state.label}</div>
            ${CHEVRON_SVG}
        `;
        container.querySelector('.aselect-trigger').addEventListener('click', toggleDD);
    }

    function toggleDD(e) {
        e.stopPropagation();
        const wasOpen = container.classList.contains('open');
        closeAllSelects();
        if (wasOpen) return;
        container.classList.add('open');

        const dd = document.createElement('div');
        dd.className = 'aselect-dropdown';
        newOptions.forEach(o => {
            const opt = document.createElement('div');
            opt.className = 'aselect-opt' + (o.v === state.value ? ' on' : '');
            opt.textContent = o.l;
            opt.addEventListener('click', (ev) => {
                ev.stopPropagation();
                state.value = o.v;
                state.label = o.l;
                container.classList.remove('open');
                renderTrigger();
                state.onChange(o.v);
            });
            dd.appendChild(opt);
        });
        container.appendChild(dd);
    }

    renderTrigger();
}

/* ══════════════════════════════════════
   RICH SELECT (with HTML options)
   ══════════════════════════════════════ */
function colorDotHtml(hex, name) {
    return '<div style="display:flex;align-items:center;gap:10px;pointer-events:none;"><div style="width:22px;height:22px;border-radius:50%;background:' + hex + ';box-shadow:inset 0 0 0 0.5px rgba(0,0,0,0.12);flex-shrink:0;"></div><span>' + name + '</span></div>';
}

function createRichSelect(containerId, options, placeholder, onChange) {
    const container = document.getElementById(containerId);
    if (!container) return null;
    const state = { value: '', label: '', _html: '', onChange: onChange || (() => {}), _options: options };

    function renderTrigger() {
        const isP = !state.value;
        container.innerHTML = '<div class="aselect-trigger ' + (isP ? 'placeholder' : '') + '">' + (isP ? placeholder : (state._html || state.label)) + '</div>' + CHEVRON_SVG;
        container.querySelector('.aselect-trigger').addEventListener('click', toggle);
    }

    function toggle(e) {
        e.stopPropagation();
        const wasOpen = container.classList.contains('open');
        closeAllSelects();
        if (wasOpen) return;
        container.classList.add('open');
        const dd = document.createElement('div');
        dd.className = 'aselect-dropdown';
        state._options.forEach(o => {
            const opt = document.createElement('div');
            opt.className = 'aselect-opt' + (o.v === state.value ? ' on' : '');
            if (o.html) { opt.innerHTML = o.html; } else { opt.textContent = o.l; }
            opt.addEventListener('click', ev => {
                ev.stopPropagation();
                state.value = o.v; state.label = o.l; state._html = o.trigger || o.html || '';
                container.classList.remove('open');
                renderTrigger();
                state.onChange(o.v);
            });
            dd.appendChild(opt);
        });
        container.appendChild(dd);
    }

    state.reset = function() { state.value = ''; state.label = ''; state._html = ''; renderTrigger(); };
    state.setValue = function(v) {
        const o = state._options.find(x => x.v === v);
        if (o) { state.value = o.v; state.label = o.l; state._html = o.trigger || o.html || ''; renderTrigger(); }
    };

    renderTrigger();
    selects[containerId] = state;
    return state;
}

/* ══════════════════════════════════════
   INIT
   ══════════════════════════════════════ */
document.addEventListener('DOMContentLoaded', async () => {
    const d = new Date();
    const orderDateVal = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
    document.getElementById('orderDate').textContent = orderDateVal;
    updateSerial();

    // Build custom selects
    createSelect('selCollection',
        [{v:'Homme',l:'Homme'},{v:'Femme',l:'Femme'},{v:'Enfant',l:'Enfant'},{v:'Accessoire',l:'Accessoire'}],
        'Collection',
        (val) => buildRefs()
    );
    createSelect('selRef', [], 'Reference', () => {});
    createSelect('selSize',
        [{v:'S',l:'S'},{v:'M',l:'M'},{v:'L',l:'L'},{v:'XL',l:'XL'},{v:'XXL',l:'XXL'}],
        'Taille',
        () => {}
    );
    selects['selSize'].value = 'S';
    selects['selSize'].label = 'S';
    document.querySelector('#selSize .aselect-trigger').textContent = 'S';
    document.querySelector('#selSize .aselect-trigger').classList.remove('placeholder');

    // Color dropdown (replaces swatches)
    createRichSelect('selColor',
        COLORS.map(c => ({ v: c.h, l: c.n, html: colorDotHtml(c.h, c.n), trigger: colorDotHtml(c.h, c.n) })),
        'Couleur',
        (val) => {
            const c = COLORS.find(x => x.h === val);
            if (c) { color = c; const g = document.getElementById('shirtsGrid'); g.style.opacity='0'; g.style.transform='scale(0.97)'; g.style.transition='opacity 0.18s,transform 0.18s'; setTimeout(() => { renderSVG(); g.style.opacity=''; g.style.transform=''; }, 180); }
        }
    );
    selects['selColor'].setValue(COLORS[0].h);

    // Logo dropdown (all ateliers in one list)
    const _logoOpts = [];
    Object.entries(LOGOS).forEach(([k, arr]) => {
        const gn = k === 'bea' ? 'BEA-16' : k === 'sxm' ? 'SXM-12' : 'COR-01';
        arr.forEach(l => _logoOpts.push({ v: l.id, l: gn + ' \u2014 ' + l.n }));
    });
    createRichSelect('selLogo', _logoOpts, 'Choisir un design', (val) => {
        let found = null;
        Object.values(LOGOS).forEach(arr => arr.forEach(l => { if (l.id === val) found = l; }));
        if (found) {
            const cur = cl();
            cur.data = { type: 'atelier', id: found.id, s: found.s };
            showLogoColorSection(true);
            cur.x = 50; cur.y = 42; cur.w = 24; cur.h = 17;
            document.getElementById('upPill').classList.remove('show');
            document.getElementById('uploadArea').style.display = 'flex';
            document.getElementById('fileIn').value = '';
            renderLogo();
        }
    });

    // Logo color dropdown (replaces pastilles)
    createRichSelect('selLogoColor',
        LOGO_COLORS.map(c => ({ v: c.h, l: c.n, html: colorDotHtml(c.h, c.n), trigger: colorDotHtml(c.h, c.n) })),
        'Couleur du logo',
        (val) => { cl().logoColor = val; renderLogo(); }
    );
    selects['selLogoColor'].setValue(LOGO_COLORS[0].h);

    initLogoInteraction();

    // Live serial number update when client name changes
    document.getElementById('clientName').addEventListener('input', updateSerial);

    // Close selects on outside click
    document.addEventListener('click', () => closeAllSelects());

    try {
        const [f, b] = await Promise.all([
            fetch('tshirt-front.svg').then(r => r.text()),
            fetch('tshirt-back.svg').then(r => r.text())
        ]);
        svgF = f; svgB = b;
    } catch(e) { console.error(e); }

    renderSVG();
});

/* ══════════════════════════════════════
   NAVIGATION
   ══════════════════════════════════════ */
const TITLES = ['Client','Configurateur','Paiement'];

window.go = function(n) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('s'+n).classList.add('active');
    document.getElementById('hTitle').textContent = TITLES[n-1];
    document.getElementById('hLabel').textContent = `Etape ${n} sur 3`;
    document.getElementById('hNum').textContent = n;
    document.getElementById('hBar').style.width = (n/3*100)+'%';
    if (n === 2) updateSerial();
    window.scrollTo({top:0,behavior:'smooth'});
};

/* ══════════════════════════════════════
   SERIAL NUMBER (26-mmdd-client)
   ══════════════════════════════════════ */
function updateSerial() {
    const d = new Date();
    const yy   = String(d.getFullYear()).slice(-2);
    const mmdd = String(d.getMonth()+1).padStart(2,'0') + String(d.getDate()).padStart(2,'0');
    const raw  = (document.getElementById('clientName').value || '').trim();
    const name = raw.replace(/\s+/g, '-');
    const el = document.getElementById('orderNo');
    if (name) {
        el.textContent = yy + '-' + mmdd + '-' + name;
    } else {
        el.textContent = yy + '-' + mmdd + '-...';
    }
}

/* ══════════════════════════════════════
   REFS (H-001, F-001, E-001, A-001...)
   ══════════════════════════════════════ */
window.buildRefs = function() {
    const c = selects['selCollection'] ? selects['selCollection'].value : '';
    const opts = [];
    if (c) {
        const prefix = c[0].toUpperCase();
        for (let i = 1; i <= 5; i++) {
            const code = prefix + '-' + String(i).padStart(3,'0');
            opts.push({v: code, l: code});
        }
    }
    updateSelectOptions('selRef', opts, 'Reference');
};

/* ══════════════════════════════════════
   SVG RENDERING
   ══════════════════════════════════════ */
function renderSide(s) {
    const raw = s === 'front' ? svgF : svgB;
    const box = document.getElementById(s === 'front' ? 'svgBoxFront' : 'svgBoxBack');
    if (!box) return;
    if (!raw) { box.innerHTML = ''; return; }
    box.innerHTML = raw.replace(FABRIC_RE, color.h);
    const el = box.querySelector('svg');
    if (el) {
        el.removeAttribute('width');
        el.removeAttribute('height');
        el.setAttribute('preserveAspectRatio', 'xMidYMid meet');
    }
    renderLogoForSide(s);
}

function renderSVG() {
    renderSide('front');
    renderSide('back');
    document.getElementById('colorName').textContent = color.n;
}

function renderLogoForSide(s) {
    const cur = logos[s];
    const zoneId = s === 'front' ? 'logoZoneFront' : 'logoZoneBack';
    const innerId = s === 'front' ? 'logoInnerFront' : 'logoInnerBack';
    const zone  = document.getElementById(zoneId);
    const inner = document.getElementById(innerId);
    if (!zone || !inner) return;

    // Position toujours à jour
    zone.style.left   = cur.x + '%';
    zone.style.top    = cur.y + '%';
    zone.style.width  = cur.w + '%';
    zone.style.height = cur.h + '%';

    if (!cur.data) {
        inner.innerHTML = '';
        zone.classList.add('empty');
        zone.classList.remove('has-logo', 'selected');
        return;
    }
    zone.classList.remove('empty');
    zone.classList.add('has-logo');
    if (cur.data.type === 'atelier') {
        inner.innerHTML = cur.data.s.replace(/#1A1A1A/gi, cur.logoColor || '#1A1A1A');
    } else {
        inner.innerHTML = `<img src="${cur.data.url}" alt="">`;
    }
}

/* renderLogo — appelé pour rafraîchir les deux côtés */
function renderLogo() {
    renderLogoForSide('front');
    renderLogoForSide('back');
}

function updateLogoPositionForSide(s) {
    const cur  = logos[s];
    const zone = document.getElementById(s === 'front' ? 'logoZoneFront' : 'logoZoneBack');
    if (!zone) return;
    zone.style.left   = cur.x + '%';
    zone.style.top    = cur.y + '%';
    zone.style.width  = cur.w + '%';
    zone.style.height = cur.h + '%';
    // Sync slider Y
    const slider = document.getElementById(s === 'front' ? 'sliderFrontY' : 'sliderBackY');
    if (slider) slider.value = cur.y;
}

function updateLogoPosition() {
    updateLogoPositionForSide('front');
    updateLogoPositionForSide('back');
}

/* ══════════════════════════════════════
   SYNC LOGO UI (on side flip)
   ══════════════════════════════════════ */
function syncLogoUI() {
    const cur = cl();
    // Update logo dropdown
    if (cur.data && cur.data.type === 'atelier') {
        if (selects['selLogo'] && selects['selLogo'].setValue) selects['selLogo'].setValue(cur.data.id);
        showLogoColorSection(true);
    } else {
        if (selects['selLogo'] && selects['selLogo'].reset) selects['selLogo'].reset();
        showLogoColorSection(false);
    }
    // Restore per-side logo color
    if (selects['selLogoColor'] && selects['selLogoColor'].setValue) {
        selects['selLogoColor'].setValue(cur.logoColor || '#1A1A1A');
    }
    // Upload pill
    if (cur.data && cur.data.type === 'custom') {
        document.getElementById('upThumb').src = cur.data.url;
        document.getElementById('upName').textContent = cur.data.name || 'Custom';
        document.getElementById('upPill').classList.add('show');
        document.getElementById('uploadArea').style.display = 'none';
    } else {
        document.getElementById('upPill').classList.remove('show');
        document.getElementById('uploadArea').style.display = 'flex';
        document.getElementById('fileIn').value = '';
    }
}

/* ══════════════════════════════════════
   LOGO INTERACTION — 2 zones indépendantes
   ══════════════════════════════════════ */
function initLogoInteraction() {
    ['front', 'back'].forEach(s => {
        const zoneId = s === 'front' ? 'logoZoneFront' : 'logoZoneBack';
        const zone   = document.getElementById(zoneId);
        if (!zone) return;
        zone.addEventListener('pointerdown', e => onLogoDown(e, s));
    });

    document.addEventListener('pointermove', onLogoMove);
    document.addEventListener('pointerup',   onLogoUp);

    // Désélection globale : clic hors de tout logo-zone → tout désélectionner
    document.addEventListener('pointerdown', e => {
        if (!e.target.closest('.logo-zone')) {
            logoSelected = false;
            document.querySelectorAll('.logo-zone').forEach(z => z.classList.remove('selected'));
        }
    });

    // Sliders Y
    document.getElementById('sliderFrontY').addEventListener('input', e => {
        logos.front.y = parseFloat(e.target.value);
        updateLogoPositionForSide('front');
    });
    document.getElementById('sliderBackY').addEventListener('input', e => {
        logos.back.y = parseFloat(e.target.value);
        updateLogoPositionForSide('back');
    });
}

function onLogoDown(e, activeSide) {
    const cur = logos[activeSide];
    if (!cur.data) return;
    e.preventDefault();
    e.stopPropagation();

    /* Activer ce côté pour les sélecteurs */
    if (side !== activeSide) {
        side = activeSide;
        // Désélectionner tous les logos (évite cadre bleu fantôme sur l'autre côté)
        document.querySelectorAll('.logo-zone').forEach(z => z.classList.remove('selected'));
        logoSelected = false;
        document.getElementById('logoSectionLabel').textContent =
            side === 'front' ? 'Design Logo Av' : 'Design Logo Ar';
        document.getElementById('colFront').classList.toggle('active', side === 'front');
        document.getElementById('colBack').classList.toggle('active',  side === 'back');
        syncLogoUI();
    }

    const zoneId = activeSide === 'front' ? 'logoZoneFront' : 'logoZoneBack';
    const viewId = activeSide === 'front' ? 'svgViewFront'  : 'svgViewBack';
    const zone   = document.getElementById(zoneId);
    const rect   = document.getElementById(viewId).getBoundingClientRect();

    logoSelected = true;
    zone.classList.add('selected');

    const handle = e.target.closest('.logo-handle');
    if (handle) {
        dragState = {
            type: 'resize', side: activeSide,
            corner: handle.dataset.corner,
            startX: e.clientX, startY: e.clientY,
            origW: cur.w, origH: cur.h, origX: cur.x, origY: cur.y,
            stageW: rect.width, stageH: rect.height,
            centerX: rect.left + (cur.x / 100) * rect.width,
            centerY: rect.top  + (cur.y / 100) * rect.height
        };
    } else {
        dragState = {
            type: 'drag', side: activeSide,
            startX: e.clientX, startY: e.clientY,
            origX: cur.x, origY: cur.y,
            stageW: rect.width, stageH: rect.height
        };
    }
    zone.setPointerCapture(e.pointerId);
}

function onLogoMove(e) {
    if (!dragState) return;
    e.preventDefault();
    const cur = logos[dragState.side];
    const s   = dragState.side;

    if (dragState.type === 'drag') {
        const dx = e.clientX - dragState.startX;
        const dy = e.clientY - dragState.startY;
        cur.x = dragState.origX + (dx / dragState.stageW) * 100;
        cur.y = dragState.origY + (dy / dragState.stageH) * 100;
        cur.x = Math.max(cur.w / 2, Math.min(100 - cur.w / 2, cur.x));
        cur.y = Math.max(5, Math.min(95, cur.y));
        requestAnimationFrame(() => updateLogoPositionForSide(s));
    }

    if (dragState.type === 'resize') {
        /* Apple-style : coin direct, linéaire, pas de ratio de distance */
        const dx = e.clientX - dragState.startX;
        const dy = e.clientY - dragState.startY;
        const signX = dragState.corner.includes('e') ? 1 : -1;
        const signY = dragState.corner.includes('s') ? 1 : -1;
        const delta  = (signX * dx + signY * dy) * 0.5;
        const pctChg = (delta / dragState.stageW) * 100 * 2.5;
        const ratio  = dragState.origH / dragState.origW;
        cur.w = Math.max(8,  Math.min(50, dragState.origW + pctChg));
        cur.h = Math.max(6,  Math.min(40, cur.w * ratio));
        requestAnimationFrame(() => updateLogoPositionForSide(s));
    }
}

function onLogoUp(e) {
    dragState = null;
}

/* ══════════════════════════════════════
   SIDE TOGGLE
   ══════════════════════════════════════ */
window.flipSide = function(s) {
    side = s;
    // Désélectionner tous les logos quand on switch de côté
    logoSelected = false;
    document.querySelectorAll('.logo-zone').forEach(z => z.classList.remove('selected'));
    document.getElementById('logoSectionLabel').textContent = s === 'front' ? 'Design Logo Av' : 'Design Logo Ar';
    document.getElementById('colFront').classList.toggle('active', s === 'front');
    document.getElementById('colBack').classList.toggle('active',  s === 'back');
    syncLogoUI();
};

function showLogoColorSection(show) {
    document.getElementById('logoColorSection').style.display = show ? 'block' : 'none';
}

window.dropLogo = function() {
    const cur = cl();
    cur.data = null;
    logoSelected = false;
    if (selects['selLogo'] && selects['selLogo'].reset) selects['selLogo'].reset();
    showLogoColorSection(false);
    document.getElementById('upPill').classList.remove('show');
    document.getElementById('uploadArea').style.display = 'flex';
    document.getElementById('fileIn').value = '';
    renderLogo();
};

/* ══════════════════════════════════════
   FILE UPLOAD
   ══════════════════════════════════════ */
window.onUpload = function(e) {
    const f = e.target.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = function(ev) {
        const cur = cl();
        cur.data = {type:'custom', url:ev.target.result, name:f.name};
        if (selects['selLogo'] && selects['selLogo'].reset) selects['selLogo'].reset();
        document.getElementById('upThumb').src = ev.target.result;
        document.getElementById('upName').textContent = f.name;
        document.getElementById('upPill').classList.add('show');
        document.getElementById('uploadArea').style.display = 'none';
        showLogoColorSection(false);
        cur.x = 50; cur.y = 42; cur.w = 24; cur.h = 17;
        renderLogo();
    };
    r.readAsDataURL(f);
};

window.rmUpload = function() {
    const cur = cl();
    if (cur.data && cur.data.type === 'custom') { cur.data = null; renderLogo(); }
    document.getElementById('upPill').classList.remove('show');
    document.getElementById('uploadArea').style.display = 'flex';
    document.getElementById('fileIn').value = '';
};

/* ══════════════════════════════════════
   PAYMENT
   ══════════════════════════════════════ */
window.setPay = function(s) {
    payStatus = s;
    document.querySelectorAll('#payStatus .pay-opt').forEach(b => b.classList.toggle('on', b.dataset.p === s));
};

window.calcTotal = function() {
    const t = (parseFloat(document.getElementById('price').value)||0) + (parseFloat(document.getElementById('customPrice').value)||0);
    document.getElementById('totalLabel').innerHTML = t + ' &euro;';
};

/* ══════════════════════════════════════
   MOCKUP CAPTURE — renders a side (front/back) to a JPEG data-URL
   ══════════════════════════════════════ */
function renderSvgToImg(svgStr, w, h) {
    return new Promise(function(resolve) {
        var blob = new Blob([svgStr], {type:'image/svg+xml;charset=utf-8'});
        var url = URL.createObjectURL(blob);
        var img = new Image();
        img.onload = function() { URL.revokeObjectURL(url); resolve(img); };
        img.onerror = function() { URL.revokeObjectURL(url); resolve(null); };
        img.src = url;
    });
}

async function captureMockup(shirtSvg, sideData, fabricHex, W, H, Q) {
    W = W || 400; H = H || 480; Q = Q || 0.65;
    var c = document.createElement('canvas'); c.width = W; c.height = H;
    var cx = c.getContext('2d');
    cx.fillStyle = '#F5F5F7'; cx.fillRect(0, 0, W, H);

    if (shirtSvg) {
        var colored = shirtSvg.replace(FABRIC_RE, fabricHex);
        var shirtImg = await renderSvgToImg(colored, W, H);
        if (shirtImg) {
            var scale = Math.min(W / shirtImg.naturalWidth, H / shirtImg.naturalHeight) * 0.92;
            var sw = shirtImg.naturalWidth * scale, sh = shirtImg.naturalHeight * scale;
            cx.drawImage(shirtImg, (W - sw) / 2, (H - sh) / 2, sw, sh);
        }
    }

    /* Overlay logo */
    if (sideData && sideData.data) {
        var lx = (sideData.x / 100) * W, ly = (sideData.y / 100) * H;
        var lw = (sideData.w / 100) * W, lh = (sideData.h / 100) * H;
        var logoImg = null;
        if (sideData.data.type === 'atelier' && sideData.data.s) {
            var logoSvg = sideData.data.s.replace(/#1A1A1A/gi, sideData.logoColor || '#1A1A1A');
            logoImg = await renderSvgToImg(logoSvg, lw, lh);
        } else if (sideData.data.type === 'custom' && sideData.data.url) {
            logoImg = await new Promise(function(resolve) {
                var im = new Image(); im.onload = function() { resolve(im); };
                im.onerror = function() { resolve(null); }; im.src = sideData.data.url;
            });
        }
        if (logoImg) cx.drawImage(logoImg, lx - lw / 2, ly - lh / 2, lw, lh);
    }

    return c.toDataURL('image/jpeg', Q);
}

/* ══════════════════════════════════════
   SUBMIT  (A-Q payload)
   ══════════════════════════════════════ */
window.submit = async function() {
    const b = document.getElementById('subBtn');
    b.textContent = 'Envoi...'; b.disabled = true; b.style.opacity = '0.6';

    try {

    /* ── Build payload ── */
    const collVal = selects['selCollection'] ? selects['selCollection'].value : '';
    const refVal  = selects['selRef']        ? selects['selRef'].value        : '';
    const sizeVal = selects['selSize']       ? selects['selSize'].value       : '';

    const tel = (document.getElementById('countryCode').value || '') + ' ' +
                (document.getElementById('clientPhone').value  || '');

    const logoColorName = (hex, arr) => (arr.find(c => c.h === hex) || { n: hex }).n;

    const payload = {
        commande          : document.getElementById('orderNo').textContent.trim(),
        date              : document.getElementById('orderDate').textContent.trim(),
        nom               : document.getElementById('clientName').value.trim(),
        telephone         : tel.trim(),
        collection        : collVal || '',
        reference         : refVal  || '',
        taille            : sizeVal || '',
        couleurTshirt     : color.n,
        couleurTshirtHex  : color.h,
        couleurLogoAvant  : logos.front.data && logos.front.data.type === 'atelier'
                            ? logoColorName(logos.front.logoColor, LOGO_COLORS) : '',
        couleurLogoArriere: logos.back.data  && logos.back.data.type  === 'atelier'
                            ? logoColorName(logos.back.logoColor,  LOGO_COLORS) : '',
        logoAvant         : logos.front.data ? (logos.front.data.type === 'atelier' ? logos.front.data.id : 'Custom') : '',
        logoArriere       : logos.back.data  ? (logos.back.data.type  === 'atelier' ? logos.back.data.id  : 'Custom') : '',
        note              : (document.getElementById('note').value || '').trim(),
        prixTshirt        : document.getElementById('price').value        || '0',
        personnalisation  : document.getElementById('customPrice').value  || '0',
        total             : document.getElementById('totalLabel').textContent.trim(),
        paye              : payStatus === 'oui' ? 'OUI' : 'NON'
    };

    /* ── Capture mockups réduits (220×264, JPEG 0.48) pour la fiche atelier ── */
    var mockupFront = await captureMockup(svgF, logos.front, color.h, 220, 264, 0.48);
    var mockupBack  = await captureMockup(svgB, logos.back,  color.h, 220, 264, 0.48);

    /* ── Build fiche URL (~150 Ko avec images compressées) ── */
    const ATELIER_URL = 'https://ficheatelier.pages.dev';
    const ficheData = {
        commande          : payload.commande,
        date              : payload.date,
        nom               : payload.nom,
        telephone         : payload.telephone,
        collection        : payload.collection,
        reference         : payload.reference,
        taille            : payload.taille,
        couleur           : { nom: color.n, hex: color.h },
        logoAvant         : payload.logoAvant,
        logoArriere       : payload.logoArriere,
        couleurLogoAvant  : payload.couleurLogoAvant,
        couleurLogoArriere: payload.couleurLogoArriere,
        note              : payload.note,
        prix              : { tshirt: payload.prixTshirt, personnalisation: payload.personnalisation, total: payload.total },
        paiement          : { statut: payload.paye },
        mockupFront       : mockupFront,
        mockupBack        : mockupBack
    };
    const ficheURL = ATELIER_URL + '#' + btoa(unescape(encodeURIComponent(JSON.stringify(ficheData))));

    /* URL complète avec mockups — setLinkUrl (RichText) n'a pas de limite de formule */
    payload.fiche = ficheURL;

    /* ── Envoi Google Sheets (best-effort, non-bloquant) ── */
    fetch(API, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) }).catch(() => {});

    /* ── Apple success overlay ── */
    const overlay = document.getElementById('successOverlay');
    document.getElementById('sfOrderNo').textContent    = payload.commande;
    document.getElementById('sfClientName').textContent = payload.nom || '';
    document.getElementById('sfFicheBtn').onclick = () => window.open(ficheURL, '_blank');
    overlay.classList.add('sf-on');

    } catch(e) {
        console.error('Erreur validation:', e);
        b.textContent = 'Valider la Commande'; b.disabled = false; b.style.opacity = '1';
        /* Affichage erreur discret */
        const err = document.createElement('p');
        err.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#FF3B30;color:#fff;padding:12px 20px;border-radius:12px;font-size:14px;font-weight:600;z-index:9999;';
        err.textContent = 'Erreur : ' + e.message;
        document.body.appendChild(err);
        setTimeout(() => err.remove(), 5000);
    }
};

})();
</script>

</body>
</html>
