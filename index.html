<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Studio Olda</title>
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/svg+xml" href="olda-icon.svg">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Studio Olda">
    <meta name="theme-color" content="#1D1D1F">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,300..900;1,14..32,300..900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = { theme: { extend: { fontFamily: { sans: ['-apple-system','BlinkMacSystemFont','SF Pro Display','SF Pro Text','Inter','Helvetica Neue','Helvetica','Arial','sans-serif'] } } } }
    </script>
    <style>
        :root {
            --accent: #007AFF;
            --green: #34C759;
            --red: #FF3B30;
            --bg: #F5F5F7;
            --card: #FFFFFF;
            --glass: rgba(255,255,255,0.72);
            --glass-border: rgba(255,255,255,0.45);
            --border: rgba(0,0,0,0.06);
            --separator: #D2D2D7;
            --text-1: #1D1D1F;
            --text-2: #86868B;
            --text-3: #AEAEB2;
            --radius: 12px;
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; margin: 0; }
        input, select, textarea { -webkit-appearance: none; -moz-appearance: none; appearance: none; border-radius: 0; }
        input[type="date"] { -webkit-appearance: none; appearance: none; color: #111827; }
        input[type="date"]::-webkit-date-and-time-value { text-align: left; color: #111827; }

        /* ── Touch optimisation (supprime délai 300ms sur iOS/Android/Samsung) ── */
        button, a, label[for],
        .aselect-trigger, .aselect-opt, .seg-btn, .swatch,
        .pay-opt, .lsheet-close-btn, .fbar-btn, .shirt-col,
        .logo-tap-overlay, .lsheet-upload-row, .sf-btn-primary, .sf-btn-secondary {
            touch-action: manipulation;
        }
        /* ── Overscroll (empêche le scroll parent de se déclencher sur Android) ── */
        .aselect-dropdown, .lsheet-scroll { overscroll-behavior: contain; }

        /* ── Hover uniquement sur vrais pointeurs (évite états bloqués sur tactile) ── */
        @media (hover: none) {
            .aselect-opt:hover, .aselect-trigger:hover,
            .seg-btn:hover, .swatch:hover, .pay-opt:hover { background: unset; }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Inter', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text-1);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            letter-spacing: -0.022em;
        }

        /* ═══════════════════════════════════
           PROGRESS BAR
           ═══════════════════════════════════ */
        .progress-track { height: 3px; background: rgba(0,0,0,0.06); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

        /* ═══════════════════════════════════
           CARDS
           ═══════════════════════════════════ */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 0 0 0.5px rgba(0,0,0,0.03);
        }

        /* ═══════════════════════════════════
           INPUTS
           ═══════════════════════════════════ */
        .input {
            background: var(--bg);
            border: 1.5px solid transparent;
            border-radius: var(--radius);
            padding: 14px 16px;
            width: 100%;
            outline: none;
            font-size: 16px;
            color: var(--text-1);
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: inherit;
            letter-spacing: -0.022em;
        }
        .input:focus { border-color: var(--accent); box-shadow: 0 0 0 3.5px rgba(0,122,255,0.12); }
        .input::placeholder { color: var(--text-3); }

        /* ═══════════════════════════════════
           CUSTOM SELECT (Apple Style)
           ═══════════════════════════════════ */
        .aselect { position: relative; user-select: none; }

        .aselect-trigger {
            background: var(--bg);
            border: 1.5px solid transparent;
            border-radius: var(--radius);
            padding: 14px 40px 14px 16px;
            font-size: 16px;
            color: var(--text-1);
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
            position: relative;
            width: 100%;
            display: block;
            font-family: inherit;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            letter-spacing: -0.022em;
        }
        .aselect-trigger.placeholder { color: var(--text-3); }
        .aselect.open .aselect-trigger { border-color: var(--accent); box-shadow: 0 0 0 3.5px rgba(0,122,255,0.12); }

        .aselect-chevron {
            position: absolute; right: 14px; top: 50%;
            transform: translateY(-50%); pointer-events: none;
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-3);
        }
        .aselect.open .aselect-chevron { transform: translateY(-50%) rotate(180deg); }

        .aselect-dropdown {
            position: absolute; top: calc(100% + 6px); left: 0; right: 0;
            background: rgba(255,255,255,0.88);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border-radius: var(--radius);
            box-shadow: 0 4px 24px rgba(0,0,0,0.08), 0 1px 4px rgba(0,0,0,0.04), 0 0 0 0.5px rgba(0,0,0,0.03);
            z-index: 200;
            overflow: hidden;
            transform-origin: top center;
            animation: aselOpen 0.2s cubic-bezier(0.2, 0, 0, 1.1);
            max-height: 280px; overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .aselect-dropdown::-webkit-scrollbar { display: none; }

        @keyframes aselOpen {
            from { opacity: 0; transform: scaleY(0.92) translateY(-6px); }
            to { opacity: 1; transform: scaleY(1) translateY(0); }
        }

        .aselect-opt {
            padding: 13px 16px; font-size: 16px; cursor: pointer;
            transition: background 0.1s;
            display: flex; align-items: center; justify-content: space-between;
            font-family: inherit;
        }
        .aselect-opt:active { background: rgba(0,122,255,0.08); }
        @media (hover: hover) { .aselect-opt:hover { background: var(--bg); } }
        .aselect-opt + .aselect-opt { border-top: 0.5px solid var(--border); }
        .aselect-opt.on { color: var(--accent); font-weight: 600; }
        .aselect-opt.on::after {
            content: '';
            width: 18px; height: 18px; flex-shrink: 0;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23007AFF' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E") center/contain no-repeat;
        }

        /* Compact selects for 3-col grid */
        .aselect-compact .aselect-trigger { padding: 12px 28px 12px 12px; font-size: 14px; }
        .aselect-compact .aselect-chevron { right: 10px; }

        /* Inline selects for single-line rows (paiement) */
        .aselect-inline .aselect-trigger {
            background: transparent; border: none; box-shadow: none;
            padding: 0 22px 0 0; border-radius: 0;
            font-size: 17px; font-weight: 600; color: var(--text-1);
            text-align: right; letter-spacing: -0.02em;
            min-height: 44px; display: flex; align-items: center; justify-content: flex-end;
        }
        .aselect-inline.open .aselect-trigger { box-shadow: none; border: none; }
        .aselect-inline .aselect-chevron { right: 0; opacity: 0.35; }
        .aselect-inline .aselect-dropdown { min-width: 160px; left: auto; right: 0; }

        /* ═══════════════════════════════════
           BUTTONS
           ═══════════════════════════════════ */
        .btn {
            border: none; border-radius: var(--radius); padding: 16px 24px;
            font-weight: 600; font-size: 17px; text-align: center; width: 100%;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit; display: flex; align-items: center; justify-content: center; gap: 8px;
            letter-spacing: -0.022em;
        }
        .btn:active { transform: scale(0.97); opacity: 0.85; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #0066D6; }
        .btn-dark { background: var(--text-1); color: white; }
        .btn-dark:hover { background: #333; }
        .btn-ghost { background: white; color: var(--text-2); box-shadow: 0 0 0 0.5px var(--separator); }
        .btn-ghost:hover { background: var(--bg); }

        /* Payment option cards — neutral by default, colored only when selected */
        .pay-opt {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; padding: 14px 16px; border-radius: var(--radius);
            background: var(--bg); border: 1.5px solid var(--border);
            color: var(--text-2); font-size: 15px; font-weight: 600;
            cursor: pointer; transition: all 0.2s; font-family: inherit; text-align: left;
        }
        .pay-opt:active { transform: scale(0.98); opacity: 0.9; }
        .pay-opt.on {
            background: var(--pay-bg-on); border-color: var(--pay-border-on); color: var(--pay-color);
        }
        .pay-opt::after {
            content: ''; width: 22px; height: 22px; border-radius: 50%; flex-shrink: 0;
            border: 2px solid var(--separator); transition: all 0.2s;
        }
        .pay-opt.on::after {
            border-color: var(--pay-color); background: var(--pay-color);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E");
            background-size: 12px; background-repeat: no-repeat; background-position: center;
        }

        /* ═══════════════════════════════════
           STEPS
           ═══════════════════════════════════ */
        .step { display: none; flex-direction: column; gap: 16px; }
        .step.active { display: flex; animation: enterStep 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes enterStep {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ═══════════════════════════════════
           LABELS
           ═══════════════════════════════════ */
        .label { font-size: 11px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-3); }
        .section-title { font-size: 13px; font-weight: 600; color: var(--text-2); letter-spacing: -0.01em; }

        /* ═══════════════════════════════════
           SEGMENTED CONTROL
           ═══════════════════════════════════ */
        .seg { display: flex; background: rgba(0,0,0,0.06); border-radius: 10px; padding: 2px; }
        .seg-btn {
            flex: 1; padding: 8px 4px; font-size: 13px; font-weight: 600; text-align: center;
            border-radius: 8px; color: var(--text-2); cursor: pointer; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none; border: none; background: none; font-family: inherit;
        }
        .seg-btn.on { color: var(--text-1); background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.08), 0 0.5px 1px rgba(0,0,0,0.04); }

        /* ═══════════════════════════════════
           STAGE (T-Shirt Preview)
           ═══════════════════════════════════ */
        .stage {
            background: linear-gradient(180deg, #F5F5F7 0%, #EEEEF0 100%);
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
        }
        .stage::after {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at 50% 90%, rgba(0,0,0,0.04) 0%, transparent 55%);
            pointer-events: none; border-radius: var(--radius);
        }

        /* ── Grille double t-shirt ── */
        .shirts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            align-items: start;
        }
        .shirt-col { display: flex; flex-direction: column; align-items: stretch; }
        .shirt-side-label {
            font-size: 10px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 1.5px; color: #86868b; text-align: center;
            margin-bottom: 5px; transition: color 0.15s;
        }
        .shirt-col.active .shirt-side-label { color: var(--accent); }

        /* svg-view : fluide, ratio t-shirt */
        .svg-view {
            position: relative;
            width: 100%;
            aspect-ratio: 5 / 6;
            overflow: hidden;
        }
        .svg-box {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .svg-box svg {
            height: 100%; width: auto; max-width: 100%;
            filter: drop-shadow(0 4px 18px rgba(0,0,0,0.09));
        }


        /* ═══════════════════════════════════
           LOGO ZONE (Keynote Interaction)
           ═══════════════════════════════════ */
        .logo-zone {
            position: absolute;
            transform: translate(-50%, -50%);
            display: flex; align-items: center; justify-content: center;
            z-index: 10;
            touch-action: none;
        }
        .logo-zone.empty { pointer-events: none; }
        .logo-zone.has-logo { cursor: move; }

        .logo-inner {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .logo-inner img, .logo-inner svg {
            max-width: 100%; max-height: 100%; object-fit: contain;
            filter: drop-shadow(0 1px 3px rgba(0,0,0,0.1));
            opacity: 0.92; mix-blend-mode: multiply;
        }

        /* Selection Frame (Keynote style) */
        .logo-frame {
            position: absolute; inset: -6px;
            border: 1.5px solid var(--accent);
            border-radius: 3px;
            pointer-events: none;
            display: none;
        }
        .logo-zone.selected .logo-frame { display: block; }

        /* Indicateurs de coin (resize visuel quand sélectionné) */
        .logo-zone.selected::before,
        .logo-zone.selected::after {
            content: '';
            position: absolute;
            width: 10px; height: 10px;
            border-color: var(--accent);
            border-style: solid;
            z-index: 12;
            pointer-events: none;
        }
        .logo-zone.selected::before {
            top: -1px; left: -1px;
            border-width: 2.5px 0 0 2.5px;
            border-radius: 2px 0 0 0;
        }
        .logo-zone.selected::after {
            bottom: -1px; right: -1px;
            border-width: 0 2.5px 2.5px 0;
            border-radius: 0 0 2px 0;
        }

        /* ═══════════════════════════════════
           TAP OVERLAY (état vide du t-shirt)
           ═══════════════════════════════════ */
        .logo-tap-overlay {
            position: absolute;
            inset: 0;
            z-index: 5;
            cursor: pointer;
        }
        .logo-tap-pip {
            position: absolute;
            width: 34px; height: 34px;
            border-radius: 50%;
            background: rgba(0,122,255,0.11);
            border: 1.5px solid rgba(0,122,255,0.28);
            display: flex; align-items: center; justify-content: center;
            transform: translate(-50%, -50%);
            transition: background 0.15s, transform 0.15s;
            animation: tapPulse 2.4s ease-out infinite;
        }
        /* Position cœur pour l'avant (poitrine gauche du porteur = droite de l'image) */
        .logo-tap-front .logo-tap-pip { left: 66.5%; top: 28%; }
        /* Arrière décalé */
        .logo-tap-back  .logo-tap-pip { left: 47.9%; top: 31%; }

        .logo-tap-overlay:active .logo-tap-pip {
            background: rgba(0,122,255,0.22);
            transform: translate(-50%, -50%) scale(0.88);
            animation: none;
        }
        .logo-tap-overlay.gone { display: none; }

        @keyframes tapPulse {
            0%   { box-shadow: 0 0 0 0 rgba(0,122,255,0.22); }
            60%  { box-shadow: 0 0 0 9px rgba(0,122,255,0); }
            100% { box-shadow: 0 0 0 0 rgba(0,122,255,0); }
        }

        /* ═══════════════════════════════════
           FLOAT BAR (barre flottante logo)
           ═══════════════════════════════════ */
        .logo-float-bar {
            margin: 8px 2px 0;
            padding: 8px 12px;
            background: rgba(255,255,255,0.94);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 14px;
            box-shadow: 0 1px 8px rgba(0,0,0,0.09), 0 0 0 0.5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            animation: enterStep 0.2s ease;
        }
        /* BIO badge — discret */
        .bio-badge {
            position: absolute;
            bottom: 7px;
            left: 7px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            background: rgba(34,139,34,0.13);
            color: #1a6b32;
            font-size: 8px;
            font-weight: 600;
            letter-spacing: 0.05em;
            padding: 2px 6px 2px 5px;
            border-radius: 12px;
            border: 0.5px solid rgba(34,139,34,0.28);
            pointer-events: none;
            z-index: 20;
            opacity: 0;
            transform: scale(0.85);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .bio-badge.visible { opacity: 1; transform: scale(1); }
        .bio-badge svg { flex-shrink: 0; }
        .fbar-btn {
            padding: 5px 11px;
            border-radius: 9px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
            letter-spacing: -0.01em;
            flex-shrink: 0;
        }
        .fbar-btn:active { transform: scale(0.93); }
        .fbar-change { background: rgba(0,122,255,0.1); color: var(--accent); }
        .fbar-remove { background: rgba(255,59,48,0.08); color: var(--red); }

        /* ═══════════════════════════════════
           LOGO BOTTOM SHEET
           ═══════════════════════════════════ */
        .lsheet-backdrop {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.32);
            z-index: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .lsheet-backdrop.open { opacity: 1; pointer-events: auto; }
        .lsheet {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: #F5F5F7;
            border-radius: 22px 22px 0 0;
            z-index: 600;
            transform: translateY(100%);
            transition: transform 0.44s cubic-bezier(0.32, 0.72, 0, 1);
            max-height: 78vh;
            max-height: 78dvh; /* dynamic viewport height — exclut la barre navigateur iOS/Samsung */
            padding-bottom: env(safe-area-inset-bottom, 0px); /* home indicator iPhone */
            display: flex;
            flex-direction: column;
            box-shadow: 0 -1px 0 rgba(0,0,0,0.05), 0 -8px 40px rgba(0,0,0,0.12);
        }
        .lsheet.open { transform: translateY(0); }
        .lsheet-handle-row { padding: 10px; display: flex; justify-content: center; flex-shrink: 0; }
        .lsheet-handle { width: 36px; height: 4px; background: rgba(0,0,0,0.15); border-radius: 2px; }
        .lsheet-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px 14px; flex-shrink: 0;
        }
        .lsheet-title { font-size: 18px; font-weight: 700; color: var(--text-1); letter-spacing: -0.025em; }
        .lsheet-close-btn {
            width: 30px; height: 30px; border-radius: 50%;
            background: rgba(0,0,0,0.07); border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-2); font-weight: 700; font-size: 14px; font-family: inherit;
            transition: background 0.15s;
        }
        .lsheet-close-btn:active { background: rgba(0,0,0,0.14); }
        .lsheet-scroll {
            overflow-y: auto; flex: 1; padding: 4px 16px 36px;
            -webkit-overflow-scrolling: touch;
        }
        .lsheet-scroll::-webkit-scrollbar { display: none; }
        .lsheet-group-label {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.09em; color: var(--text-3); margin: 14px 0 8px 4px;
        }
        .lsheet-logo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .lsheet-thumb {
            border-radius: 14px; background: white;
            border: 1.5px solid transparent;
            cursor: pointer; padding: 10px 8px 8px;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            transition: all 0.18s;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04), 0 0 0 0.5px rgba(0,0,0,0.04);
        }
        .lsheet-thumb:active { transform: scale(0.95); }
        .lsheet-thumb.on { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,122,255,0.12); }
        .lsheet-thumb svg { width: 56px; height: 56px; }
        .lsheet-thumb-name { font-size: 10px; font-weight: 600; color: var(--text-2); letter-spacing: 0.02em; }
        .lsheet-sep { height: 0.5px; background: var(--separator); margin: 16px 0 4px; }
        .lsheet-upload-row {
            display: flex; align-items: center; gap: 12px;
            padding: 13px 14px; border-radius: 14px;
            background: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04), 0 0 0 0.5px rgba(0,0,0,0.04);
            cursor: pointer; border: none; width: 100%;
            font-family: inherit; text-align: left;
        }
        .lsheet-upload-icon {
            width: 38px; height: 38px; border-radius: 10px;
            background: rgba(0,122,255,0.1);
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        /* ═══════════════════════════════════
           PASTILLES COULEUR T-SHIRT (Apple-style)
           ═══════════════════════════════════ */
        .color-dots-bar {
            display: flex; justify-content: center; gap: 8px;
            margin-top: 10px; flex-wrap: wrap;
        }
        .color-dot {
            width: 18px; height: 18px; border-radius: 50%;
            cursor: pointer; position: relative;
            box-shadow: inset 0 0 0 0.5px rgba(0,0,0,0.15);
            transition: transform 0.18s ease;
            border: none; padding: 0; outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        .color-dot::after {
            content: ''; position: absolute; inset: -3px;
            border-radius: 50%; border: 1.5px solid transparent;
            transition: border-color 0.18s ease;
        }
        .color-dot.on { transform: scale(0.85); }
        .color-dot.on::after { border-color: var(--accent); }

        .lsheet-color-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 6px; }
        .lsheet-color-dot {
            width: 30px; height: 30px; border-radius: 50%;
            cursor: pointer; box-shadow: inset 0 0 0 0.5px rgba(0,0,0,0.12);
            position: relative; transition: transform 0.18s; flex-shrink: 0;
            border: none;
        }
        .lsheet-color-dot::before {
            content: ''; position: absolute; inset: -4px;
            border-radius: 50%; border: 2px solid transparent; transition: border-color 0.18s;
        }
        .lsheet-color-dot.on::before { border-color: var(--accent); }
        .lsheet-color-dot.on { transform: scale(0.82); }
        .lsheet-color-section { display: block; }

        /* ═══════════════════════════════════
           COLOR SWATCHES (iPhone Style)
           ═══════════════════════════════════ */
        .swatch-row { display: flex; flex-wrap: wrap; gap: 12px; }

        .swatch {
            width: 34px; height: 34px; border-radius: 50%;
            cursor: pointer; border: none; position: relative;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0; background: none; outline: none;
        }
        .swatch-fill {
            width: 100%; height: 100%; border-radius: 50%;
            box-shadow: inset 0 0 0 0.5px rgba(0,0,0,0.1);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .swatch:hover .swatch-fill { transform: scale(1.1); }
        .swatch:active .swatch-fill { transform: scale(0.92); }

        /* iPhone ring: outer ring with gap */
        .swatch::before {
            content: ''; position: absolute;
            inset: -4px; border-radius: 50%;
            border: 2px solid transparent;
            transition: border-color 0.25s ease;
        }
        .swatch.on::before { border-color: var(--accent); }
        .swatch.on .swatch-fill { transform: scale(0.82); }

        /* ═══════════════════════════════════
           LOGO COLOR PASTILLES
           ═══════════════════════════════════ */
        .pastille-row { display: flex; gap: 10px; flex-wrap: wrap; }

        .pastille {
            width: 28px; height: 28px; border-radius: 50%;
            cursor: pointer; border: none; position: relative;
            transition: transform 0.2s; padding: 0; background: none; outline: none;
        }
        .pastille-fill {
            width: 100%; height: 100%; border-radius: 50%;
            box-shadow: inset 0 0 0 0.5px rgba(0,0,0,0.12);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .pastille::before {
            content: ''; position: absolute; inset: -3px;
            border-radius: 50%; border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .pastille.on::before { border-color: var(--accent); }
        .pastille.on .pastille-fill { transform: scale(0.78); }

        /* ═══════════════════════════════════
           LOGO THUMBS
           ═══════════════════════════════════ */
        .lthumb {
            border-radius: var(--radius); padding: 14px; cursor: pointer;
            border: 2px solid transparent;
            background: rgba(0,0,0,0.02);
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none; min-height: 90px; justify-content: center;
        }
        .lthumb:hover { background: rgba(0,0,0,0.04); transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.06); }
        .lthumb:active { transform: scale(0.96); }
        .lthumb.on { border-color: var(--accent); background: rgba(0,122,255,0.04); box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
        .lthumb svg { width: 44px; height: 44px; }

        /* ═══════════════════════════════════
           UPLOAD
           ═══════════════════════════════════ */
        .upload-area {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            padding: 16px; border-radius: var(--radius);
            border: 1.5px dashed rgba(0,122,255,0.25);
            background: rgba(0,122,255,0.02); color: var(--accent);
            font-size: 15px; font-weight: 600; cursor: pointer;
            transition: all 0.25s; width: 100%;
        }
        .upload-area:hover { background: rgba(0,122,255,0.06); border-color: var(--accent); }
        .upload-area:active { transform: scale(0.98); }
        .upload-area .plus {
            width: 26px; height: 26px; border-radius: 50%;
            background: var(--accent); color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; line-height: 1;
        }

        .upload-pill {
            display: none; align-items: center; gap: 12px; padding: 10px 14px;
            border-radius: var(--radius); background: rgba(0,122,255,0.04);
            border: 1.5px solid rgba(0,122,255,0.12);
            animation: enterStep 0.3s ease;
        }
        .upload-pill.show { display: flex; }
        .upload-pill img { width: 44px; height: 44px; object-fit: contain; border-radius: 10px; background: white; padding: 3px; }
        .upload-pill .x {
            margin-left: auto; width: 26px; height: 26px; border-radius: 50%; flex-shrink: 0;
            background: rgba(255,59,48,0.06); color: var(--red);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-weight: 700; font-size: 15px; border: none; transition: background 0.2s;
        }
        .upload-pill .x:hover { background: rgba(255,59,48,0.14); }

        /* ═══════════════════════════════════
           PREMIUM STEP 1 CARD
           ═══════════════════════════════════ */
        .s1-card {
            background: #fff;
            border-radius: 32px;
            padding: 40px 32px 36px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.03), 0 0 0 0.5px rgba(0,0,0,0.02);
        }
        .s1-meta {
            font-size: 11px;
            font-weight: 600;
            color: #AEAEB2;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }
        .s1-title {
            font-size: 44px;
            font-weight: 800;
            color: #1d1d1f;
            letter-spacing: -0.035em;
            line-height: 1.06;
            margin-top: 6px;
        }
        .s1-progress {
            height: 2px;
            background: #E8E8ED;
            border-radius: 1px;
            margin: 28px 0 40px;
            overflow: hidden;
        }
        .s1-progress-fill {
            height: 100%;
            background: #2563EB;
            border-radius: 1px;
            width: 33.33%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .s1-order-line {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 0.5px solid rgba(0,0,0,0.05);
        }
        .s1-order-val {
            font-family: 'SF Mono', ui-monospace, 'Menlo', monospace;
            font-size: 14px;
            font-weight: 600;
            color: #1d1d1f;
            letter-spacing: -0.01em;
        }
        .s1-order-dot {
            font-size: 8px;
            color: #D1D1D6;
            line-height: 1;
        }
        .s1-order-date {
            font-size: 14px;
            font-weight: 500;
            color: #86868b;
        }
        .s1-field {
            display: flex;
            align-items: center;
            padding: 18px 0;
        }
        .s1-field + .s1-field {
            border-top: 0.5px solid rgba(0,0,0,0.04);
        }
        .s1-label {
            width: 80px;
            flex-shrink: 0;
            font-size: 13px;
            font-weight: 600;
            color: #AEAEB2;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }
        .s1-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 17px;
            font-weight: 500;
            color: #1d1d1f;
            font-family: inherit;
            letter-spacing: -0.022em;
            padding: 0 0 4px 0;
            border-bottom: 2px solid transparent;
            transition: border-color 0.3s ease;
        }
        .s1-input::placeholder {
            color: #D1D1D6;
            font-weight: 400;
        }
        .s1-input:focus {
            border-bottom-color: #2563EB;
        }
        .s1-input.has-underline {
            border-bottom-color: #2563EB;
        }
        .s1-static {
            font-size: 17px;
            font-weight: 500;
            color: #1d1d1f;
        }
        .s1-btn {
            width: 100%;
            background: #2563EB;
            color: white;
            font-size: 17px;
            font-weight: 600;
            padding: 18px;
            border: none;
            border-radius: 22px;
            cursor: pointer;
            margin-top: 40px;
            font-family: inherit;
            letter-spacing: -0.01em;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .s1-btn:hover { background: #1D4ED8; }
        .s1-btn:active { transform: scale(0.95); }

        /* ── H1 responsive — évite débordement sur petits écrans (iPhone SE, Galaxy A) ── */
        #hTitle { font-size: clamp(24px, 8vw, 34px); }

        /* ═══════════════════════════════════
           RESPONSIVE — desktop / tablette
           ═══════════════════════════════════ */
        @media (min-width: 600px) {
            body { background: #EBEBF0; }
            .max-w-lg { padding-top: 32px; }
            .card, .stage, #s1 > div {
                box-shadow: 0 2px 12px rgba(0,0,0,0.06), 0 0 0 0.5px rgba(0,0,0,0.03);
            }
            #successCard { padding: 52px 44px 40px; }
        }
        @media (min-width: 768px) {
            .shirts-grid { gap: 20px; }
        }

        ::-webkit-scrollbar { width: 0; }

        /* ── Apple Success Overlay ── */
        @keyframes sfOverlayIn {
            from { opacity: 0; }
            to   { opacity: 1; }
        }
        @keyframes sfCardIn {
            from { opacity: 0; transform: scale(.86) translateY(32px); }
            to   { opacity: 1; transform: scale(1)  translateY(0); }
        }
        @keyframes sfCheckDraw {
            to { stroke-dashoffset: 0; }
        }
        @keyframes sfCheckBg {
            0%   { transform: scale(.6); opacity: 0; }
            60%  { transform: scale(1.12); opacity: 1; }
            100% { transform: scale(1); }
        }
        #successOverlay { display:none; }
        #successOverlay.sf-on {
            display: flex;
            position: fixed; inset: 0; z-index: 9999;
            align-items: center; justify-content: center;
            background: rgba(0,0,0,.52);
            backdrop-filter: blur(28px); -webkit-backdrop-filter: blur(28px);
            animation: sfOverlayIn .22s ease;
            padding: env(safe-area-inset-top,0px) env(safe-area-inset-right,0px)
                     env(safe-area-inset-bottom,0px) env(safe-area-inset-left,0px);
        }
        #successCard {
            background: #fff; border-radius: 28px;
            padding: 40px 32px 32px; width: min(370px, calc(100vw - 40px));
            text-align: center;
            box-shadow: 0 48px 120px rgba(0,0,0,.38);
            animation: sfCardIn .42s cubic-bezier(.34,1.44,.64,1);
        }
        .sf-check-circle {
            width: 80px; height: 80px; border-radius: 50%;
            background: #34C759; margin: 0 auto 24px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 28px rgba(52,199,89,.38);
            animation: sfCheckBg .42s cubic-bezier(.34,1.44,.64,1);
        }
        .sf-check-path {
            stroke-dasharray: 52; stroke-dashoffset: 52;
            animation: sfCheckDraw .5s .25s cubic-bezier(.4,0,.2,1) forwards;
        }
        .sf-btn-primary {
            display: block; text-decoration: none; text-align: center;
            width: 100%; background: #007AFF; color: #fff;
            border: none; border-radius: 14px; padding: 16px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            margin-bottom: 10px; font-family: inherit;
            transition: opacity .15s;
        }
        .sf-btn-primary:active { opacity: .8; }
        .sf-btn-secondary {
            width: 100%; background: #F2F2F7; color: #1A1A1A;
            border: none; border-radius: 14px; padding: 16px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            font-family: inherit; transition: opacity .15s;
        }
        .sf-btn-secondary:active { opacity: .6; }
        /* Zoom léger au survol — style Apple */
        .svg-view {
            transition: transform 0.38s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }
        .shirt-col:hover .svg-view {
            transform: scale(1.06);
        }
    </style>
</head>
<body>

<div class="max-w-lg mx-auto px-5 pt-6 pb-16">

    <!-- ════════════════════════════════════════
         HEADER
         ════════════════════════════════════════ -->
    <header class="mb-4">
        <p class="text-[11px] font-semibold text-gray-400 uppercase tracking-[0.2em]" id="hLabel">Etape 1 sur 3</p>
        <h1 class="text-[34px] font-black tracking-tight text-gray-900 leading-tight mt-1" id="hTitle">Client</h1>
        <span id="hNum" class="hidden">1</span>
        <div class="mt-5 h-[2px] bg-gray-200 rounded-full overflow-hidden">
            <div class="h-full bg-blue-600 rounded-full transition-all duration-500" id="hBar" style="width:33.33%"></div>
        </div>
    </header>

    <!-- ════════════════════════════════════════
         STEP 1 — CLIENT  (A: Commande, B: Date, C: Nom, D: Telephone)
         Single-line iCloud/Apple Business style
         ════════════════════════════════════════ -->
    <div id="s1" class="step active mt-8">
        <div class="bg-white rounded-[32px] px-7 pt-7 pb-7" style="box-shadow:0 2px 16px rgba(0,0,0,0.04);">
            <div class="divide-y divide-gray-100">

                <!-- ID — une ligne, mono -->
                <div class="flex items-center py-3">
                    <span class="w-24 shrink-0 text-[12px] font-black text-gray-300 uppercase tracking-[0.18em]">ID</span>
                    <span class="text-[17px] font-semibold text-gray-900 tracking-tight select-all truncate" id="orderNo">—</span>
                </div>

                <!-- DATE — une ligne -->
                <div class="flex items-center py-3">
                    <span class="w-24 shrink-0 text-[12px] font-black text-gray-300 uppercase tracking-[0.18em]">DATE</span>
                    <span class="text-[17px] font-semibold text-gray-900 tracking-tight" id="orderDate">15/02/2026</span>
                </div>

                <!-- NOM — une ligne -->
                <div class="flex items-center py-3">
                    <span class="w-24 shrink-0 text-[12px] font-black text-gray-300 uppercase tracking-[0.18em]">NOM</span>
                    <input type="text" id="clientNom"
                           class="flex-1 min-w-0 p-0 bg-transparent text-[17px] font-semibold text-gray-900 tracking-tight placeholder:text-gray-300 placeholder:font-normal outline-none border-0 focus:ring-0"
                           placeholder="Dubois" autocomplete="family-name" autocapitalize="words">
                </div>

                <!-- PRÉNOM — une ligne -->
                <div class="flex items-center py-3">
                    <span class="w-24 shrink-0 text-[12px] font-black text-gray-300 uppercase tracking-[0.18em]">PRÉNOM</span>
                    <input type="text" id="clientPrenom"
                           class="flex-1 min-w-0 p-0 bg-transparent text-[17px] font-semibold text-gray-900 tracking-tight placeholder:text-gray-300 placeholder:font-normal outline-none border-0 focus:ring-0"
                           placeholder="Pierre" autocomplete="given-name" autocapitalize="words">
                </div>

                <!-- TEL — une ligne -->
                <div class="flex items-center py-3">
                    <span class="w-24 shrink-0 text-[12px] font-black text-gray-300 uppercase tracking-[0.18em]">TEL</span>
                    <input type="tel" id="clientPhone"
                           class="flex-1 min-w-0 p-0 bg-transparent text-[17px] font-semibold text-gray-900 tracking-tight placeholder:text-gray-300 placeholder:font-normal outline-none border-0 focus:ring-0"
                           placeholder="0690 00 00 00">
                </div>

                <!-- LIMIT — une ligne -->
                <div class="flex items-center py-3">
                    <span class="w-24 shrink-0 text-[12px] font-black text-gray-300 uppercase tracking-[0.18em]">LIMIT</span>
                    <input type="date" id="clientDeadline"
                           class="flex-1 min-w-0 p-0 bg-transparent text-[17px] font-semibold text-gray-900 tracking-tight outline-none border-0 focus:ring-0">
                </div>

            </div>
        </div>

        <!-- Bouton Continuer -->
        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold text-[17px] py-4 rounded-[22px] mt-5 active:scale-95 transition-all cursor-pointer" onclick="go(2)">
            Continuer
        </button>
    </div>

    <!-- ════════════════════════════════════════
         STEP 2 — CONFIGURATEUR
         (E: Collection, F: Reference, G: Taille, H: Couleur T-shirt,
          I: Motif Logo Av, J: Motif Logo Ar, K: Logo Arriere, L: Note)
         ════════════════════════════════════════ -->
    <div id="s2" class="step mt-6">

        <!-- Stage — grille double t-shirt -->
        <div class="stage p-4">

            <!-- Grille invisible : 2 colonnes parfaitement alignées -->
            <div class="shirts-grid" id="shirtsGrid">

                <!-- ── Avant ── -->
                <div class="shirt-col active" id="colFront" onclick="flipSide('front')">
                    <p class="shirt-side-label">Avant</p>
                    <div class="svg-view" id="svgViewFront">
                        <div class="svg-box" id="svgBoxFront"></div>
                        <div class="logo-tap-overlay logo-tap-front" id="logoTapFront">
                            <div class="logo-tap-pip">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg>
                            </div>
                        </div>
                        <div class="logo-zone empty" id="logoZoneFront" data-side="front"
                             style="left:66.5%;top:28%;width:18.9%;height:12.6%;">
                            <div class="logo-inner" id="logoInnerFront"></div>
                            <div class="logo-frame"></div>
                        </div>
                        <!-- Badge BIO (Apple-style) — visible si référence BIO -->
                        <div class="bio-badge" id="bioBadge">
                            <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34L5.71 22l1-2.3A4.49 4.49 0 008 20C19 20 22 3 22 3c-1 2-8 2-8 2z"/></svg>
                            100% BIO
                        </div>
                    </div>
                </div>

                <!-- ── Arrière ── -->
                <div class="shirt-col" id="colBack" onclick="flipSide('back')">
                    <p class="shirt-side-label">Arrière</p>
                    <div class="svg-view" id="svgViewBack">
                        <div class="svg-box" id="svgBoxBack"></div>
                        <div class="logo-tap-overlay logo-tap-back" id="logoTapBack">
                            <div class="logo-tap-pip">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg>
                            </div>
                        </div>
                        <div class="logo-zone empty" id="logoZoneBack" data-side="back"
                             style="left:47.9%;top:31%;width:67.2%;height:44.8%;">
                            <div class="logo-inner" id="logoInnerBack"></div>
                            <div class="logo-frame"></div>
                        </div>
                    </div>
                    <!-- Côte logo arrière — saisie manuelle (H-001 : auto) -->
                    <div class="flex items-center justify-center gap-1 mt-1" onclick="event.stopPropagation()">
                        <input type="text" inputmode="numeric" id="coteLogoAr"
                               class="w-14 text-center text-[11px] font-bold bg-transparent outline-none"
                               style="color:var(--accent);border-bottom:1.5px solid var(--accent);"
                               placeholder="— mm"
                               onclick="event.stopPropagation()">
                        <span class="text-[11px] font-semibold" style="color:var(--accent)">mm</span>
                    </div>
                </div>

            </div><!-- /shirts-grid -->

            <!-- Float bar logo (affiché quand un logo est placé sur le côté actif) -->
            <div class="logo-float-bar" id="logoFloatBar" style="display:none;">
                <button class="fbar-btn fbar-change" onclick="openLogoSheet()">Changer</button>
                <button class="fbar-btn fbar-remove" onclick="dropLogo()">Retirer</button>
            </div>

        </div><!-- /stage -->

        <!-- Couleur T-shirt — menu déroulant -->
        <div class="card p-5 mt-3">
            <label class="label ml-1 mb-2 block">Couleur T-shirt</label>
            <div class="aselect" id="colorSelect"></div>
        </div>

        <!-- Collection -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Collection</label>
            <div class="aselect" id="selCollection"></div>
        </div>

        <!-- Reference (dropdown: H-001, F-001...) -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Reference</label>
            <div class="aselect" id="selRef"></div>
        </div>

        <!-- Taille -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Taille</label>
            <div class="aselect" id="selSize"></div>
        </div>


        <!-- Note -->
        <div class="card p-5">
            <p class="label mb-3">Note</p>
            <textarea id="note" class="input" rows="2" placeholder="Commentaires specifiques..."></textarea>
        </div>

        <div class="flex gap-3">
            <button class="btn btn-ghost" onclick="go(1)" style="flex:0 0 auto;width:auto;padding:16px 20px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="btn btn-primary" onclick="go(3)" style="flex:1;">Paiement</button>
        </div>
    </div>

    <!-- ════════════════════════════════════════
         STEP 3 — PAIEMENT
         (M: Prix T-shirt, N: Personnalisation, O: Total, P: Paye, Q: Fiche)
         ════════════════════════════════════════ -->
    <div id="s3" class="step mt-6">

        <!-- T-SHIRT -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">T-Shirt</label>
            <div class="aselect" id="selPrice"></div>
        </div>

        <!-- PERSO -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Perso</label>
            <div class="aselect" id="selPerso"></div>
        </div>

        <!-- TOTAL -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Total</label>
            <div class="aselect" style="pointer-events:none;">
                <div class="aselect-trigger" id="totalLabel">25 €</div>
            </div>
        </div>

        <!-- STATUT -->
        <div class="card p-5">
            <label class="label ml-1 mb-2 block">Statut</label>
            <div class="flex gap-2" id="payStatus">
                <button class="pay-opt on" data-p="non" onclick="setPay('non')"
                    style="flex:1;--pay-color:#FF3B30;--pay-bg:rgba(255,59,48,0.04);--pay-border:rgba(255,59,48,0.12);--pay-bg-on:rgba(255,59,48,0.08);--pay-border-on:rgba(255,59,48,0.35);">
                    A régler
                </button>
                <button class="pay-opt" data-p="oui" onclick="setPay('oui')"
                    style="flex:1;--pay-color:#34C759;--pay-bg:rgba(52,199,89,0.04);--pay-border:rgba(52,199,89,0.12);--pay-bg-on:rgba(52,199,89,0.08);--pay-border-on:rgba(52,199,89,0.35);">
                    Payé
                </button>
            </div>
        </div>

        <div class="flex gap-3">
            <button class="btn btn-ghost" onclick="go(2)" style="flex:0 0 auto;width:auto;padding:16px 20px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="btn btn-dark" id="subBtn" onclick="submit()" style="flex:1;">Valider la Commande</button>
        </div>
    </div>

</div>

<!-- ═══════════════════════════════════════════
     APPLE SUCCESS OVERLAY
════════════════════════════════════════════ -->
<div id="successOverlay">
    <div id="successCard">
        <div class="sf-check-circle">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                <path class="sf-check-path"
                      d="M10 21L17 28L30 13"
                      stroke="white" stroke-width="3.4"
                      stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <p style="font-size:24px;font-weight:700;color:#1A1A1A;margin:0 0 6px;letter-spacing:-.4px;">Commande envoyée</p>
        <p id="sfOrderNo" style="font-size:13px;color:#8E8E93;margin:0 0 10px;letter-spacing:.3px;font-weight:300;"></p>
        <p id="sfClientName" style="font-size:15px;color:#3A3A3C;margin:0 0 30px;font-weight:500;"></p>
        <a id="sfFicheBtn" class="sf-btn-primary" target="_blank" rel="noopener">Voir le Dashboard ›</a>
        <button class="sf-btn-secondary" onclick="location.reload()">Nouvelle commande</button>
    </div>
</div>

<!-- ═══════════════════════════════════════════
     LOGO BOTTOM SHEET (sélecteur Apple-style)
════════════════════════════════════════════ -->
<div class="lsheet-backdrop" id="lsheetBackdrop" onclick="closeLogoSheet()"></div>
<div class="lsheet" id="lsheet">
    <div class="lsheet-handle-row"><div class="lsheet-handle"></div></div>
    <div class="lsheet-header">
        <span class="lsheet-title" id="lsheetTitle">Logo Avant</span>
        <button class="lsheet-close-btn" onclick="closeLogoSheet()">✕</button>
    </div>
    <div class="lsheet-scroll">
        <!-- Couleur du logo (visible quand un logo Atelier est sélectionné) -->
        <div class="lsheet-color-section" id="lsheetColorSection">
            <div class="lsheet-group-label">Couleur du logo</div>
            <div class="lsheet-color-row" id="lsheetColorRow"></div>
            <div class="lsheet-sep"></div>
        </div>
        <!-- Grille des logos Atelier -->
        <div id="lsheetLogoGrid"></div>
        <!-- Upload mon logo -->
        <div class="lsheet-sep"></div>
        <label class="lsheet-upload-row" for="fileIn">
            <div class="lsheet-upload-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
            </div>
            <div>
                <p style="font-size:15px;font-weight:600;color:var(--text-1);letter-spacing:-0.02em;margin:0 0 2px;">Mon logo</p>
                <p style="font-size:12px;color:var(--text-3);margin:0;">PNG, JPEG, SVG</p>
            </div>
        </label>
        <div class="upload-pill mt-3" id="upPill">
            <img id="upThumb" src="" alt="">
            <div style="min-width:0">
                <p class="text-[13px] font-semibold truncate" id="upName">logo.png</p>
                <p class="text-[11px]" style="color:var(--text-3)">Personnalisé</p>
            </div>
            <button class="x" onclick="rmUpload()">×</button>
        </div>
    </div>
</div>
<input type="file" accept="image/png,image/jpeg,image/svg+xml,image/webp" class="hidden" id="fileIn" onchange="onUpload(event)">

<canvas id="exportCanvas" width="800" height="1100" class="hidden"></canvas>

<script>
(function(){
'use strict';

/* ══════════════════════════════════════
   CONFIG
   ══════════════════════════════════════ */
const API = "https://script.google.com/macros/s/AKfycbyzeU0tD22L8wZ94PW0f4s1a2LH7fNPhK74RtjcIXs0pWAP59anDV8EYtYlP8WX5iCk/exec";

/* ── Dashboard OLDA — même domaine que le formulaire ── */
const DASHBOARD_URL   = 'https://dashboardolda-production.up.railway.app';
const DASHBOARD_TOKEN = "d1e9c4cd170eb57f8ce6254b5aa70b7f708e465d48daefc7f3b0b7e16bd9f4dc";

const COLORS = [
    /* ── Basiques (les + commandés) ── */
    {n:'Blanc',              h:'#FFFFFF'},
    {n:'Noir',               h:'#1A1A1A'},
    {n:'Black',              h:'#0D0D0D'},
    {n:'Gris',               h:'#9B9B9B'},
    {n:'Navy',               h:'#001F4D'},
    {n:'Navy Blue',          h:'#003087'},
    {n:'Sport Navy',         h:'#1F3A5F'},
    {n:'Royal Blue',         h:'#0A3D91'},
    {n:'True Royal',         h:'#2563EB'},
    {n:'Royal',              h:'#1155CC'},
    {n:'Rouge',              h:'#CC1517'},
    {n:'Orange',             h:'#FF6600'},
    /* ── Gris ── */
    {n:'Dark Grey',          h:'#3D3D3D'},
    {n:'Oxford Grey',        h:'#545454'},
    {n:'Iron Grey',          h:'#666666'},
    {n:'Heather Dark Grey',  h:'#4A4A4A'},
    {n:'Fine Grey',          h:'#AEAEB2'},
    /* ── Bleus ── */
    {n:'Sky Blue',           h:'#87CEEB'},
    {n:'Light Blue',         h:'#ADD8E6'},
    {n:'Cool Blue',          h:'#4A90D9'},
    {n:'Light Royal Blue',   h:'#4169E1'},
    {n:'Baltic Blue',        h:'#2E5FA3'},
    {n:'Sea Blue',           h:'#2C6E8A'},
    {n:'Tropical Blue',      h:'#0077B6'},
    {n:'Aqua Blue',          h:'#00B5CC'},
    {n:'Aquamarine',         h:'#7FFFD4'},
    {n:'Vintage Blue',       h:'#4A6D8C'},
    /* ── Kakis / Olives ── */
    {n:'Kaki',               h:'#8B8456'},
    {n:'Khaki',              h:'#C3B091'},
    {n:'Dark Kaki',          h:'#5C5A3A'},
    {n:'Organic Kaki',       h:'#9C8E5A'},
    {n:'Urban Kaki',         h:'#6E6A3D'},
    {n:'Olive',              h:'#808000'},
    {n:'Olive Green',        h:'#6B7C43'},
    {n:'Light Olive Green',  h:'#A8BE8C'},
    {n:'Light Army Green',   h:'#7D8A5C'},
    /* ── Verts ── */
    {n:'Forest Green',       h:'#228B22'},
    {n:'Green Field',        h:'#5A8A3C'},
    {n:'Jade Green',         h:'#00A86B'},
    {n:'Almond Green',       h:'#8DB48E'},
    {n:'Mint Green',         h:'#98FF98'},
    {n:'Bright Seafoam',     h:'#3EFFC5'},
    /* ── Sables / Naturels ── */
    {n:'Sand',               h:'#C2A679'},
    {n:'Light Sand',         h:'#EAD9B8'},
    {n:'West Sand',          h:'#BCA98A'},
    {n:'Wet Sand',           h:'#B0A08A'},
    {n:'Union Beige',        h:'#D4C5A9'},
    {n:'Driftwood',          h:'#B5A380'},
    {n:'Raw Natural',        h:'#D9CBAD'},
    {n:'Ivory',              h:'#FFFFF0'},
    {n:'Ivoir',              h:'#F5EDD8'},
    {n:'Coconut Milk',       h:'#FAF0E6'},
    {n:'Washed Cream Coffee',h:'#C4A97A'},
    /* ── Coraux / Rouges chauds ── */
    {n:'Coral',              h:'#FF7F6E'},
    {n:'Soft Coral',         h:'#F4845F'},
    {n:'Terracotta Red',     h:'#C25B3C'},
    {n:'Paprika',            h:'#A31D1D'},
    {n:'Clementine Heather', h:'#D4603A'},
    {n:'Washed Sienna',      h:'#A0522D'},
    /* ── Pastel / Doux ── */
    {n:'Peach',              h:'#FFCBA4'},
    {n:'Petal Rose',         h:'#F4A7B9'},
    {n:'Pineapple',          h:'#E8C84A'},
];

const LOGO_COLORS = [
    {n:'Noir',    h:'#1A1A1A'},{n:'Blanc',   h:'#FFFFFF'},{n:'Marine',  h:'#00205B'},
    {n:'Rouge',   h:'#FF3B30'},{n:'Or',      h:'#C5A44E'},{n:'Argent',  h:'#A8A8A8'},
    {n:'Royal',   h:'#003087'},{n:'Vert',    h:'#228B22'},{n:'Jaune',   h:'#FFD700'},
    {n:'Rose',    h:'#FF69B4'},{n:'Orange',  h:'#FF6600'},{n:'Violet',  h:'#6B46C1'}
];

/* ── Catalogue références ── */
const REFERENCES = {
    'H-001': { fournisseur: 'NS300', desc: 'T-shirt Léger NATIVE SPIRIT NS300 100% CotonBIO', prix: 35, bio: true, largeurs: { XS: 220, S: 250, M: 270, L: 300, XL: 320, XXL: 320 } },
    'H-002': { fournisseur: 'NS300', prix: 39, largeurs: { XS: 220, S: 250, M: 270, L: 300, XL: 320, XXL: 320 } }
};

const FABRIC_RE = /rgb\(100%,\s*100%,\s*100%\)/gi;

const LOGOS = {
    bea:[
        {id:'bea-1',n:'Classic',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><circle cx="60" cy="60" r="50" stroke="#1A1A1A" stroke-width="3" fill="none"/><text x="60" y="52" text-anchor="middle" font-size="28" font-weight="800" fill="#1A1A1A" font-family="sans-serif">BEA</text><text x="60" y="74" text-anchor="middle" font-size="12" font-weight="600" fill="#1A1A1A" letter-spacing="4" font-family="sans-serif">ATELIER</text><line x1="28" y1="82" x2="92" y2="82" stroke="#1A1A1A" stroke-width="1.5"/><text x="60" y="98" text-anchor="middle" font-size="10" fill="#1A1A1A" font-family="sans-serif">— 16 —</text></svg>`},
        {id:'bea-2',n:'Minimal',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><rect x="15" y="25" width="90" height="70" rx="4" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><text x="60" y="60" text-anchor="middle" font-size="32" font-weight="900" fill="#1A1A1A" font-family="sans-serif">B</text><text x="60" y="82" text-anchor="middle" font-size="9" font-weight="600" fill="#1A1A1A" letter-spacing="6" font-family="sans-serif">BEAUTE</text></svg>`},
        {id:'bea-3',n:'Script',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><text x="60" y="55" text-anchor="middle" font-family="Georgia,serif" font-size="36" font-style="italic" font-weight="700" fill="#1A1A1A">Bea</text><line x1="20" y1="65" x2="100" y2="65" stroke="#1A1A1A" stroke-width="1"/><text x="60" y="82" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="5" font-family="sans-serif">COLLECTION 16</text></svg>`},
        {id:'bea-16-ar',n:'BEA Dos',s:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="-59 -72 349.4 427.46"><path fill="#1A1A1A" d="M169.38,181.76c-.73-17.73,10.77-20.48,18.93-4.16,6.75-3.31,18.29-4.43,17.53,4.39.1,10.2-26.77,23.17-32.7,22.29-5.54-.63-2.69-20.7-3.77-22.52Z"/><path fill="#1A1A1A" d="M55.02,47.4c.51,2.08,1.16,4.32,1.93,6.71.77,2.39,1.44,4.84,1.99,7.34.56,2.5.91,4.98,1.06,7.44.15,2.46-.1,4.77-.74,6.92-.69,2.15-1.49,3.73-2.41,4.74-.92,1.01-1.88,1.51-2.86,1.51s-1.96-.49-2.92-1.46c-.96-.97-1.83-2.36-2.6-4.16-1.33-3.19-2.52-6.52-3.57-9.99-1.05-3.47-2.02-6.99-2.92-10.57-.9-3.57-1.78-7.2-2.64-10.88-.86-3.68-1.76-7.32-2.7-10.93l-.19,3.33c-.17,2.15-.35,4.42-.55,6.82-.19,2.39-.51,4.74-.96,7.03-.45,2.29-1.07,4.37-1.86,6.25-.79,1.87-1.85,3.37-3.18,4.48-1.11.9-2.16,1.29-3.15,1.15-.99-.14-1.92-.62-2.8-1.46-.88-.83-1.69-1.94-2.44-3.33-.75-1.39-1.45-2.92-2.09-4.58.26,2.99.43,5.48.51,7.5,0,.83.03,1.89.1,3.18.06,1.29.02,2.57-.13,3.85-.15,1.29-.47,2.41-.96,3.38-.49.97-1.32,1.56-2.47,1.77-.86.14-1.55-.05-2.09-.57-.54-.52-.98-1.23-1.32-2.13-.34-.9-.61-1.93-.8-3.07s-.35-2.24-.48-3.28c-.51-3.4-.91-6.85-1.19-10.36-.28-3.5-.53-6.99-.74-10.46-.21-3.47-.43-6.96-.64-10.46-.21-3.5-.49-6.99-.84-10.46-.13-1.46-.22-2.86-.29-4.22s-.02-2.62.13-3.8c.15-1.18.46-2.27.93-3.28.47-1.01,1.18-1.93,2.12-2.76.99-.83,1.85-1.2,2.6-1.09.75.1,1.44.5,2.06,1.2.62.69,1.19,1.61,1.7,2.76.51,1.15,1.01,2.31,1.48,3.49,1.07,2.71,2.12,5.41,3.15,8.12,1.03,2.71,2.1,5.38,3.21,8.02.21-3.47.52-6.91.93-10.31.41-3.4.99-6.51,1.74-9.32.75-2.81,1.72-5.22,2.92-7.24,1.2-2.01,2.72-3.33,4.56-3.96,1.46-.48,2.73-.24,3.82.73,1.09.97,2.06,2.33,2.89,4.06.84,1.74,1.57,3.66,2.22,5.78.64,2.12,1.22,4.01,1.74,5.67,1.58,5.07,3.07,10.19,4.47,15.36,1.39,5.17,2.82,10.36,4.27,15.56Z"/><path fill="#1A1A1A" d="M103.32,28.35c-.54-2.71-1.51-5.21-2.92-7.5-1.29-2.15-2.79-3.89-4.5-5.21-1.71-1.32-3.5-2.31-5.37-2.97-1.86-.66-3.77-1.04-5.72-1.15-1.95-.1-3.78-.05-5.5.16-1.41.28-2.84.61-4.27.99-1.44.38-2.82.97-4.15,1.77-1.33.8-2.57,1.82-3.73,3.07-1.16,1.25-2.14,2.85-2.96,4.79-.77,1.87-1.22,3.64-1.35,5.31-1.24,2.92-2.24,6.02-2.99,9.32-.75,3.3-1.18,6.61-1.29,9.94-.11,3.33.13,6.61.71,9.84.58,3.23,1.62,6.23,3.12,9.01,1.67,3.12,3.6,5.35,5.79,6.66,2.19,1.32,4.47,1.94,6.85,1.87,2.38-.07,4.79-.73,7.23-1.98,2.44-1.25,4.78-2.88,7.01-4.89,2.23-2.01,4.27-4.3,6.14-6.87,1.86-2.57,3.4-5.21,4.6-7.91,1.07-2.36,1.96-4.91,2.67-7.65.71-2.74,1.12-5.52,1.25-8.33.13-2.81-.08-5.57-.61-8.28ZM91.02,45.43c-.9,1.81-2.04,3.38-3.41,4.74-1.37,1.35-2.81,2.48-4.31,3.38-1.5.9-2.7,1.49-3.6,1.77-1.37.35-2.68.42-3.92.21-1.24-.21-2.37-.75-3.37-1.61-1.01-.87-1.85-2.1-2.54-3.7-.69-1.6-1.14-3.61-1.35-6.04-.26-2.78-.15-5.59.32-8.43.94-.55,1.82-1.6,2.64-3.12.68-.21,1.6-.42,2.73-.62,1.14-.21,2.26-.38,3.37-.52,1.11-.14,2.1-.24,2.96-.31.86-.07,1.37-.1,1.54-.1.81.14,1.76.38,2.83.73,1.07.35,2.1.85,3.09,1.51.99.66,1.85,1.51,2.6,2.55.75,1.04,1.21,2.33,1.38,3.85.26,2.01-.06,3.92-.96,5.73Z"/><path fill="#1A1A1A" d="M150.6,60.21c-.73-2.57-1.69-4.96-2.89-7.18-1.2-2.22-2.55-4.25-4.05-6.09-1.5-1.84-2.91-3.38-4.24-4.63h.06c1.2-1.53,2.31-3.23,3.34-5.1,1.2-2.15,2.16-4.51,2.89-7.08.73-2.57,1.12-5.12,1.19-7.65.06-2.53-.28-4.95-1.03-7.24-.75-2.29-2.02-4.27-3.82-5.93-1.67-1.53-3.53-2.65-5.56-3.38-2.04-.73-4.11-1.2-6.24-1.41-2.12-.21-4.23-.21-6.33,0-2.1.21-4.07.49-5.91.83-.64.14-1.55.35-2.73.62-1.18.28-2.44.68-3.79,1.2-1.35.52-2.68,1.18-3.99,1.98-1.31.8-2.43,1.77-3.37,2.92-.94,1.15-1.58,2.5-1.93,4.06-.34,1.56-.21,3.35.39,5.36.6,2.01,1.4,3.09,2.41,3.23,1.01.14,2-.28,2.99-1.25.47,6.73,1.13,13.38,1.99,19.94.86,6.56,1.74,13.14,2.64,19.73.17,1.25.35,2.65.55,4.22.19,1.56.47,3.05.84,4.48.36,1.42.85,2.65,1.45,3.7.6,1.04,1.39,1.63,2.38,1.77.73.14,1.42-.05,2.09-.57.66-.52,1.26-1.21,1.8-2.08.54-.87,1-1.84,1.38-2.92.39-1.08.64-2.1.77-3.07.34-2.29.32-4.74-.06-7.34-.39-2.6-.86-5.15-1.41-7.65,3,1.6,5.92,3.47,8.77,5.62,2.85,2.15,5.37,5.03,7.55,8.64.51.9,1.05,1.94,1.61,3.12.56,1.18,1.16,2.29,1.8,3.33.64,1.04,1.33,1.87,2.06,2.5.73.62,1.54.8,2.44.52.64-.21,1.23-.62,1.77-1.25.54-.62,1.01-1.37,1.41-2.24.41-.87.75-1.79,1.03-2.76.28-.97.46-1.94.55-2.92.21-2.78-.04-5.45-.77-8.02ZM135.23,29.13c-.6.8-1.26,1.53-1.99,2.19-.73.66-1.47,1.22-2.22,1.67-.75.45-1.4.78-1.96.99-.47-.07-1.15-.28-2.02-.62-.88-.35-1.82-.64-2.83-.88-1.01-.24-2-.35-2.99-.31-.99.04-1.82.36-2.51.99l-1.93-13.22c1.76-.07,3.47,0,5.14.21,1.67.21,3.23.45,4.69.73.81.14,1.7.3,2.67.47.96.17,1.91.43,2.83.78.92.35,1.78.89,2.57,1.61.79.73,1.42,1.72,1.9,2.97-.3.83-.75,1.65-1.35,2.45Z"/><path fill="#1A1A1A" d="M197.59,47.3c1.11.42,1.87,1.08,2.28,1.98.41.9.57,1.93.48,3.07-.09,1.15-.36,2.36-.84,3.64-.47,1.29-1.01,2.52-1.61,3.7-.6,1.18-1.22,2.26-1.86,3.23-.64.97-1.18,1.7-1.61,2.19-1.29,1.46-2.82,3-4.6,4.63-1.78,1.63-3.68,3.12-5.69,4.48-2.01,1.35-4.07,2.43-6.17,3.23-2.1.8-4.11,1.11-6.04.94-1.93-.17-3.7-.97-5.3-2.39-1.61-1.42-2.92-3.7-3.95-6.82-.34-1.04-.73-2.51-1.16-4.42-.43-1.91-.86-4.11-1.29-6.61-.21.14-.41.26-.58.36-.17.1-.36.23-.58.36-.86.56-1.6.69-2.22.42-.62-.28-1.11-.82-1.48-1.61-.36-.8-.58-1.77-.64-2.92s.07-2.27.42-3.38c.34-1.11.81-2.08,1.41-2.92.6-.83,1.26-1.6,1.99-2.29-.34-3.19-.58-6.38-.71-9.58-.13-3.19-.11-6.25.06-9.16-.64.42-1.29.88-1.93,1.41-.64.52-1.29,1.06-1.93,1.61-.99.83-1.92,1.22-2.8,1.15-.88-.07-1.58-.48-2.12-1.25-.54-.76-.86-1.82-.96-3.18-.11-1.35.16-2.86.8-4.53.47-1.32,1.13-2.5,1.96-3.54.84-1.04,1.72-2.01,2.67-2.92.94-.9,1.91-1.7,2.89-2.39.99-.69,1.89-1.32,2.7-1.87,1.97-1.46,4.05-2.74,6.24-3.85,2.19-1.11,4.4-1.99,6.65-2.65,2.25-.66,4.51-1.04,6.78-1.15,2.27-.1,4.48.19,6.62.88.81.28,1.65.61,2.51.99.86.38,1.58.9,2.19,1.56.6.66,1.02,1.53,1.25,2.6.24,1.08.18,2.45-.16,4.11-.6,2.64-1.54,4.39-2.83,5.26-1.29.87-2.7,1.37-4.24,1.51-2.96.28-5.82.49-8.58.62-2.76.14-5.5.56-8.2,1.25.13,1.81.17,3.78.13,5.93-.04,2.15-.02,3.96.06,5.41l.39,4.37c1.29-1.04,2.64-2.05,4.05-3.02,1.41-.97,2.84-1.82,4.27-2.55,1.44-.73,2.85-1.25,4.24-1.56,1.39-.31,2.73-.33,4.02-.05,1.33.28,2.21.76,2.64,1.46.43.69.56,1.51.39,2.45-.17.94-.55,1.93-1.12,2.97-.58,1.04-1.24,2.03-1.99,2.97-.75.94-1.5,1.77-2.25,2.5-.75.73-1.34,1.23-1.77,1.51-1.8,1.25-3.6,2.41-5.4,3.49-1.8,1.08-3.6,2.13-5.4,3.18.81,4.16,2,6.77,3.57,7.81,1.56,1.04,3.76.76,6.59-.83,3.04-1.73,5.91-3.71,8.61-5.93.6-.48,1.27-1.11,2.02-1.87.75-.76,1.53-1.49,2.35-2.19.81-.69,1.63-1.23,2.44-1.61.81-.38,1.58-.43,2.31-.16Z"/><path fill="#1A1A1A" d="M52.32,111.99c-.34-2.12-1.48-4.12-3.41-6-1.63-1.58-3.55-2.62-5.75-3.14-2.21-.51-4.45-.83-6.72-.96.73-.97,1.42-1.97,2.09-3,.66-1.03,1.27-2.12,1.83-3.28,1.41-2.85,2.07-5.44,1.96-7.78-.11-2.33-.7-4.32-1.77-5.96-1.07-1.64-2.5-2.91-4.27-3.82-1.78-.91-3.65-1.36-5.62-1.36-1.8,0-3.74.18-5.82.55-2.08.36-4.17.97-6.27,1.82-.6-.55-1.35-.74-2.25-.59-.9.15-1.82.83-2.76,2.05-.43.61-.84,1.27-1.22,2-1.97,1.52-3.62,3.25-4.95,5.19-.6.91-1.02,1.97-1.25,3.18-.24,1.21-.26,2.34-.06,3.37.19,1.03.6,1.88,1.22,2.55.62.67,1.49.94,2.6.82h.39c.09,2.24.25,4.47.48,6.69.24,2.21.46,4.29.67,6.23-.34,2.06-.21,3.67.39,4.82.09,2.06.18,4.69.29,7.87.11,3.18.35,6.29.74,9.33-.73.67-1.38,1.47-1.96,2.41-.58.94-.98,1.93-1.19,2.96-.39,2-.38,3.56.03,4.69.41,1.12,1.08,1.88,2.02,2.27.94.39,2.11.51,3.5.36,1.39-.15,2.86-.49,4.4-1,1.54-.52,3.11-1.14,4.69-1.87,1.58-.73,3.05-1.44,4.4-2.14,1.35-.7,2.53-1.35,3.54-1.96,1.01-.61,1.72-1.03,2.15-1.27.99-.61,2.3-1.52,3.95-2.73,1.65-1.21,3.34-2.65,5.08-4.32,1.74-1.67,3.35-3.5,4.85-5.5,1.5-2,2.62-4.05,3.37-6.14.75-2.09.95-4.2.61-6.32ZM19.99,96.98c-.34-1.76-.62-3.49-.84-5.19.73-.3,1.47-.59,2.22-.86.75-.27,1.51-.5,2.28-.68.9-.18,1.83-.33,2.8-.45.96-.12,1.9-.09,2.8.09.21.06.61.26,1.19.59.58.33,1.1.62,1.57.86-.64.67-1.38,1.43-2.22,2.27-.84.85-1.64,1.68-2.41,2.5-.77.82-1.46,1.53-2.06,2.14-.6.61-.96.97-1.09,1.09-.51.36-1.07.7-1.67,1-.6.3-1.22.61-1.86.91-.13-1.09-.36-2.52-.71-4.28ZM36.73,121.45c-1.44.91-2.91,1.71-4.44,2.41-1.52.7-3.08,1.32-4.66,1.87-1.59.55-3.17,1.12-4.76,1.73l.13-.09c-.09-1.33-.16-2.53-.23-3.59-.06-1.06-.14-1.89-.22-2.5l-.39-3.82c1.71-.12,3.42-.21,5.11-.27,1.69-.06,3.4-.03,5.11.09.43,0,1.02-.01,1.77-.05.75-.03,1.54-.03,2.38,0,.84.03,1.64.11,2.41.23.77.12,1.37.36,1.8.73-1.24,1.27-2.58,2.37-4.02,3.28Z"/><path fill="#1A1A1A" d="M98.6,115.9c1.11.36,1.87.94,2.28,1.73.41.79.57,1.68.48,2.68-.09,1-.36,2.06-.84,3.18-.47,1.12-1.01,2.2-1.61,3.23-.6,1.03-1.22,1.97-1.86,2.82-.64.85-1.18,1.49-1.61,1.91-1.29,1.27-2.82,2.62-4.6,4.05-1.78,1.43-3.68,2.73-5.69,3.91-2.01,1.18-4.07,2.12-6.17,2.82-2.1.7-4.11.97-6.04.82-1.93-.15-3.7-.85-5.3-2.09-1.61-1.24-2.92-3.23-3.95-5.96-.34-.91-.73-2.2-1.16-3.87-.43-1.67-.86-3.59-1.29-5.78-.21.12-.41.23-.58.32-.17.09-.36.2-.58.32-.86.49-1.6.61-2.22.36-.62-.24-1.11-.71-1.48-1.41-.36-.7-.58-1.55-.64-2.55-.06-1,.07-1.99.42-2.96.34-.97.81-1.82,1.41-2.55.6-.73,1.26-1.39,1.99-2-.34-2.79-.58-5.58-.71-8.37-.13-2.79-.11-5.46.06-8.01-.64.36-1.29.77-1.93,1.23-.64.45-1.29.93-1.93,1.41-.99.73-1.92,1.06-2.8,1-.88-.06-1.58-.42-2.12-1.09-.54-.67-.86-1.59-.96-2.77-.11-1.18.16-2.5.8-3.96.47-1.15,1.12-2.18,1.96-3.09s1.72-1.76,2.67-2.55c.94-.79,1.91-1.49,2.89-2.09.99-.61,1.89-1.15,2.7-1.64,1.97-1.27,4.05-2.4,6.24-3.37,2.19-.97,4.4-1.74,6.65-2.32,2.25-.58,4.51-.91,6.78-1,2.27-.09,4.48.17,6.62.77.81.24,1.65.53,2.51.86.86.33,1.58.79,2.19,1.36.6.58,1.02,1.33,1.25,2.27.23.94.18,2.14-.16,3.59-.6,2.31-1.54,3.84-2.83,4.59-1.29.76-2.7,1.2-4.24,1.32-2.96.24-5.82.43-8.58.55-2.76.12-5.5.49-8.2,1.09.13,1.58.17,3.31.13,5.19-.04,1.88-.02,3.46.06,4.73l.39,3.82c1.29-.91,2.64-1.79,4.05-2.64,1.41-.85,2.84-1.59,4.27-2.23,1.44-.64,2.85-1.09,4.24-1.36,1.39-.27,2.73-.29,4.02-.05,1.33.24,2.21.67,2.64,1.27.43.61.56,1.32.39,2.14-.17.82-.55,1.68-1.12,2.59-.58.91-1.24,1.77-1.99,2.59-.75.82-1.5,1.55-2.25,2.18-.75.64-1.34,1.08-1.77,1.32-1.8,1.09-3.6,2.11-5.4,3.05-1.8.94-3.6,1.87-5.4,2.77.81,3.64,2,5.91,3.57,6.82,1.56.91,3.76.67,6.59-.73,3.04-1.52,5.91-3.24,8.61-5.19.6-.42,1.27-.97,2.02-1.64.75-.67,1.53-1.3,2.35-1.91.81-.61,1.63-1.08,2.44-1.41.81-.33,1.58-.38,2.31-.14Z"/><path fill="#1A1A1A" d="M143.27,131.24c-.21-1.67-.46-3.23-.74-4.69-.28-1.46-.53-2.64-.74-3.55.47-1.03.66-2.09.58-3.18-.09-1.09-.67-2.15-1.74-3.18l-.19-.27c-.47-2.12-.95-4.26-1.45-6.41-.49-2.15-1-4.29-1.51-6.41-.39-1.64-.76-3.35-1.12-5.14-.36-1.79-.74-3.58-1.13-5.37-.39-1.79-.81-3.55-1.29-5.28-.47-1.73-1.01-3.35-1.61-4.87.09-.36.15-.73.19-1.09.04-.36.09-.73.13-1.09.21-1.82.05-3.17-.48-4.05-.54-.88-1.23-1.38-2.09-1.5-.86-.12-1.75.14-2.67.77-.92.64-1.66,1.56-2.22,2.78l-.58,1.09c-.64.79-1.11,1.85-1.41,3.18-2.61,6.13-5.04,12.39-7.26,18.79-2.23,6.4-4.41,12.84-6.56,19.33-.47,1.4-1.01,2.88-1.61,4.46-.6,1.58-1.18,3.18-1.74,4.82-.56,1.64-1.05,3.29-1.48,4.96-.43,1.67-.71,3.29-.84,4.87-.13,1.94.05,3.38.55,4.32.49.94,1.13,1.47,1.93,1.59.79.12,1.65-.14,2.57-.77.92-.64,1.72-1.56,2.41-2.77.56-.97,1.06-2.02,1.51-3.14.45-1.12.87-2.29,1.25-3.5,3.21-.67,6.38-1.55,9.51-2.64,3.13-1.09,6.24-2.21,9.32-3.37.26,1.21.52,2.7.8,4.46.28,1.76.63,3.46,1.06,5.1.43,1.64.97,3.03,1.64,4.19.66,1.15,1.51,1.73,2.54,1.73,1.24,0,2.22-.42,2.92-1.27.71-.85,1.2-1.96,1.48-3.32.28-1.36.41-2.88.39-4.55-.02-1.67-.14-3.34-.35-5ZM123.32,119.18c-2.08,1.03-3.8,1.79-5.17,2.27.99-3.09,1.99-6.16,3.02-9.19,1.03-3.03,2.1-6.06,3.21-9.1.21-.67.46-1.33.74-2,.28-.67.57-1.33.87-2l3.79,17.29c-2.23.79-4.38,1.7-6.46,2.73Z"/><path fill="#1A1A1A" d="M193.47,123.91c.21.79.3,1.59.26,2.41-.04.82-.17,1.64-.39,2.46-.21.82-.5,1.58-.87,2.27-.36.7-.74,1.29-1.13,1.77-1.41,1.82-3.11,3.31-5.08,4.46-1.97,1.15-4.03,2.03-6.17,2.64-2.14.61-4.31.99-6.49,1.14-2.19.15-4.18.14-5.98-.05-2.7-.3-5.29-1.14-7.78-2.5-2.49-1.36-4.72-3.14-6.72-5.32s-3.69-4.73-5.08-7.64c-1.39-2.91-2.34-6.02-2.83-9.33-.49-3.31-.48-6.75.03-10.33.51-3.58,1.67-7.19,3.47-10.83,1.16-2.3,2.51-4.35,4.05-6.14,1.54-1.79,3.2-3.26,4.98-4.41,1.78-1.15,3.65-1.96,5.62-2.41,1.97-.45,3.94-.47,5.91-.05,1.58.36,3.19,1.02,4.82,1.96,1.63.94,3.09,2.17,4.37,3.68,1.29,1.52,2.32,3.31,3.12,5.37.79,2.06,1.17,4.37,1.13,6.91,0,.97-.15,1.97-.45,3-.3,1.03-.7,1.96-1.19,2.77-.49.82-1.07,1.46-1.74,1.91-.66.45-1.38.62-2.15.5-.73-.12-1.29-.45-1.67-1-.39-.55-.7-1.17-.93-1.87-.24-.7-.46-1.46-.68-2.27-.21-.82-.51-1.56-.9-2.23-.77-1.33-1.7-2.41-2.8-3.23-1.09-.82-2.25-1.36-3.47-1.64s-2.45-.29-3.7-.05c-1.24.24-2.4.73-3.47,1.46.26-.12-.02.15-.84.82-.13.24-.33.55-.61.91-.28.36-.4.52-.35.45-.43.79-.79,1.61-1.09,2.46-.56,1.46-.79,3.05-.71,4.78.09,1.73.39,3.41.9,5.05s1.19,3.17,2.02,4.59c.84,1.43,1.77,2.62,2.8,3.59,1.89,1.82,3.81,3,5.79,3.55,1.97.55,3.97.73,6.01.55,2.03-.18,4.08-.58,6.14-1.18,2.06-.61,4.09-1.15,6.11-1.64.64-.18,1.35-.35,2.12-.5.77-.15,1.52-.18,2.25-.09.73.09,1.39.36,1.99.82.6.45,1.05,1.26,1.35,2.41Z"/><path fill="#1A1A1A" d="M230.75,119.54c.17,1.52.32,3.12.45,4.82.13,1.7.19,3.37.19,5,0,2.31-.17,4.49-.52,6.55-.17.91-.46,1.9-.87,2.96-.41,1.06-.92,2.03-1.52,2.91-.6.88-1.27,1.61-2,2.18-.73.58-1.51.86-2.33.86-.95,0-1.73-.3-2.36-.91-.62-.61-1.11-1.39-1.45-2.37-.35-.97-.59-2.08-.74-3.32-.15-1.24-.23-2.53-.23-3.87,0-1.21.02-2.38.06-3.5.04-1.12.09-2.17.13-3.14,0-.36,0-.59.03-.68.02-.09.03-.15.03-.18v-.41c-2.27,1.21-4.48,2.23-6.62,3.05-2.14.82-4.31,1.65-6.49,2.5-.56,1.27-1.25,2.31-2.09,3.09-.84.79-1.73,1.18-2.67,1.18-1.29,0-2.44-.83-3.47-2.5-1.03-1.67-1.54-3.81-1.54-6.41l-.58-9.55c-.21-3.46-.42-6.94-.61-10.46-.19-3.52-.29-7.04-.29-10.55v-1.55c0-1.82.02-3.68.06-5.6.04-1.91.25-3.67.61-5.28.36-1.61.92-2.93,1.67-3.96.75-1.03,1.83-1.55,3.25-1.55,1.2,0,2.14.49,2.83,1.46.68.97,1.22,2.2,1.61,3.68.39,1.49.65,3.12.8,4.91.15,1.79.27,3.53.35,5.23.04.67.07,1.33.1,2,.02.67.07,1.27.16,1.82l.64,5.91c.21,1.82.43,3.53.64,5.14.21,1.61.36,3.44.45,5.5,3.64-1.64,7.22-2.76,10.73-3.37l-.84-8.83s.03-.3-.03-.91c-.06-.61-.12-1.15-.16-1.64-.04-.91-.1-1.94-.16-3.09-.06-1.15-.15-2.26-.26-3.32-.11-1.06-.23-1.99-.35-2.77-.13-.79-.28-1.24-.45-1.36-1.2-.85-1.8-2.09-1.8-3.73,0-.79.18-1.59.55-2.41.36-.82.81-1.55,1.35-2.18.54-.64,1.14-1.17,1.8-1.59.66-.42,1.3-.64,1.9-.64,1.08,0,2,.45,2.78,1.36.78.91,1.43,2.05,1.97,3.41s.98,2.84,1.32,4.41c.34,1.58.62,3.03.84,4.37.09.3.13.62.13.96s.04.65.13.96c.69,3.58,1.25,7.13,1.68,10.64.43,3.52.69,6.98.78,10.37l.39,4.37Z"/><path fill="#1A1A1A" d="M53.99,157.03c-1.18-2.33-3.16-4.25-5.95-5.76-3.04-1.58-6.28-2.41-9.71-2.51-3.43-.1-6.87.3-10.32,1.18-3.45.89-6.82,2.17-10.12,3.84-3.3,1.67-6.34,3.53-9.13,5.57-.43.33-1.05.89-1.86,1.67-.81.79-1.66,1.72-2.54,2.81-.88,1.08-1.7,2.25-2.47,3.5-.77,1.25-1.32,2.45-1.64,3.6-.32,1.15-.34,2.22-.06,3.2.28.98,1.02,1.77,2.22,2.36.51.26,1.03.31,1.54.15.51-.16,1.02-.44,1.51-.84.49-.39.95-.89,1.38-1.48.43-.59.79-1.25,1.09-1.97.99-.72,2.04-1.3,3.15-1.72,1.11-.43,2.1-.87,2.96-1.33.81-.39,1.62-.79,2.41-1.18.79-.39,1.6-.75,2.41-1.08.51,3.35,1.17,6.6,1.96,9.75.79,3.15,1.57,6.34,2.35,9.56.9,3.74,1.58,7.44,2.06,11.08.47,3.64.94,7.37,1.41,11.18-.34,1.71-.27,3.24.23,4.58.49,1.35,1.64,2.09,3.44,2.22,1.54.13,2.76-.31,3.66-1.33.9-1.02,1.54-2.35,1.93-3.99.39-1.64.58-3.48.58-5.52s-.09-4.07-.26-6.11c1.11-.66,2.13-1.35,3.05-2.07.92-.72,1.68-1.35,2.28-1.87,1.5-1.31,3.09-3.09,4.76-5.32,1.67-2.23,3.21-4.71,4.63-7.44,1.41-2.72,2.58-5.57,3.5-8.52.92-2.96,1.37-5.81,1.35-8.57-.02-2.76-.62-5.3-1.8-7.63ZM41.62,173.73c-.9,1.12-1.81,2.13-2.73,3.05-.92.92-1.86,1.79-2.83,2.61-.96.82-1.96,1.66-2.99,2.51-.39-1.51-.78-3-1.19-4.48-.41-1.48-.83-2.97-1.25-4.48-.34-1.12-.65-2.36-.93-3.74-.28-1.38-.57-2.82-.87-4.33,1.33-.2,2.75-.34,4.27-.44,1.52-.1,3-.02,4.44.25,1.44.26,2.76.79,3.99,1.58,1.22.79,2.17,1.97,2.86,3.55-.94,1.51-1.86,2.82-2.76,3.94Z"/><path fill="#1A1A1A" d="M99.81,170.08c-.54-2.56-1.51-4.93-2.92-7.09-1.29-2.03-2.79-3.68-4.5-4.93-1.71-1.25-3.5-2.18-5.37-2.81-1.86-.62-3.77-.99-5.72-1.08-1.95-.1-3.78-.05-5.5.15-1.41.26-2.84.58-4.27.94-1.44.36-2.82.92-4.15,1.67-1.33.76-2.57,1.72-3.73,2.91-1.16,1.18-2.14,2.69-2.96,4.53-.77,1.77-1.22,3.45-1.35,5.02-1.24,2.76-2.24,5.7-2.99,8.82-.75,3.12-1.18,6.26-1.29,9.41-.11,3.15.13,6.26.71,9.31.58,3.05,1.62,5.9,3.12,8.52,1.67,2.96,3.6,5.06,5.79,6.3,2.19,1.25,4.47,1.84,6.85,1.77,2.38-.06,4.79-.69,7.23-1.87,2.44-1.18,4.78-2.72,7.01-4.63,2.23-1.9,4.27-4.07,6.14-6.5,1.86-2.43,3.4-4.93,4.6-7.49,1.07-2.23,1.96-4.65,2.67-7.24.71-2.59,1.12-5.22,1.25-7.88.13-2.66-.08-5.27-.61-7.83ZM87.5,186.24c-.9,1.71-2.04,3.2-3.41,4.48-1.37,1.28-2.81,2.35-4.31,3.2-1.5.85-2.7,1.41-3.6,1.67-1.37.33-2.68.39-3.92.2-1.24-.2-2.37-.71-3.37-1.53-1.01-.82-1.85-1.99-2.54-3.5-.69-1.51-1.14-3.41-1.35-5.71-.26-2.63-.15-5.29.32-7.98.94-.52,1.82-1.51,2.64-2.96.69-.2,1.6-.39,2.73-.59,1.14-.2,2.26-.36,3.37-.49,1.11-.13,2.1-.23,2.96-.3.86-.06,1.37-.1,1.54-.1.81.13,1.76.36,2.83.69,1.07.33,2.1.81,3.09,1.43.99.62,1.85,1.43,2.6,2.41.75.99,1.21,2.2,1.38,3.64.26,1.91-.06,3.71-.96,5.42Z"/><path fill="#1A1A1A" d="M148.82,200.23c-.73-2.43-1.69-4.69-2.89-6.8-1.2-2.1-2.55-4.02-4.05-5.76-1.5-1.74-2.91-3.2-4.24-4.38h.06c1.2-1.44,2.31-3.05,3.34-4.83,1.2-2.03,2.16-4.27,2.89-6.7.73-2.43,1.12-4.84,1.19-7.24.06-2.4-.28-4.68-1.03-6.85-.75-2.17-2.02-4.04-3.82-5.62-1.67-1.44-3.53-2.51-5.56-3.2-2.04-.69-4.11-1.13-6.24-1.33-2.12-.2-4.23-.2-6.33,0-2.1.2-4.07.46-5.91.79-.64.13-1.55.33-2.73.59-1.18.26-2.44.64-3.79,1.13-1.35.49-2.68,1.12-3.99,1.87-1.31.76-2.43,1.67-3.37,2.76-.94,1.08-1.58,2.36-1.93,3.84-.34,1.48-.21,3.17.39,5.07.6,1.91,1.4,2.92,2.41,3.05,1.01.13,2-.26,2.99-1.18.47,6.37,1.13,12.66,1.99,18.87.86,6.21,1.74,12.43,2.64,18.67.17,1.18.35,2.51.55,3.99.19,1.48.47,2.89.84,4.24.36,1.35.85,2.51,1.45,3.5.6.99,1.39,1.54,2.38,1.67.73.13,1.42-.05,2.09-.54.66-.49,1.26-1.15,1.8-1.97.54-.82,1-1.74,1.38-2.76.39-1.02.64-1.99.77-2.91.34-2.17.32-4.48-.06-6.95-.39-2.46-.86-4.88-1.41-7.24,3,1.51,5.92,3.28,8.77,5.32,2.85,2.04,5.37,4.76,7.55,8.18.51.85,1.05,1.84,1.61,2.96.56,1.12,1.16,2.17,1.8,3.15.64.99,1.33,1.77,2.06,2.36.73.59,1.54.76,2.44.49.64-.2,1.23-.59,1.77-1.18.54-.59,1.01-1.3,1.41-2.12.41-.82.75-1.69,1.03-2.61.28-.92.46-1.84.55-2.76.21-2.63-.04-5.15-.77-7.59ZM133.45,170.82c-.6.76-1.26,1.45-1.99,2.07-.73.63-1.47,1.15-2.22,1.58-.75.43-1.4.74-1.96.94-.47-.06-1.15-.26-2.02-.59-.88-.33-1.82-.61-2.83-.84-1.01-.23-2-.33-2.99-.3-.99.03-1.82.34-2.51.94l-1.93-12.51c1.76-.06,3.47,0,5.14.2,1.67.2,3.23.43,4.69.69.81.13,1.7.28,2.67.44.96.16,1.91.41,2.83.74.92.33,1.78.84,2.57,1.53.79.69,1.42,1.63,1.9,2.81-.3.79-.75,1.56-1.35,2.31Z"/><path fill="#1A1A1A" d="M51.55,220.23c1.5.12,2.68.6,3.54,1.45.86.85,1.29,1.95,1.29,3.29,0,1.46-.51,2.98-1.54,4.56-.69,1.05-1.51,1.84-2.47,2.37s-1.98.91-3.05,1.14c-1.07.23-2.15.37-3.25.39-1.09.03-2.11.1-3.05.22-4.46.53-8.91,1.23-13.37,2.11.34,1.81.73,3.61,1.16,5.4.43,1.79.88,3.59,1.35,5.4,1.71-.64,3.44-1.2,5.17-1.67,1.74-.47,3.4-.7,4.98-.7,2.23,0,3.8.43,4.72,1.27.92.85,1.38,1.86,1.38,3.03,0,1.81-.45,3.34-1.35,4.56-.9,1.23-2,2.25-3.31,3.07-1.31.82-2.7,1.48-4.18,1.98-1.48.5-2.8.86-3.95,1.1.47,1.7.93,3.47,1.38,5.31.45,1.84.67,3.61.67,5.31,0,.82-.13,1.7-.39,2.63-.26.94-.62,1.8-1.09,2.59-.47.79-1.05,1.45-1.74,1.98-.69.53-1.46.79-2.31.79s-1.65-.53-2.38-1.58c-.73-1.05-1.4-2.38-2.02-3.99-.62-1.61-1.18-3.35-1.67-5.22-.49-1.87-.95-3.66-1.38-5.35-.6.18-1.23.37-1.9.57-.66.21-1.3.31-1.9.31-.99,0-1.74-.45-2.25-1.36-.51-.91-.77-1.94-.77-3.12,0-2.05.47-3.63,1.41-4.74.94-1.11,1.95-1.93,3.02-2.46-.39-2.16-.75-4.32-1.09-6.45-.34-2.14-.66-4.23-.96-6.28l-10.03,2.11c-.21.06-.49.09-.84.09-1.07,0-1.83-.44-2.28-1.32-.45-.88-.67-1.9-.67-3.07,0-2.28.49-4.1,1.48-5.44.99-1.35,2.21-2.38,3.66-3.12,1.46-.73,3.02-1.27,4.69-1.62,1.67-.35,3.19-.67,4.56-.97.56-.99,1.2-1.74,1.93-2.24.73-.5,1.39-.75,1.99-.75.81,0,1.58.44,2.31,1.32,3.09-.82,6.23-1.59,9.45-2.33,3.21-.73,6.38-1.1,9.51-1.1,1.89,0,3.73.18,5.53.53Z"/><path fill="#1A1A1A" d="M93.46,269.08c-.21-1.61-.46-3.12-.74-4.52-.28-1.4-.53-2.55-.74-3.42.47-.99.66-2.02.58-3.07-.09-1.05-.66-2.08-1.74-3.07l-.19-.26c-.47-2.05-.95-4.11-1.45-6.19-.49-2.08-1-4.14-1.51-6.19-.39-1.58-.76-3.23-1.12-4.96-.36-1.73-.74-3.45-1.12-5.18-.39-1.73-.81-3.42-1.29-5.09-.47-1.67-1.01-3.23-1.61-4.7.09-.35.15-.7.19-1.05.04-.35.09-.7.13-1.05.21-1.76.05-3.06-.48-3.91-.54-.85-1.23-1.33-2.09-1.45-.86-.12-1.75.13-2.67.75-.92.61-1.66,1.51-2.22,2.68l-.58,1.05c-.64.76-1.11,1.79-1.41,3.07-2.61,5.91-5.04,11.95-7.26,18.13-2.23,6.18-4.41,12.39-6.56,18.65-.47,1.35-1.01,2.78-1.61,4.3-.6,1.52-1.18,3.07-1.74,4.65-.56,1.58-1.05,3.18-1.48,4.78-.43,1.61-.71,3.18-.84,4.7-.13,1.87.05,3.26.55,4.17.49.91,1.13,1.42,1.93,1.54.79.12,1.65-.13,2.57-.75.92-.61,1.72-1.51,2.41-2.68.56-.94,1.06-1.94,1.51-3.03.45-1.08.87-2.21,1.25-3.38,3.21-.64,6.38-1.49,9.51-2.55,3.13-1.05,6.23-2.14,9.32-3.25.26,1.17.52,2.6.8,4.3.28,1.7.63,3.34,1.06,4.92.43,1.58.97,2.93,1.64,4.04.66,1.11,1.51,1.67,2.54,1.67,1.24,0,2.22-.41,2.92-1.23.71-.82,1.2-1.89,1.48-3.2.28-1.32.41-2.78.39-4.39-.02-1.61-.14-3.22-.35-4.83ZM73.5,257.45c-2.08,1-3.8,1.73-5.17,2.19.99-2.98,1.99-5.94,3.02-8.87,1.03-2.93,2.1-5.85,3.21-8.78.21-.64.46-1.29.74-1.93.28-.64.57-1.29.87-1.93l3.79,16.68c-2.23.76-4.38,1.64-6.46,2.63Z"/><path fill="#1A1A1A" d="M121.61,223.04c1.5-.94,2.71-1.21,3.63-.83.92.38,1.63,1.22,2.12,2.5.49,1.29.79,2.93.9,4.92.11,1.99.1,4.13-.03,6.41s-.34,4.62-.64,7.02c-.3,2.4-.63,4.64-1,6.72-.36,2.08-.72,3.89-1.06,5.44-.34,1.55-.62,2.62-.84,3.2-.51,1.64-1.1,3.38-1.77,5.22-.67,1.84-1.44,3.6-2.31,5.27-.88,1.67-1.86,3.16-2.96,4.48-1.09,1.32-2.33,2.27-3.7,2.85-1.67.7-3.11.75-4.31.13-1.2-.61-2.25-1.58-3.15-2.9-.9-1.32-1.66-2.88-2.28-4.7-.62-1.81-1.15-3.6-1.57-5.35-1.07-4.15-2.01-8.4-2.83-12.73-.81-4.33-1.29-8.69-1.41-13.08-.04-.99-.03-1.99.03-2.98.06-.99.22-1.93.45-2.81s.59-1.67,1.06-2.37c.47-.7,1.09-1.26,1.86-1.67,1.24-.64,2.34-.66,3.28-.04.94.61,1.58,1.77,1.93,3.47.13.76.09,1.58-.13,2.46.26,1.7.59,3.76,1,6.19.41,2.43.87,4.93,1.38,7.51.51,2.58,1.07,5.03,1.67,7.37.6,2.34,1.22,4.24,1.86,5.71.43-.94.86-1.86,1.29-2.77.43-.91.75-1.8.96-2.68.51-1.87.93-3.77,1.25-5.71.32-1.93.57-3.89.74-5.88.13-1.7.17-3.54.13-5.53-.04-1.99.03-3.94.22-5.84.19-1.9.59-3.66,1.19-5.27.6-1.61,1.61-2.85,3.02-3.73Z"/><path fill="#1A1A1A" d="M173.97,238.31c-.54-2.28-1.51-4.39-2.92-6.32-1.29-1.81-2.79-3.28-4.5-4.39-1.71-1.11-3.5-1.94-5.37-2.5-1.86-.56-3.77-.88-5.72-.97-1.95-.09-3.78-.04-5.5.13-1.41.23-2.84.51-4.27.83-1.44.32-2.82.82-4.15,1.49-1.33.67-2.57,1.54-3.73,2.59-1.16,1.05-2.14,2.4-2.96,4.04-.77,1.58-1.22,3.07-1.35,4.48-1.24,2.46-2.24,5.08-2.99,7.86-.75,2.78-1.18,5.57-1.29,8.38-.11,2.81.13,5.57.71,8.3.58,2.72,1.62,5.25,3.12,7.59,1.67,2.63,3.6,4.51,5.79,5.62,2.19,1.11,4.47,1.64,6.85,1.58,2.38-.06,4.79-.61,7.23-1.67,2.44-1.05,4.78-2.43,7.01-4.13,2.23-1.7,4.27-3.63,6.14-5.79,1.86-2.16,3.4-4.39,4.6-6.67,1.07-1.99,1.96-4.14,2.67-6.45.71-2.31,1.13-4.65,1.25-7.02.13-2.37-.08-4.7-.61-6.98ZM161.66,252.71c-.9,1.52-2.04,2.85-3.41,3.99-1.37,1.14-2.81,2.09-4.31,2.85-1.5.76-2.7,1.26-3.6,1.49-1.37.29-2.68.35-3.92.18-1.24-.18-2.37-.63-3.37-1.36-1.01-.73-1.85-1.77-2.54-3.12-.69-1.35-1.14-3.04-1.35-5.09-.26-2.34-.15-4.71.32-7.11.94-.47,1.82-1.35,2.64-2.63.68-.18,1.6-.35,2.73-.53,1.13-.18,2.26-.32,3.37-.44,1.11-.12,2.1-.2,2.96-.26.86-.06,1.37-.09,1.54-.09.81.12,1.76.32,2.83.61,1.07.29,2.1.72,3.09,1.27.99.56,1.85,1.27,2.6,2.15.75.88,1.21,1.96,1.38,3.25.26,1.7-.06,3.31-.96,4.83Z"/><path fill="#1A1A1A" d="M222.97,264.91c-.73-2.16-1.69-4.18-2.89-6.06-1.2-1.87-2.55-3.58-4.05-5.14-1.5-1.55-2.91-2.85-4.24-3.91h.06c1.2-1.29,2.31-2.72,3.34-4.3,1.2-1.81,2.16-3.8,2.89-5.97.73-2.16,1.12-4.32,1.19-6.45.06-2.14-.28-4.17-1.03-6.1-.75-1.93-2.02-3.6-3.82-5-1.67-1.29-3.53-2.24-5.56-2.85-2.04-.61-4.11-1.01-6.24-1.19-2.12-.18-4.23-.18-6.33,0-2.1.18-4.07.41-5.91.7-.64.12-1.55.29-2.73.53-1.18.23-2.44.57-3.79,1.01-1.35.44-2.68,1-3.99,1.67-1.31.67-2.43,1.49-3.37,2.46-.94.97-1.58,2.11-1.93,3.42-.34,1.32-.21,2.82.39,4.52.6,1.7,1.4,2.6,2.41,2.72,1.01.12,2-.23,2.99-1.05.47,5.68,1.13,11.28,1.99,16.81.86,5.53,1.74,11.08,2.64,16.64.17,1.05.35,2.24.55,3.56.19,1.32.47,2.58.84,3.77.36,1.2.85,2.24,1.45,3.12.6.88,1.39,1.38,2.38,1.49.73.12,1.42-.04,2.09-.48.66-.44,1.26-1.02,1.8-1.76.54-.73,1-1.55,1.38-2.46.39-.91.64-1.77.77-2.59.34-1.93.32-3.99-.06-6.19-.39-2.19-.86-4.35-1.41-6.45,3,1.35,5.92,2.93,8.77,4.74,2.85,1.81,5.37,4.24,7.55,7.29.51.76,1.05,1.64,1.61,2.63.56,1,1.16,1.93,1.8,2.81.64.88,1.33,1.58,2.06,2.11.73.53,1.54.67,2.44.44.64-.18,1.23-.53,1.77-1.05.54-.53,1.01-1.15,1.41-1.89.41-.73.75-1.51,1.03-2.33.28-.82.46-1.64.55-2.46.21-2.34-.04-4.59-.77-6.76ZM207.61,238.7c-.6.67-1.26,1.29-1.99,1.84-.73.56-1.47,1.02-2.22,1.4-.75.38-1.4.66-1.96.83-.47-.06-1.15-.23-2.02-.53-.88-.29-1.82-.54-2.83-.75-1.01-.2-2-.29-2.99-.26-.99.03-1.82.31-2.51.83l-1.93-11.15c1.76-.06,3.47,0,5.14.18,1.67.18,3.23.38,4.69.61.81.12,1.7.25,2.67.39.96.15,1.91.37,2.83.66.92.29,1.78.75,2.57,1.36.79.61,1.42,1.45,1.9,2.5-.3.7-.75,1.39-1.35,2.06Z"/><g><path fill="#1A1A1A" d="M188.7,151.26c.56.47.9.96,1.02,1.48.12.52.09,1.05-.08,1.57-.18.52-.47,1.03-.87,1.51s-.86.94-1.36,1.35c-.5.41-1,.77-1.5,1.07-.5.3-.94.52-1.32.67-.4.15-.83.29-1.29.41-.46.12-.93.21-1.41.25-.48.04-.95.04-1.41-.02s-.89-.2-1.29-.41c-.35-.18-.64-.43-.87-.75-.23-.32-.39-.67-.46-1.05-.08-.38-.07-.76.02-1.15.09-.39.28-.73.57-1.04.27-.28.5-.46.71-.54.21-.08.4-.09.58-.03.18.06.35.16.52.31.16.15.33.3.5.46.17.16.35.31.54.44.19.13.4.22.63.26.32.05.62.06.9.03.28-.03.56-.09.84-.16.27-.08.54-.17.8-.28.26-.11.53-.22.81-.34.07-.04.17-.1.28-.17.12-.08.24-.16.36-.26.13-.1.25-.19.35-.28.11-.09.18-.17.22-.23-.28-.24-.59-.43-.94-.57-.35-.14-.71-.23-1.09-.3-.38-.06-.78-.1-1.18-.12-.41-.01-.8-.03-1.19-.04-.34-.01-.75,0-1.24.04-.49.04-.97.05-1.47.02-.49-.03-.96-.11-1.39-.24-.44-.14-.78-.38-1.02-.73-.32-.44-.46-.86-.42-1.27.04-.41.19-.79.46-1.14.27-.35.64-.69,1.1-.99.46-.31.97-.59,1.52-.86.55-.26,1.12-.5,1.71-.71.59-.21,1.15-.4,1.68-.56.53-.16,1.01-.29,1.43-.4.42-.1.73-.17.94-.21.3-.06.5-.03.59.11s.12.3.09.5c-.03.2-.1.4-.21.61-.11.21-.22.35-.33.44-.32.26-.7.46-1.14.61-.44.15-.85.31-1.23.49-.36.17-.73.34-1.09.51-.36.17-.72.35-1.07.53.44.01.87.01,1.31,0,.44-.01.87-.01,1.31,0,.4,0,.83.01,1.28.04.46.03.91.08,1.36.16.45.08.88.19,1.3.35.42.16.8.37,1.14.64Z"/><path fill="#1A1A1A" d="M201.89,155.53c.23.41.29.82.19,1.23s-.3.76-.59,1.07c-.29.31-.64.54-1.05.69-.41.15-.8.18-1.19.08-.53-.14-1.04-.33-1.53-.56s-1-.4-1.55-.5c-.17-.03-.39-.05-.66-.09-.27-.03-.56-.04-.85-.03-.29.01-.56.06-.81.13-.25.08-.43.21-.54.41-.22.17-.46.31-.73.43-.27.12-.53.18-.79.18s-.5-.07-.72-.21c-.22-.14-.38-.39-.47-.73-.1-.32-.09-.65.03-.97.12-.33.27-.65.47-.95.2-.31.42-.6.66-.87.24-.27.46-.51.64-.73l.82-1c-.24-.23-.49-.46-.74-.69-.25-.23-.5-.46-.76-.68-.21-.18-.47-.39-.79-.63-.32-.24-.64-.49-.96-.76-.32-.27-.59-.55-.83-.84s-.37-.58-.39-.88c-.04-.36.02-.67.16-.92.15-.25.34-.45.58-.61.24-.15.51-.26.81-.33.3-.06.58-.09.85-.08.22.03.39.1.5.23.12.13.19.28.23.46.64.45,1.27.92,1.88,1.41.61.49,1.22.98,1.84,1.47.46-.5.93-.98,1.41-1.45.48-.46.98-.88,1.5-1.25.18-.13.41-.27.67-.42.27-.15.53-.26.8-.32.27-.06.52-.04.75.04.23.08.41.29.53.63.1.27.1.56,0,.86-.09.3-.23.6-.4.89-.18.29-.37.56-.58.82-.21.26-.4.48-.56.66-.24.3-.49.58-.73.86-.24.28-.49.56-.73.84l1.09.93c.17.14.38.3.62.46.24.17.49.35.73.54.24.19.47.39.68.59.21.2.37.4.48.61Z"/><path fill="#1A1A1A" d="M215.77,153.62c.15.39.33.8.55,1.24.22.44.41.9.56,1.36.16.46.26.92.3,1.38.04.46-.03.88-.21,1.28-.19.4-.42.69-.68.88-.26.19-.53.28-.81.28s-.56-.09-.83-.27c-.27-.18-.52-.44-.74-.77-.38-.59-.71-1.21-1.01-1.85-.3-.64-.57-1.3-.83-1.96-.26-.66-.5-1.33-.75-2.02-.24-.68-.5-1.36-.77-2.03l-.05.62c-.05.4-.1.82-.15,1.26-.05.44-.15.88-.27,1.3-.13.42-.3.81-.53,1.16-.22.35-.53.62-.9.83-.32.17-.61.24-.89.21-.28-.03-.54-.12-.79-.27-.25-.15-.48-.36-.69-.62-.21-.26-.41-.54-.59-.85.07.55.12,1.02.15,1.39,0,.15,0,.35.03.59.02.24,0,.48-.04.71-.04.24-.13.45-.27.63-.14.18-.37.29-.7.33-.24.03-.44,0-.59-.11-.15-.1-.28-.23-.37-.4-.1-.17-.17-.36-.23-.57-.05-.21-.1-.41-.14-.61-.15-.63-.26-1.27-.34-1.92-.08-.65-.15-1.3-.21-1.94-.06-.64-.12-1.29-.18-1.94-.06-.65-.14-1.3-.24-1.94-.04-.27-.06-.53-.08-.78-.02-.25,0-.49.04-.7.04-.22.13-.42.26-.61.13-.19.33-.36.6-.51.28-.15.52-.22.74-.2.21.02.41.09.58.22.18.13.34.3.48.51.15.21.29.43.42.65.3.5.6,1,.89,1.5.29.5.59,1,.91,1.49.06-.64.15-1.28.26-1.91.12-.63.28-1.21.49-1.73s.49-.97.83-1.34c.34-.37.77-.62,1.29-.73.41-.09.77-.04,1.08.14.31.18.58.43.82.75.24.32.45.68.63,1.07.18.39.35.74.49,1.05.45.94.87,1.89,1.27,2.85.39.96.8,1.92,1.21,2.88Z"/></g></svg>`}
    ],
    sxm:[
        {id:'sxm-1',n:'Island',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><path d="M60 15 L95 45 L85 95 L35 95 L25 45 Z" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><text x="60" y="58" text-anchor="middle" font-size="22" font-weight="900" fill="#1A1A1A" font-family="sans-serif">SXM</text><text x="60" y="76" text-anchor="middle" font-size="9" font-weight="500" fill="#1A1A1A" letter-spacing="3" font-family="sans-serif">ISLAND</text><text x="60" y="90" text-anchor="middle" font-size="8" fill="#1A1A1A" font-family="sans-serif">— 12 —</text></svg>`},
        {id:'sxm-2',n:'Wave',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><text x="60" y="50" text-anchor="middle" font-size="30" font-weight="900" fill="#1A1A1A" font-family="sans-serif">SXM</text><path d="M20 65 Q35 55 50 65 Q65 75 80 65 Q95 55 100 65" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><path d="M20 78 Q35 68 50 78 Q65 88 80 78 Q95 68 100 78" stroke="#1A1A1A" stroke-width="1.5" fill="none" opacity="0.5"/><text x="60" y="100" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="4" font-family="sans-serif">SAINT-MARTIN</text></svg>`},
        {id:'sxm-3',n:'Geo',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><circle cx="60" cy="55" r="35" stroke="#1A1A1A" stroke-width="2" fill="none"/><circle cx="60" cy="55" r="25" stroke="#1A1A1A" stroke-width="1.5" fill="none" opacity="0.4"/><text x="60" y="62" text-anchor="middle" font-size="18" font-weight="800" fill="#1A1A1A" font-family="sans-serif">SXM</text><text x="60" y="105" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="3" font-family="sans-serif">12 — CARAIBES</text></svg>`}
    ],
    cor:[
        {id:'cor-1',n:'Shield',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><path d="M60 18 L95 35 L95 70 Q95 95 60 108 Q25 95 25 70 L25 35 Z" stroke="#1A1A1A" stroke-width="2.5" fill="none"/><text x="60" y="62" text-anchor="middle" font-size="20" font-weight="900" fill="#1A1A1A" font-family="sans-serif">COR</text><text x="60" y="80" text-anchor="middle" font-size="9" font-weight="500" fill="#1A1A1A" letter-spacing="2" font-family="sans-serif">— 01 —</text></svg>`},
        {id:'cor-2',n:'Typo',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><text x="60" y="45" text-anchor="middle" font-size="40" font-weight="900" fill="#1A1A1A" font-family="sans-serif">C</text><line x1="25" y1="55" x2="95" y2="55" stroke="#1A1A1A" stroke-width="2"/><text x="60" y="72" text-anchor="middle" font-size="11" font-weight="600" fill="#1A1A1A" letter-spacing="8" font-family="sans-serif">CORSICA</text><text x="60" y="92" text-anchor="middle" font-size="9" font-weight="500" fill="#1A1A1A" font-family="sans-serif">Edition 01</text></svg>`},
        {id:'cor-3',n:'Crest',s:`<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><ellipse cx="60" cy="58" rx="42" ry="45" stroke="#1A1A1A" stroke-width="2" fill="none"/><ellipse cx="60" cy="58" rx="35" ry="38" stroke="#1A1A1A" stroke-width="1" fill="none" opacity="0.3"/><text x="60" y="55" text-anchor="middle" font-family="Georgia,serif" font-size="22" font-weight="700" font-style="italic" fill="#1A1A1A">Cor</text><text x="60" y="72" text-anchor="middle" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="5" font-family="sans-serif">PREMIERE</text><circle cx="60" cy="85" r="3" fill="#1A1A1A"/></svg>`}
    ],
    pay:[
        {id:'pay-01',n:'Paysage 01',url:'pay01.svg',back:{x:47.9,y:41,w:67.2,h:44.8}}
    ]
};

/* ── State ── */
let color = COLORS[0];
let side  = 'front';
let svgF  = null;
let svgB  = null;

/* Per-side logo state (J: Logo Avant, K: Logo Arriere) — logoColor per side */
const logos = {
    front: { data: null, x: 66.5, y: 28, w: 18.9, h: 12.6, logoColor: '#1A1A1A' },
    back:  { data: null, x: 47.9, y: 31, w: 67.2, h: 44.8, logoColor: '#1A1A1A' }
};
function cl() { return logos[side]; }

let logoSelected = false;
let dragState = null;
let payStatus = 'non';

/* Custom selects registry */
const selects = {};

/* ══════════════════════════════════════
   CUSTOM SELECT COMPONENT
   ══════════════════════════════════════ */
const CHEVRON_SVG = `<svg class="aselect-chevron" width="12" height="8" viewBox="0 0 12 8" fill="none"><path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;

function createSelect(containerId, options, placeholder, onChange) {
    const container = document.getElementById(containerId);
    const state = { value: '', label: '', onChange: onChange || (() => {}) };

    function render() {
        const isPlaceholder = !state.value;
        container.innerHTML = `
            <div class="aselect-trigger ${isPlaceholder ? 'placeholder' : ''}">${isPlaceholder ? placeholder : state.label}</div>
            ${CHEVRON_SVG}
        `;
        container.querySelector('.aselect-trigger').addEventListener('click', toggle);
    }

    function toggle(e) {
        e.stopPropagation();
        const wasOpen = container.classList.contains('open');
        closeAllSelects();
        if (wasOpen) return;
        container.classList.add('open');

        const dd = document.createElement('div');
        dd.className = 'aselect-dropdown';
        options.forEach(o => {
            if (o.v === '' && o.l === placeholder) return;
            const opt = document.createElement('div');
            opt.className = 'aselect-opt' + (o.v === state.value ? ' on' : '');
            opt.textContent = o.l;
            opt.addEventListener('click', (ev) => {
                ev.stopPropagation();
                state.value = o.v;
                state.label = o.l;
                container.classList.remove('open');
                render();
                state.onChange(o.v);
            });
            dd.appendChild(opt);
        });
        container.appendChild(dd);
    }

    render();
    selects[containerId] = state;
    return state;
}

function closeAllSelects() {
    document.querySelectorAll('.aselect').forEach(s => {
        s.classList.remove('open');
        const dd = s.querySelector('.aselect-dropdown');
        if (dd) dd.remove();
    });
}

function updateSelectOptions(containerId, newOptions, placeholder) {
    const container = document.getElementById(containerId);
    const state = selects[containerId];
    if (!state) return;
    state.value = '';
    state.label = '';

    function renderTrigger() {
        const isPlaceholder = !state.value;
        container.innerHTML = `
            <div class="aselect-trigger ${isPlaceholder ? 'placeholder' : ''}">${isPlaceholder ? placeholder : state.label}</div>
            ${CHEVRON_SVG}
        `;
        container.querySelector('.aselect-trigger').addEventListener('click', toggleDD);
    }

    function toggleDD(e) {
        e.stopPropagation();
        const wasOpen = container.classList.contains('open');
        closeAllSelects();
        if (wasOpen) return;
        container.classList.add('open');

        const dd = document.createElement('div');
        dd.className = 'aselect-dropdown';
        newOptions.forEach(o => {
            const opt = document.createElement('div');
            opt.className = 'aselect-opt' + (o.v === state.value ? ' on' : '');
            opt.textContent = o.l;
            opt.addEventListener('click', (ev) => {
                ev.stopPropagation();
                state.value = o.v;
                state.label = o.l;
                container.classList.remove('open');
                renderTrigger();
                state.onChange(o.v);
            });
            dd.appendChild(opt);
        });
        container.appendChild(dd);
    }

    renderTrigger();
}

/* ══════════════════════════════════════
   RICH SELECT (with HTML options)
   ══════════════════════════════════════ */
function colorDotHtml(hex, name) {
    return '<div style="display:flex;align-items:center;gap:10px;pointer-events:none;"><div style="width:22px;height:22px;border-radius:50%;background:' + hex + ';box-shadow:inset 0 0 0 0.5px rgba(0,0,0,0.12);flex-shrink:0;"></div><span>' + name + '</span></div>';
}

function initColorSelect() {
    const opts = COLORS.map(c => ({
        v: c.h,
        l: c.n,
        html: '<div style="display:flex;align-items:center;gap:10px;pointer-events:none;"><div style="width:18px;height:18px;border-radius:50%;flex-shrink:0;background:' + c.h + ';box-shadow:inset 0 0 0 0.5px rgba(0,0,0,0.15);"></div><span>' + c.n + '</span></div>',
        trigger: '<div style="display:flex;align-items:center;gap:8px;pointer-events:none;"><div style="width:16px;height:16px;border-radius:50%;flex-shrink:0;background:' + c.h + ';box-shadow:inset 0 0 0 0.5px rgba(0,0,0,0.15);"></div><span>' + c.n + '</span></div>'
    }));
    const sel = createRichSelect('colorSelect', opts, 'Couleur T-shirt', v => {
        color = COLORS.find(c => c.h === v) || COLORS[0];
        renderSVG();
    });
    if (sel) {
        sel.value = COLORS[0].h;
        sel.label = COLORS[0].n;
        sel._html = opts[0].trigger;
        const trigger = document.querySelector('#colorSelect .aselect-trigger');
        if (trigger) {
            trigger.innerHTML = opts[0].trigger;
            trigger.classList.remove('placeholder');
        }
    }
}

function createRichSelect(containerId, options, placeholder, onChange) {
    const container = document.getElementById(containerId);
    if (!container) return null;
    const state = { value: '', label: '', _html: '', onChange: onChange || (() => {}), _options: options };

    function renderTrigger() {
        const isP = !state.value;
        container.innerHTML = '<div class="aselect-trigger ' + (isP ? 'placeholder' : '') + '">' + (isP ? placeholder : (state._html || state.label)) + '</div>' + CHEVRON_SVG;
        container.querySelector('.aselect-trigger').addEventListener('click', toggle);
    }

    function toggle(e) {
        e.stopPropagation();
        const wasOpen = container.classList.contains('open');
        closeAllSelects();
        if (wasOpen) return;
        container.classList.add('open');
        const dd = document.createElement('div');
        dd.className = 'aselect-dropdown';
        state._options.forEach(o => {
            const opt = document.createElement('div');
            opt.className = 'aselect-opt' + (o.v === state.value ? ' on' : '');
            if (o.html) { opt.innerHTML = o.html; } else { opt.textContent = o.l; }
            opt.addEventListener('click', ev => {
                ev.stopPropagation();
                state.value = o.v; state.label = o.l; state._html = o.trigger || o.html || '';
                container.classList.remove('open');
                renderTrigger();
                state.onChange(o.v);
            });
            dd.appendChild(opt);
        });
        container.appendChild(dd);
    }

    state.reset = function() { state.value = ''; state.label = ''; state._html = ''; renderTrigger(); };
    state.setValue = function(v) {
        const o = state._options.find(x => x.v === v);
        if (o) { state.value = o.v; state.label = o.l; state._html = o.trigger || o.html || ''; renderTrigger(); }
    };

    renderTrigger();
    selects[containerId] = state;
    return state;
}

/* ══════════════════════════════════════
   INIT
   ══════════════════════════════════════ */
document.addEventListener('DOMContentLoaded', async () => {
    const d = new Date();
    const orderDateVal = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
    document.getElementById('orderDate').textContent = orderDateVal;
    updateSerial();

    // Build custom selects
    createSelect('selCollection',
        [{v:'Homme',l:'Homme'},{v:'Femme',l:'Femme'},{v:'Enfant',l:'Enfant'},{v:'Accessoire',l:'Accessoire'}],
        'Collection',
        (val) => buildRefs()
    );
    createSelect('selRef', [], 'Reference', () => {});
    createSelect('selSize',
        [{v:'XS',l:'XS'},{v:'S',l:'S'},{v:'M',l:'M'},{v:'L',l:'L'},{v:'XL',l:'XL'},{v:'XXL',l:'XXL'}],
        'Taille',
        () => updateLogoMmDisplay()
    );
    selects['selSize'].value = 'S';
    selects['selSize'].label = 'S';
    document.querySelector('#selSize .aselect-trigger').textContent = 'S';
    document.querySelector('#selSize .aselect-trigger').classList.remove('placeholder');

    // Couleur T-shirt — menu déroulant
    initColorSelect();

    // Prix T-shirt et Personnalisation — menus déroulants (step 3)
    const mkPriceOpts = vals => vals.map(v => ({ v: String(v), l: v + ' €' }));
    const selP = createRichSelect('selPrice', mkPriceOpts([15,20,25,30,35,39,40,45,50]), '— €', () => calcTotal());
    if (selP) { selP.setValue('25'); }
    const selQ = createRichSelect('selPerso', mkPriceOpts([0,5,10,15,20,25,30]), '— €', () => calcTotal());
    if (selQ) { selQ.setValue('0'); }
    calcTotal();

    // Logo interaction — géré directement depuis le t-shirt (bottom sheet)

    initLogoInteraction();

    // Live ID update quand le nom ou le prénom changent
    document.getElementById('clientNom').addEventListener('input', updateSerial);
    document.getElementById('clientPrenom').addEventListener('input', updateSerial);
    updateSerial(); // génère l'ID dès l'ouverture

    // Close selects on outside click
    document.addEventListener('click', () => closeAllSelects());

    try {
        const [f, b] = await Promise.all([
            fetch('tshirt-front.svg').then(r => r.text()),
            fetch('tshirt-back.svg').then(r => r.text())
        ]);
        svgF = f; svgB = b;
    } catch(e) { console.error(e); }

    renderSVG();
});

/* ══════════════════════════════════════
   NAVIGATION
   ══════════════════════════════════════ */
const TITLES = ['Client','Studio','Paiement'];

window.go = function(n) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('s'+n).classList.add('active');
    document.getElementById('hTitle').textContent = TITLES[n-1];
    document.getElementById('hLabel').textContent = `Etape ${n} sur 3`;
    document.getElementById('hNum').textContent = n;
    document.getElementById('hBar').style.width = (n/3*100)+'%';
    if (n === 2) updateSerial();
    window.scrollTo({top:0,behavior:'smooth'});
};

/* ══════════════════════════════════════
   ID — jjmmaa-hhmm-Nom-Prenom
   ══════════════════════════════════════ */
const _orderCreatedAt = new Date(); // heure figée à l'ouverture du formulaire

function updateSerial() {
    const d  = _orderCreatedAt;
    const dd = String(d.getDate()).padStart(2,'0');
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const yy = String(d.getFullYear()).slice(-2);
    const hh = String(d.getHours()).padStart(2,'0');
    const mi = String(d.getMinutes()).padStart(2,'0');
    const cap = s => s ? s.toLowerCase().replace(/(^|\s)\S/g, c => c.toUpperCase()) : '';
    const nom    = cap((document.getElementById('clientNom').value    || '').trim()).replace(/\s+/g,'-');
    const prenom = cap((document.getElementById('clientPrenom').value || '').trim()).replace(/\s+/g,'-');
    const namePart = nom && prenom ? `${nom}-${prenom}` : nom || prenom || '…';
    document.getElementById('orderNo').textContent = `${namePart}-${dd}${mm}${yy}-${hh}${mi}`;
}

/* ══════════════════════════════════════
   REFS (H-001, F-001, E-001, A-001...)
   ══════════════════════════════════════ */
window.buildRefs = function() {
    const c = selects['selCollection'] ? selects['selCollection'].value : '';
    const opts = [];
    if (c) {
        const prefix = c[0].toUpperCase();
        for (let i = 1; i <= 5; i++) {
            const code = prefix + '-' + String(i).padStart(3,'0');
            const refData = REFERENCES[code];
            const bioTag = refData && refData.bio ? '  🌿 BIO' : '';
            const label = refData ? `${code}  ·  ${refData.fournisseur}${bioTag}` : code;
            opts.push({v: code, l: label});
        }
    }
    updateSelectOptions('selRef', opts, 'Reference');
    /* Auto-prix + affichage mm au choix de la référence */
    selects['selRef'].onChange = function(v) {
        const refData = REFERENCES[v];
        if (refData) {
            if (selects['selPrice']) selects['selPrice'].setValue(String(refData.prix));
            calcTotal();
        }
        updateLogoMmDisplay();
        const bioBadge = document.getElementById('bioBadge');
        if (bioBadge) { bioBadge.classList.toggle('visible', !!(refData && refData.bio)); }
    };
};

/* ══════════════════════════════════════
   LARGEUR LOGO EN MM
   ══════════════════════════════════════ */
function updateLogoMmDisplay() {
    const input = document.getElementById('coteLogoAr');
    if (!input) return;
    const refVal  = selects['selRef']  ? selects['selRef'].value  : '';
    const sizeVal = selects['selSize'] ? selects['selSize'].value : '';
    const refData = REFERENCES[refVal];
    const logoArW = refData && refData.largeurs ? refData.largeurs[sizeVal] : null;
    if (logoArW) input.value = logoArW;   // pré-remplit ; ne vide pas si saisie manuelle
}

/* ══════════════════════════════════════
   SVG RENDERING
   ══════════════════════════════════════ */
function renderSide(s) {
    const raw = s === 'front' ? svgF : svgB;
    const box = document.getElementById(s === 'front' ? 'svgBoxFront' : 'svgBoxBack');
    if (!box) return;
    if (!raw) { box.innerHTML = ''; return; }
    box.innerHTML = raw.replace(FABRIC_RE, color.h);
    const el = box.querySelector('svg');
    if (el) {
        el.removeAttribute('width');
        el.removeAttribute('height');
        el.setAttribute('preserveAspectRatio', 'xMidYMid meet');
    }
    renderLogoForSide(s);
}

function renderSVG() {
    renderSide('front');
    renderSide('back');
}

function renderLogoForSide(s) {
    const cur = logos[s];
    const zoneId = s === 'front' ? 'logoZoneFront' : 'logoZoneBack';
    const innerId = s === 'front' ? 'logoInnerFront' : 'logoInnerBack';
    const zone  = document.getElementById(zoneId);
    const inner = document.getElementById(innerId);
    if (!zone || !inner) return;

    // Position toujours à jour
    zone.style.left   = cur.x + '%';
    zone.style.top    = cur.y + '%';
    zone.style.width  = cur.w + '%';
    zone.style.height = cur.h + '%';

    if (!cur.data) {
        inner.innerHTML = '';
        zone.classList.add('empty');
        zone.classList.remove('has-logo', 'selected');
        return;
    }
    zone.classList.remove('empty');
    zone.classList.add('has-logo');
    if (cur.data.type === 'atelier') {
        inner.innerHTML = cur.data.s.replace(/#1A1A1A/gi, cur.logoColor || '#1A1A1A');
    } else {
        inner.innerHTML = `<img src="${cur.data.url}" alt="">`;
    }
}

/* renderLogo — appelé pour rafraîchir les deux côtés */
function renderLogo() {
    renderLogoForSide('front');
    renderLogoForSide('back');
    updateFloatBar();
    updateTapOverlays();
    updateLogoMmDisplay();
}

function updateLogoPositionForSide(s) {
    const cur  = logos[s];
    const zone = document.getElementById(s === 'front' ? 'logoZoneFront' : 'logoZoneBack');
    if (!zone) return;
    zone.style.left   = cur.x + '%';
    zone.style.top    = cur.y + '%';
    zone.style.width  = cur.w + '%';
    zone.style.height = cur.h + '%';
}

function updateLogoPosition() {
    updateLogoPositionForSide('front');
    updateLogoPositionForSide('back');
    updateLogoMmDisplay();
}

/* ══════════════════════════════════════
   SYNC LOGO UI (on side flip)
   ══════════════════════════════════════ */
function syncLogoUI() {
    const cur = cl();
    // Upload pill dans le sheet
    if (cur.data && cur.data.type === 'custom') {
        document.getElementById('upThumb').src = cur.data.url;
        document.getElementById('upName').textContent = cur.data.name || 'Custom';
        document.getElementById('upPill').classList.add('show');
    } else {
        document.getElementById('upPill').classList.remove('show');
        const fi = document.getElementById('fileIn');
        if (fi) fi.value = '';
    }
    updateFloatBar();
    updateTapOverlays();
}

/* ══════════════════════════════════════
   LOGO INTERACTION — 2 zones indépendantes
   ══════════════════════════════════════ */
/* Pinch state (2 doigts sur le logo) */
let pinchState = null;

function initLogoInteraction() {
    ['front', 'back'].forEach(s => {
        const zoneId = s === 'front' ? 'logoZoneFront' : 'logoZoneBack';
        const viewId = s === 'front' ? 'svgViewFront'  : 'svgViewBack';
        const zone   = document.getElementById(zoneId);
        const view   = document.getElementById(viewId);
        if (!zone || !view) return;

        zone.addEventListener('pointerdown', e => onLogoDown(e, s));

        /* Curseur dynamique : coins = resize, centre = move */
        zone.addEventListener('pointermove', e => {
            if (dragState) return; // pas de mise à jour pendant le drag
            if (!logos[s].data) return;
            const zr = zone.getBoundingClientRect();
            const rx = (e.clientX - zr.left)  / zr.width;
            const ry = (e.clientY - zr.top)   / zr.height;
            const EDGE = 0.35;
            const corner = (rx < EDGE || rx > 1 - EDGE) && (ry < EDGE || ry > 1 - EDGE);
            if (corner) {
                const cx = rx > 0.5 ? 'e' : 'w';
                const cy = ry > 0.5 ? 's' : 'n';
                const cursors = { nw:'nwse-resize', ne:'nesw-resize', sw:'nesw-resize', se:'nwse-resize' };
                zone.style.cursor = cursors[cy + cx];
            } else {
                zone.style.cursor = 'move';
            }
        });

        /* ── Pinch-to-zoom sur toute la zone SVG (2 doigts = resize diagonal) ── */
        view.addEventListener('touchstart', e => {
            if (e.touches.length === 2 && logos[s].data) {
                e.preventDefault();
                if (side !== s) flipSide(s);
                const d = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                pinchState = { side: s, startDist: d, origW: logos[s].w, origH: logos[s].h };
            }
        }, { passive: false });

        view.addEventListener('touchmove', e => {
            if (!pinchState || pinchState.side !== s || e.touches.length < 2) return;
            e.preventDefault();
            const d = Math.hypot(
                e.touches[0].clientX - e.touches[1].clientX,
                e.touches[0].clientY - e.touches[1].clientY
            );
            const scale = d / pinchState.startDist;
            const ratio = pinchState.origH / pinchState.origW;
            let newW = pinchState.origW * scale;
            let newH = newW * ratio;
            /* Contraindre en gardant le ratio */
            if (newW < 8)  { newW = 8;  newH = newW * ratio; }
            if (newW > 50) { newW = 50; newH = newW * ratio; }
            if (newH < 6)  { newH = 6;  newW = newH / ratio; }
            if (newH > 40) { newH = 40; newW = newH / ratio; }
            logos[s].w = newW;
            logos[s].h = newH;
            updateLogoPositionForSide(s);
        }, { passive: false });

        view.addEventListener('touchend', () => { pinchState = null; });
    });

    document.addEventListener('pointermove', onLogoMove);
    document.addEventListener('pointerup',   onLogoUp);

    // Désélection globale
    document.addEventListener('pointerdown', e => {
        if (!e.target.closest('.logo-zone') && !e.target.closest('.logo-tap-overlay')) {
            logoSelected = false;
            document.querySelectorAll('.logo-zone').forEach(z => z.classList.remove('selected'));
        }
    });

    // Tap overlay → ouvre le bottom sheet de sélection logo
    const tapF = document.getElementById('logoTapFront');
    const tapB = document.getElementById('logoTapBack');
    if (tapF) tapF.addEventListener('click', () => { flipSide('front'); openLogoSheet('front'); });
    if (tapB) tapB.addEventListener('click', () => { flipSide('back');  openLogoSheet('back');  });


}

function onLogoDown(e, activeSide) {
    const cur = logos[activeSide];
    if (!cur.data) return;
    e.preventDefault();
    e.stopPropagation();

    /* Activer ce côté pour les sélecteurs */
    if (side !== activeSide) {
        side = activeSide;
        // Désélectionner tous les logos (évite cadre bleu fantôme sur l'autre côté)
        document.querySelectorAll('.logo-zone').forEach(z => z.classList.remove('selected'));
        logoSelected = false;
        document.getElementById('colFront').classList.toggle('active', side === 'front');
        document.getElementById('colBack').classList.toggle('active',  side === 'back');
        syncLogoUI();
    }

    const zoneId = activeSide === 'front' ? 'logoZoneFront' : 'logoZoneBack';
    const viewId = activeSide === 'front' ? 'svgViewFront'  : 'svgViewBack';
    const zone   = document.getElementById(zoneId);
    const rect   = document.getElementById(viewId).getBoundingClientRect();

    logoSelected = true;
    zone.classList.add('selected');

    /* Détection positionnelle : coins = resize diagonal, centre = déplacement */
    const zoneRect = zone.getBoundingClientRect();
    const relX = (e.clientX - zoneRect.left) / zoneRect.width;
    const relY = (e.clientY - zoneRect.top)  / zoneRect.height;
    const EDGE = 0.35;
    const inCorner = (relX < EDGE || relX > 1 - EDGE) && (relY < EDGE || relY > 1 - EDGE);

    if (inCorner) {
        const cornerX = relX > 0.5 ? 'e' : 'w';
        const cornerY = relY > 0.5 ? 's' : 'n';
        dragState = {
            type: 'resize', side: activeSide,
            corner: cornerY + cornerX,
            startX: e.clientX, startY: e.clientY,
            origW: cur.w, origH: cur.h, origX: cur.x, origY: cur.y,
            stageW: rect.width, stageH: rect.height
        };
    } else {
        dragState = {
            type: 'drag', side: activeSide,
            startX: e.clientX, startY: e.clientY,
            origX: cur.x, origY: cur.y,
            stageW: rect.width, stageH: rect.height
        };
    }
    zone.setPointerCapture(e.pointerId);
}

function onLogoMove(e) {
    if (!dragState) return;
    e.preventDefault();
    const cur = logos[dragState.side];
    const s   = dragState.side;

    if (dragState.type === 'drag') {
        const dx = e.clientX - dragState.startX;
        const dy = e.clientY - dragState.startY;
        cur.x = dragState.origX + (dx / dragState.stageW) * 100;
        cur.y = dragState.origY + (dy / dragState.stageH) * 100;
        cur.x = Math.max(cur.w / 2, Math.min(100 - cur.w / 2, cur.x));
        cur.y = Math.max(5, Math.min(95, cur.y));
        requestAnimationFrame(() => updateLogoPositionForSide(s));
    }

    if (dragState.type === 'resize') {
        /* Apple-style : coin direct, linéaire, ratio toujours conservé */
        const dx = e.clientX - dragState.startX;
        const dy = e.clientY - dragState.startY;
        const signX = dragState.corner.includes('e') ? 1 : -1;
        const signY = dragState.corner.includes('s') ? 1 : -1;
        const delta  = (signX * dx + signY * dy) * 0.5;
        const pctChg = (delta / dragState.stageW) * 100 * 2.5;
        const ratio  = dragState.origH / dragState.origW;
        let nw = dragState.origW + pctChg;
        let nh = nw * ratio;
        if (nw < 8)  { nw = 8;  nh = nw * ratio; }
        if (nw > 50) { nw = 50; nh = nw * ratio; }
        if (nh < 6)  { nh = 6;  nw = nh / ratio; }
        if (nh > 40) { nh = 40; nw = nh / ratio; }
        cur.w = nw; cur.h = nh;
        requestAnimationFrame(() => updateLogoPositionForSide(s));
    }
}

function onLogoUp(e) {
    if (!dragState) return;
    const moved   = Math.hypot(e.clientX - dragState.startX, e.clientY - dragState.startY);
    const tapSide = dragState.side;
    dragState = null;
    if (moved < 5) {
        flipSide(tapSide);
        openLogoSheet(tapSide);
    }
}

/* ══════════════════════════════════════
   SIDE TOGGLE
   ══════════════════════════════════════ */
window.flipSide = function(s) {
    side = s;
    logoSelected = false;
    document.querySelectorAll('.logo-zone').forEach(z => z.classList.remove('selected'));
    document.getElementById('colFront').classList.toggle('active', s === 'front');
    document.getElementById('colBack').classList.toggle('active',  s === 'back');
    syncLogoUI();
};

function showLogoColorSection() { /* géré par le bottom sheet */ }

window.dropLogo = function() {
    const cur = cl();
    cur.data = null;
    logoSelected = false;
    document.getElementById('upPill').classList.remove('show');
    const fi = document.getElementById('fileIn'); if (fi) fi.value = '';
    renderLogo();
    updateFloatBar();
    updateTapOverlays();
};

/* ══════════════════════════════════════
   FILE UPLOAD
   ══════════════════════════════════════ */
window.onUpload = function(e) {
    const f = e.target.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = function(ev) {
        const cur = cl();
        cur.data = {type:'custom', url:ev.target.result, name:f.name};
        document.getElementById('upThumb').src = ev.target.result;
        document.getElementById('upName').textContent = f.name;
        document.getElementById('upPill').classList.add('show');
        cur.x = side === 'front' ? 66.5 : 47.9;
        cur.y = side === 'front' ? 28 : 31;
        cur.w = side === 'front' ? 18.9 : 67.2;
        cur.h = side === 'front' ? 12.6 : 44.8;
        renderLogo();
        closeLogoSheet();
    };
    r.readAsDataURL(f);
};

window.rmUpload = function() {
    const cur = cl();
    if (cur.data && cur.data.type === 'custom') { cur.data = null; renderLogo(); }
    document.getElementById('upPill').classList.remove('show');
    const fi = document.getElementById('fileIn'); if (fi) fi.value = '';
};

/* ══════════════════════════════════════
   TAP OVERLAYS — état vide/rempli
   ══════════════════════════════════════ */
function updateTapOverlays() {
    ['front', 'back'].forEach(s => {
        const id = s === 'front' ? 'logoTapFront' : 'logoTapBack';
        const el = document.getElementById(id);
        if (!el) return;
        if (logos[s].data) { el.classList.add('gone'); }
        else               { el.classList.remove('gone'); }
    });
}

/* ══════════════════════════════════════
   FLOAT BAR — barre contextuelle logo
   ══════════════════════════════════════ */
function updateFloatBar() {
    const bar = document.getElementById('logoFloatBar');
    if (!bar) return;
    const cur = logos[side];
    if (!cur.data) { bar.style.display = 'none'; return; }
    bar.style.display = 'flex';
}

/* ══════════════════════════════════════
   LOGO BOTTOM SHEET
   ══════════════════════════════════════ */
let _sheetSide = 'front';

function buildSheetLogoGrid() {
    const grid = document.getElementById('lsheetLogoGrid');
    if (!grid) return;
    grid.innerHTML = '';
    const cur = logos[_sheetSide];
    Object.entries(LOGOS).forEach(([k, arr]) => {
        const label = document.createElement('div');
        label.className = 'lsheet-group-label';
        label.textContent = k === 'bea' ? 'BEA — 16' : k === 'sxm' ? 'SXM — 12' : k === 'cor' ? 'COR — 01' : 'PAYSAGES';
        grid.appendChild(label);
        const g = document.createElement('div');
        g.className = 'lsheet-logo-grid';
        arr.forEach(l => {
            const thumb = document.createElement('div');
            thumb.className = 'lsheet-thumb' + (cur.data && cur.data.id === l.id ? ' on' : '');
            if (l.url) {
                const imgEl = document.createElement('img');
                imgEl.src = l.url;
                imgEl.style.cssText = 'width:56px;height:56px;object-fit:cover;border-radius:6px;';
                thumb.appendChild(imgEl);
            } else {
                const svgContainer = document.createElement('div');
                svgContainer.innerHTML = l.s;
                const svgEl = svgContainer.querySelector('svg');
                if (svgEl) { svgEl.setAttribute('width','56'); svgEl.setAttribute('height','56'); }
                if (svgEl) thumb.appendChild(svgEl);
            }
            const nameEl = document.createElement('div');
            nameEl.className = 'lsheet-thumb-name';
            nameEl.textContent = l.n;
            thumb.appendChild(nameEl);
            thumb.addEventListener('click', () => {
                if (l.url) {
                    cur.data = { type: 'custom', id: l.id, url: l.url, name: l.n };
                } else {
                    cur.data = { type: 'atelier', id: l.id, s: l.s };
                }
                if (_sheetSide === 'back' && l.back) {
                    cur.x = l.back.x; cur.y = l.back.y;
                    cur.w = l.back.w; cur.h = l.back.h;
                } else {
                    cur.x = _sheetSide === 'front' ? 66.5 : 47.9;
                    cur.y = _sheetSide === 'front' ? 28 : 31;
                    cur.w = _sheetSide === 'front' ? 18.9 : 67.2;
                    cur.h = _sheetSide === 'front' ? 12.6 : 44.8;
                }
                renderLogo();
                updateSheetColorSection();
                buildSheetLogoGrid();
                closeLogoSheet();
            });
            g.appendChild(thumb);
        });
        grid.appendChild(g);
    });
}

function buildSheetColorRow() {
    const row = document.getElementById('lsheetColorRow');
    if (!row) return;
    const cur = logos[_sheetSide];
    row.innerHTML = '';
    LOGO_COLORS.forEach(c => {
        const dot = document.createElement('button');
        dot.className = 'lsheet-color-dot' + (cur.logoColor === c.h ? ' on' : '');
        dot.style.background = c.h;
        dot.title = c.n;
        dot.addEventListener('click', () => {
            cur.logoColor = c.h;
            renderLogoForSide('front');
            renderLogoForSide('back');
            updateFloatBar();
            buildSheetColorRow();
        });
        row.appendChild(dot);
    });
}

function updateSheetColorSection() {
    buildSheetColorRow();
    const cur = logos[_sheetSide];
    const section = document.getElementById('lsheetColorSection');
    if (section) section.style.display = (cur.data && cur.data.type === 'atelier') ? '' : 'none';
}

window.openLogoSheet = function(s) {
    _sheetSide = (s !== undefined) ? s : side;
    document.getElementById('lsheetTitle').textContent = _sheetSide === 'front' ? 'Logo Avant' : 'Logo Arrière';
    buildSheetLogoGrid();
    updateSheetColorSection();
    const scroll = document.querySelector('.lsheet-scroll');
    if (scroll) scroll.scrollTop = 0;
    document.getElementById('lsheet').classList.add('open');
    document.getElementById('lsheetBackdrop').classList.add('open');
};

window.closeLogoSheet = function() {
    document.getElementById('lsheet').classList.remove('open');
    document.getElementById('lsheetBackdrop').classList.remove('open');
};

/* ══════════════════════════════════════
   PAYMENT
   ══════════════════════════════════════ */
window.setPay = function(s) {
    payStatus = s;
    document.querySelectorAll('#payStatus .pay-opt').forEach(b => b.classList.toggle('on', b.dataset.p === s));
};

window.calcTotal = function() {
    const t = (parseFloat(selects['selPrice'] && selects['selPrice'].value) || 0)
            + (parseFloat(selects['selPerso'] && selects['selPerso'].value) || 0);
    document.getElementById('totalLabel').textContent = t + ' €';
};

/* ══════════════════════════════════════
   MOCKUP CAPTURE — renders a side (front/back) to a JPEG data-URL
   ══════════════════════════════════════ */
function renderSvgToImg(svgStr, w, h) {
    return new Promise(function(resolve) {
        var blob = new Blob([svgStr], {type:'image/svg+xml;charset=utf-8'});
        var url = URL.createObjectURL(blob);
        var img = new Image();
        img.onload = function() { URL.revokeObjectURL(url); resolve(img); };
        img.onerror = function() { URL.revokeObjectURL(url); resolve(null); };
        img.src = url;
    });
}

async function captureMockup(shirtSvg, sideData, fabricHex, W, H, Q) {
    W = W || 400; H = H || 480; Q = Q || 0.65;
    var c = document.createElement('canvas'); c.width = W; c.height = H;
    var cx = c.getContext('2d');
    cx.fillStyle = '#F5F5F7'; cx.fillRect(0, 0, W, H);

    if (shirtSvg) {
        var colored = shirtSvg.replace(FABRIC_RE, fabricHex);
        var shirtImg = await renderSvgToImg(colored, W, H);
        if (shirtImg) {
            var scale = Math.min(W / shirtImg.naturalWidth, H / shirtImg.naturalHeight) * 0.92;
            var sw = shirtImg.naturalWidth * scale, sh = shirtImg.naturalHeight * scale;
            cx.drawImage(shirtImg, (W - sw) / 2, (H - sh) / 2, sw, sh);
        }
    }

    /* Overlay logo */
    if (sideData && sideData.data) {
        var lx = (sideData.x / 100) * W, ly = (sideData.y / 100) * H;
        var lw = (sideData.w / 100) * W, lh = (sideData.h / 100) * H;
        var logoImg = null;
        if (sideData.data.type === 'atelier' && sideData.data.s) {
            var logoSvg = sideData.data.s.replace(/#1A1A1A/gi, sideData.logoColor || '#1A1A1A');
            logoImg = await renderSvgToImg(logoSvg, lw, lh);
        } else if (sideData.data.type === 'custom' && sideData.data.url) {
            logoImg = await new Promise(function(resolve) {
                var im = new Image(); im.onload = function() { resolve(im); };
                im.onerror = function() { resolve(null); }; im.src = sideData.data.url;
            });
        }
        if (logoImg) cx.drawImage(logoImg, lx - lw / 2, ly - lh / 2, lw, lh);
    }

    return c.toDataURL('image/jpeg', Q);
}

/* ══════════════════════════════════════
   DASHBOARD — Création automatique de fiche
   ══════════════════════════════════════ */

/**
 * Envoie la commande + fiche complète vers le Dashboard OLDA.
 * Best-effort : une erreur réseau ne bloque pas le flux client.
 *
 * @param {Object} orderPayload  – payload commande
 * @param {Object} ficheData     – données complètes de la fiche (avec mockups si dispo)
 */
async function sendOrderToDashboard(orderPayload, ficheData) {
    var orderData = {
        commande          : orderPayload.commande,
        date              : orderPayload.date,
        nom               : orderPayload.nom,
        telephone         : orderPayload.telephone,
        collection        : orderPayload.collection,
        reference         : orderPayload.reference,
        taille            : orderPayload.taille,
        couleurTshirt     : orderPayload.couleurTshirt,
        couleurTshirtHex  : orderPayload.couleurTshirtHex,
        logoAvant         : orderPayload.logoAvant,
        logoArriere       : orderPayload.logoArriere,
        couleurLogoAvant  : orderPayload.couleurLogoAvant,
        couleurLogoArriere: orderPayload.couleurLogoArriere,
        note              : orderPayload.note,
        prix              : {
            tshirt          : orderPayload.prixTshirt,
            personnalisation: orderPayload.personnalisation,
            total           : orderPayload.total
        },
        paiement          : { statut: orderPayload.paye },
        source            : 'site-client',
        timestamp         : new Date().toISOString()
    };

    /* ── Ajouter les données de fiche complètes ── */
    if (ficheData) {
        orderData.fiche = {
            deadline          : ficheData.deadline || '',
            refDesc           : ficheData.refDesc || '',
            bio               : ficheData.bio || false,
            couleur           : ficheData.couleur || {},
            coteLogoAr        : ficheData.coteLogoAr || '',
            mockupFront       : ficheData.mockupFront || null,
            mockupBack        : ficheData.mockupBack || null
        };
    }

    try {
        var response = await fetch(DASHBOARD_URL + '/api/orders', {
            method : 'POST',
            headers: {
                'Content-Type' : 'application/json',
                'Authorization': 'Bearer ' + DASHBOARD_TOKEN
            },
            body: JSON.stringify(orderData)
        });

        if (!response.ok) {
            console.error('[OLDA Dashboard] Réponse non-OK — statut:', response.status, response.statusText);
        } else {
            console.info('[OLDA Dashboard] Fiche créée avec succès:', orderData.commande);
        }
    } catch (err) {
        console.error('[OLDA Dashboard] Envoi échoué:', err.message);

        /* Sauvegarde locale si le dashboard est inaccessible */
        try {
            var _pending = JSON.parse(localStorage.getItem('olda_pending_dashboard') || '[]');
            _pending.push(Object.assign({}, orderData, { _failedAt: new Date().toISOString() }));
            localStorage.setItem('olda_pending_dashboard', JSON.stringify(_pending));
            console.warn('[OLDA Dashboard] Commande mise en file locale.');
        } catch (storageErr) {
            console.warn('[OLDA Dashboard] Impossible de sauvegarder localement:', storageErr.message);
        }
    }
}

/* ══════════════════════════════════════
   SUBMIT  (A-Q payload)
   ══════════════════════════════════════ */
window.submit = async function() {
    const b = document.getElementById('subBtn');
    b.textContent = 'Envoi...'; b.disabled = true; b.style.opacity = '0.6';

    try {

    /* ── Build payload (synchrone) ── */
    const collVal = selects['selCollection'] ? selects['selCollection'].value : '';
    const refVal  = selects['selRef']        ? selects['selRef'].value        : '';
    const sizeVal = selects['selSize']       ? selects['selSize'].value       : '';
    const tel     = document.getElementById('clientPhone').value || '';
    const logoColorName = (hex, arr) => (arr.find(c => c.h === hex) || { n: hex }).n;

    const payload = {
        commande          : document.getElementById('orderNo').textContent.trim(),
        date              : document.getElementById('orderDate').textContent.trim(),
        nom               : ((s => s.toLowerCase().replace(/(^|\s)\S/g, c => c.toUpperCase()))(
                             (document.getElementById('clientNom').value.trim() + ' ' +
                              document.getElementById('clientPrenom').value.trim()).trim())),
        telephone         : tel.trim(),
        collection        : collVal || '',
        reference         : refVal  || '',
        taille            : sizeVal || '',
        couleurTshirt     : color.n,
        couleurTshirtHex  : color.h,
        couleurLogoAvant  : logos.front.data && logos.front.data.type === 'atelier'
                            ? logoColorName(logos.front.logoColor, LOGO_COLORS) : '',
        couleurLogoArriere: logos.back.data  && logos.back.data.type  === 'atelier'
                            ? logoColorName(logos.back.logoColor,  LOGO_COLORS) : '',
        logoAvant         : logos.front.data ? (logos.front.data.type === 'atelier' ? logos.front.data.id : 'Custom') : '',
        logoArriere       : logos.back.data  ? (logos.back.data.type  === 'atelier' ? logos.back.data.id  : 'Custom') : '',
        note              : (document.getElementById('note').value || '').trim(),
        prixTshirt        : (selects['selPrice']  && selects['selPrice'].value)  || '0',
        personnalisation  : (selects['selPerso']  && selects['selPerso'].value)  || '0',
        total             : String((parseFloat(selects['selPrice']?.value)||0)+(parseFloat(selects['selPerso']?.value)||0)),
        paye              : payStatus === 'oui' ? 'OUI' : 'NON'
    };

    /* ── Build fiche data (synchrone) ── */
    const coteLogoAr = (document.getElementById('coteLogoAr')?.value || '').trim();
    const deadline   = (document.getElementById('clientDeadline')?.value || '').trim();
    const ficheBase = {
        commande          : payload.commande,
        date              : payload.date,
        nom               : payload.nom,
        telephone         : payload.telephone,
        deadline          : deadline,
        collection        : payload.collection,
        reference         : payload.reference,
        refDesc           : (REFERENCES[payload.reference] && REFERENCES[payload.reference].desc) || '',
        bio               : !!(REFERENCES[payload.reference] && REFERENCES[payload.reference].bio),
        taille            : payload.taille,
        couleur           : { nom: color.n, hex: color.h },
        logoAvant         : payload.logoAvant,
        logoArriere       : payload.logoArriere,
        couleurLogoAvant  : payload.couleurLogoAvant,
        couleurLogoArriere: payload.couleurLogoArriere,
        coteLogoAr        : coteLogoAr,
        note              : payload.note,
        prix              : { tshirt: payload.prixTshirt, personnalisation: payload.personnalisation, total: payload.total },
        paiement          : { statut: payload.paye }
    };

    /* ── Capture mockups AVANT l'envoi (garantit que la fiche part complète) ── */
    var mockupFront = null, mockupBack = null;
    try {
        mockupFront = await captureMockup(svgF, logos.front, color.h, 480, 576, 0.90);
        mockupBack  = await captureMockup(svgB, logos.back,  color.h, 480, 576, 0.90);
    } catch(e) { /* la fiche fonctionne sans mockups */ }

    /* ── Fiche complète (avec mockups si disponibles) ── */
    var ficheComplete = JSON.parse(JSON.stringify(ficheBase));
    if (mockupFront) ficheComplete.mockupFront = mockupFront;
    if (mockupBack)  ficheComplete.mockupBack  = mockupBack;

    /* ── Lien fiche encodé pour Google Sheets (ouvre directement la fiche dans le dashboard) ── */
    var _ficheLight = JSON.parse(JSON.stringify(ficheBase));   /* sans mockups = URL courte */
    var _ficheEncoded = btoa(unescape(encodeURIComponent(JSON.stringify(_ficheLight))));
    payload.fiche = DASHBOARD_URL + '/ficheatelier-index.html#' + _ficheEncoded;

    /* ── Envoi Google Sheets (best-effort, non-bloquant) ── */
    fetch(API, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) }).catch(() => {});

    /* ── Sauvegarde fiche dans localStorage (même domaine = même dashboard) ── */
    try {
        var ficheKey = ficheComplete.commande || ('cmd-' + Date.now());
        var allFiches = JSON.parse(localStorage.getItem('olda_fiches') || '{}');
        if (!ficheComplete.status) ficheComplete.status = 'en-attente';
        allFiches[ficheKey] = ficheComplete;
        localStorage.setItem('olda_fiches', JSON.stringify(allFiches));
    } catch(ficheErr) {
        console.warn('[OLDA Fiche] Erreur sauvegarde:', ficheErr.message);
    }

    /* ── Bouton fiche → dashboard atelier (même domaine) ── */
    const ficheLink = document.getElementById('sfFicheBtn');
    ficheLink.href = 'ficheatelier-index.html';
    ficheLink.textContent = 'Voir la fiche récapitulative ›';

    /* ── Success overlay ── */
    const overlay = document.getElementById('successOverlay');
    document.getElementById('sfOrderNo').textContent    = payload.commande;
    document.getElementById('sfClientName').textContent = payload.nom || '';
    overlay.classList.add('sf-on');

    } catch(e) {
        console.error('Erreur validation:', e);
        b.textContent = 'Valider la Commande'; b.disabled = false; b.style.opacity = '1';
        const err = document.createElement('p');
        err.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#FF3B30;color:#fff;padding:12px 20px;border-radius:12px;font-size:14px;font-weight:600;z-index:9999;';
        err.textContent = 'Erreur : ' + e.message;
        document.body.appendChild(err);
        setTimeout(() => err.remove(), 5000);
    }
};


})();
</script>

</body>
</html>
